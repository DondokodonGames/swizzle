# AI生成システム現状分析レポート

**作成日**: 2025-12-19
**Phase**: 1-1
**目的**: 現在のAI生成システムの完全な理解と問題点の特定

---

## 1. システム概要

### 1.1 アーキテクチャ全体図

```
┌─────────────────────────────────────────────────────────────────┐
│                    MasterOrchestrator                           │
│  (24時間自動稼働ループ / ε-greedy戦略による探索・活用バランス)    │
└─────────────────────────────────────────────────────────────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        ▼                      ▼                      ▼
┌───────────────┐    ┌───────────────┐    ┌───────────────┐
│ LogicGenerator│    │ ImageGenerator│    │ SoundGenerator│
│ (Claude API)  │    │ (DALL-E 3)   │    │ (Web Audio)   │
└───────────────┘    └───────────────┘    └───────────────┘
        │                      │                      │
        └──────────────────────┼──────────────────────┘
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                  DynamicQualityChecker                          │
│        (95点満点: 相対評価50点 + 絶対評価45点)                    │
│                  合格基準: 60点以上                              │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                      AutoPublisher                               │
│     (Supabase保存 / 素材登録 / SNS自動投稿 7言語対応)            │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 各コンポーネント詳細

### 2.1 MasterOrchestrator.ts

**役割**: 自動生成ループの統括

**主要機能**:
- 24時間自動稼働ループ (`start24HourLoop`)
- ε-greedy戦略による探索/活用モード切替
- 日次レポート生成

**生成フロー**:
```
1. generateGameSpec() → GameSpec生成（現在は仮実装）
2. generateAssets() → 背景・オブジェクト・BGM・SE生成
3. generateLogic() → Claude APIでGameProject生成
4. qualityCheck() → DynamicQualityCheckerで品質評価
5. publish() → AutoPublisherで公開
```

**問題点**:
1. `generateGameSpec()`が**仮実装**: ランダム選択のみで面白いゲームアイデアを生成できていない
2. 並列生成**未実装**: シーケンシャル処理で速度が遅い
3. エラーハンドリングが不十分

**コード抜粋（仮実装部分）**:
```typescript
// TODO: 本実装ではClaude APIでゲーム仕様を生成
// 現在はランダムに組み合わせを生成
const genres: GameGenre[] = ['action', 'puzzle', 'timing', ...];
const mechanics: GameMechanic[] = ['tap', 'swipe', 'drag', ...];
```

---

### 2.2 LogicGenerator.ts

**役割**: Claude APIでGameProject JSONを生成

**API設定**:
- モデル: `claude-sonnet-4-20250514`
- 最大トークン: 8192
- 温度: 0.8

**トークン見積もり**:
- システムプロンプト: ~3000トークン
- 出力: ~3000トークン
- 合計: **~6000トークン/ゲーム**

**コスト概算**:
- Claude Sonnet: $3/1M入力 + $15/1M出力
- 1ゲームあたり: **約$0.024** (入力3K + 出力3K)

**定義されている条件タイプ**:
1. touch (タップ・スワイプ・ドラッグ・ホールド)
2. collision (衝突)
3. animation (アニメーション)
4. time (時間)
5. flag (フラグ)
6. gameState (ゲーム状態)
7. position (位置)
8. counter (カウンター)
9. random (ランダム)

**定義されているアクションタイプ**:
1. success/failure (ゲーム終了)
2. playSound/stopSound (音声)
3. setFlag/toggleFlag (フラグ)
4. switchAnimation/show/hide (表示)
5. move (移動)
6. effect (エフェクト)
7. counter (カウンター操作)
8. randomAction (ランダムアクション)
9. addScore/showMessage (UI)
10. applyForce/applyImpulse (物理)

**問題点**:
1. プロンプトが複雑で、AIが正確なJSONを生成しにくい
2. 実装可能なパターンと不可能なパターンの区別がプロンプトにない
3. ゲームの「面白さ」に関する指示が弱い

---

### 2.3 ImageGenerator.ts

**役割**: ゲームビジュアルの生成

**サポートプロバイダー**:
1. **OpenAI DALL-E 3** (主力)
2. Replicate (代替)
3. Stable Diffusion (代替・仮実装)

**DALL-E 3設定**:
```typescript
model: 'dall-e-3'
size: '1024x1024' (背景) / '512x512' (オブジェクト)
quality: 'standard'
n: 1
```

**コスト**:
- DALL-E 3 (1024x1024): $0.04/枚
- DALL-E 3 (512x512): $0.04/枚 (同額)
- 1ゲームあたり: 背景1枚 + オブジェクト5-10枚 = **$0.24-0.44**

**問題点**:
1. 1枚ずつ生成（レート制限対策で1秒待機）→ 遅い
2. DALL-E 3はSVG直接出力不可 → PNG生成後にSVG変換が必要（未実装）
3. ゲームに適したビジュアル生成のプロンプト最適化が不十分

---

### 2.4 SoundGenerator.ts

**役割**: BGMと効果音の生成

**実装状況**: **未実装（ダミーデータを返す）**

```typescript
// TODO: 実装
// 現在はダミーの音声データを返す
return {
  bgm: null,
  sounds: []
};
```

**設計（未実装）**:
- Web Audio API + Tone.js使用予定
- BGM: 10-30秒のループ音楽
- SE: タップ音、成功音、失敗音など

**問題点**:
1. 音声生成が**完全に未実装**
2. 生成されたゲームは無音状態

---

### 2.5 DynamicQualityChecker.ts

**役割**: 生成されたゲームの品質評価

**評価方式**: 95点満点

**相対評価（50点）**:
| 項目 | 配点 | 説明 |
|------|------|------|
| 多様性 | 0-20点 | 既存ゲームとの差異 |
| 密集ペナルティ | 0--10点 | 類似ゲームが多い場合の減点 |
| 空白埋めボーナス | 0-10点 | 未開拓ジャンルへの加点 |
| バランス貢献 | 0-10点 | ポートフォリオバランスへの貢献 |

**絶対評価（45点）**:
| 項目 | 配点 | 説明 |
|------|------|------|
| 基本品質 | 0-15点 | ルール数、オブジェクト数など |
| プレイアビリティ | 0-15点 | クリア可能性、バグの有無 |
| 予測満足度 | 0-15点 | ユーザー満足度予測 |

**合格基準**: 60点以上

**問題点**:
1. 「面白さ」の評価が曖昧
2. Claude API評価は高コストなのでルールベース評価で代用
3. ゲームを実際にシミュレートする精度が低い（ランダムベース）

---

### 2.6 PlayabilitySimulator.ts

**役割**: ゲームのシミュレーションとクリア可能性検証

**シミュレーション方式**:
- 最大1000ステップ
- 10回試行
- タッチ条件は5%確率でランダム発動
- 衝突条件は10%確率でランダム発動

**問題点**:
1. ランダムシミュレーションで精度が低い
2. 実際のユーザー操作を再現できていない
3. 複雑なゲームメカニクスの検証が困難

---

### 2.7 GamePortfolioAnalyzer.ts

**役割**: 既存ゲームポートフォリオの分析

**機能**:
- 40次元ゲームベクトル化
- 多様性スコア計算
- 類似ゲーム検出

**問題点**:
1. 画像分析が**仮実装**（TODO状態）
2. 実際の面白さを反映できていない

---

## 3. コスト・速度分析

### 3.1 現在のコスト構造

| 項目 | コスト | 備考 |
|------|--------|------|
| Claude API (LogicGenerator) | $0.024/ゲーム | 6000トークン想定 |
| DALL-E 3 (ImageGenerator) | $0.24-0.44/ゲーム | 6-11枚想定 |
| 音声生成 | $0/ゲーム | 未実装 |
| **合計** | **$0.26-0.47/ゲーム** | |

### 3.2 現在の速度

| 処理 | 時間 | 備考 |
|------|------|------|
| GameSpec生成 | ~1秒 | ランダム選択のみ |
| 画像生成 | 60-120秒 | 6-11枚 × 5-10秒/枚 |
| ロジック生成 | 10-20秒 | Claude API |
| 品質チェック | 5-10秒 | シミュレーション含む |
| **合計** | **~2-3分/ゲーム** | シーケンシャル実行 |

### 3.3 1000ゲーム生成時の見積もり

| 項目 | 現状（並列なし） | 目標（並列50） |
|------|------------------|----------------|
| コスト | $260-470 | $260-470 |
| 時間 | 33-50時間 | 40-60分 |

---

## 4. 根本的な問題点

### 4.1 クリティカルな問題

1. **GameSpec生成が仮実装**
   - ランダム選択のみで「面白い」ゲームアイデアを生成できない
   - 250本生成して破棄した主因と推測

2. **音声生成が未実装**
   - ゲームが無音で体験が不完全
   - 面白さの大幅な低下

3. **並列生成が未対応**
   - 1ゲームずつシーケンシャル処理
   - 1000ゲーム生成に33時間以上

### 4.2 品質に影響する問題

1. **品質チェックが弱い**
   - 「動作するか」は検証できる
   - 「面白いか」は評価できない

2. **ビジュアル生成が最適化されていない**
   - ゲームに適したスタイルの指定が不足
   - SVG変換が未実装

3. **プレイアビリティ検証が不正確**
   - ランダムシミュレーションで精度低下
   - 複雑なゲームを正しく評価できない

---

## 5. 250本破棄の原因分析

破棄された250本の具体的なログやデータは確認できませんでしたが、
コードベースから以下が主因と推測されます：

### 5.1 推定原因

1. **GameSpecが貧弱**（確信度: 高）
   - ランダム組み合わせでは面白いゲームになりにくい
   - メカニクスとテーマの不整合

2. **ルール生成の失敗**（確信度: 中）
   - Claude APIが正確なJSON出力に失敗
   - 実装不可能なルールを生成

3. **プレイアビリティ問題**（確信度: 中）
   - クリア不可能なゲーム
   - 無限ループするゲーム

4. **ビジュアルの品質不足**（確信度: 中）
   - ゲームに不適切な画像
   - 視認性の問題

---

## 6. 改善方針（概要）

### 6.1 最優先改善

1. **GameSpec生成の本実装**
   - Claude/GPT-4で面白いゲームアイデアを生成
   - 面白さを自己評価させる

2. **音声生成の実装**
   - Web Audio API / 外部サービス利用
   - 最低限の効果音を確保

3. **並列生成の実装**
   - 50並列を目標
   - エラーハンドリング強化

### 6.2 品質向上

1. **プロンプト最適化**
   - 実装可能なパターンを明示
   - 面白さの基準を明確化

2. **ビジュアル改善**
   - ゲーム用プロンプトテンプレート
   - スタイル一貫性の確保

3. **品質チェック強化**
   - 面白さ評価の追加
   - より精度の高いシミュレーション

---

## 7. 次のステップ

Phase 1-2: ゲームエンジンの完全理解
- 速度システムの詳細調査
- 座標系の完全な理解
- 動作確認済みパターンの抽出
