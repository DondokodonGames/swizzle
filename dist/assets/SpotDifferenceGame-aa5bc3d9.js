var y=Object.defineProperty;var F=(h,o,e)=>o in h?y(h,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[o]=e;var d=(h,o,e)=>(F(h,typeof o!="symbol"?o+"":o,e),e);import{G as P,C as u,a as c}from"./index-a4c7ba8a.js";function x(h){return h==="easy"||h==="normal"||h==="hard"}function b(h){const o=h.difficulty;return x(o)?o:"normal"}function C(h,o){return typeof h=="number"&&isFinite(h)?Math.max(1e3,Math.round(h*1e3)):o}function W(h,o,e){return Math.max(o,Math.min(e,h))}class R extends P{constructor(e,t){super(e,t);d(this,"onGameEnd");d(this,"scene",new u);d(this,"leftPanel",new u);d(this,"rightPanel",new u);d(this,"finished",!1);d(this,"remainMs",3e4);d(this,"diffs",[]);d(this,"goals",5);d(this,"found",0);d(this,"allowMiss",!0);d(this,"pad",20);d(this,"panelW",400);d(this,"panelH",260)}async createScene(){const e=this.settings,t=b(e);this.remainMs=C(e.duration,3e4),t==="easy"?this.goals=5:t==="hard"?this.goals=7:this.goals=6,typeof e.differences=="number"&&isFinite(e.differences)&&(this.goals=W(Math.round(e.differences),3,10)),this.allowMiss=typeof e.allowMiss=="boolean"?e.allowMiss:!0;const n=this.app.renderer.width,i=this.app.renderer.height;this.panelW=Math.max(260,Math.min(460,Math.floor((n-this.pad*3)/2))),this.panelH=Math.max(200,Math.min(360,Math.floor(i-this.pad*2)));const s=this.pad+this.panelW/2,a=this.pad*2+this.panelW+this.panelW/2,l=i/2;this.scene.eventMode="static",this.scene.on("pointertap",r=>this.onTap(r)),this.leftPanel.x=s,this.leftPanel.y=l,this.rightPanel.x=a,this.rightPanel.y=l,this.scene.addChild(this.leftPanel,this.rightPanel),this.drawPanelFrame(this.leftPanel,959977,76362),this.drawPanelFrame(this.rightPanel,959977,76362),this.generatePictures(),this.container.addChild(this.scene)}handleInput(e){}updateGame(e){if(this.finished)return;const t=e*(1e3/60);if(this.remainMs-=t,this.remainMs<=0){this.remainMs=0,this.finish(!1);return}}showResult(e){var t;(t=this.onGameEnd)==null||t.call(this,e.success,e.score)}drawPanelFrame(e,t,n){const i=new c;i.lineStyle(4,16777215,.9),i.beginFill(0,.18),i.drawRoundedRect(-this.panelW/2,-this.panelH/2,this.panelW,this.panelH,16),i.endFill(),e.addChild(i)}generatePictures(){const e=new c,t=new c;this.drawBaseScene(e),this.drawBaseScene(t),this.diffs=[];for(let s=0;s<this.goals;s++){const a=this.createOneDifference(t);this.diffs.push(a)}this.leftPanel.addChild(e),this.rightPanel.addChild(t);for(const s of this.diffs){const a=new c,l=new c;a.beginFill(16777215,.001),a.drawCircle(this.localX(s.cx,!0),this.localY(s.cy),s.r*this.panelW),a.endFill(),l.beginFill(16777215,.001),l.drawCircle(this.localX(s.cx,!1),this.localY(s.cy),s.r*this.panelW),l.endFill(),a.eventMode="static",l.eventMode="static",s.leftMark=new c,s.rightMark=new c,this.leftPanel.addChild(a,s.leftMark),this.rightPanel.addChild(l,s.rightMark),a.__diff__=s,l.__diff__=s}const n=new c;n.beginFill(16734810,0),n.drawRoundedRect(-this.panelW/2,-this.panelH/2,this.panelW,this.panelH,16),n.endFill(),n.name="missOverlay",this.leftPanel.addChild(n);const i=n.clone();this.rightPanel.addChild(i)}drawBaseScene(e){const t=this.panelW,n=this.panelH;e.beginFill(8900331,1),e.drawRoundedRect(-t/2+6,-n/2+6,t-12,n-12,12),e.endFill(),e.beginFill(2792847,1),e.drawEllipse(-t*.15,n*.35,t*.45,n*.25),e.drawEllipse(t*.25,n*.32,t*.55,n*.28),e.endFill(),e.beginFill(16769162,1),e.drawCircle(t*.28,-n*.25,Math.min(t,n)*.08),e.endFill();const i=-t*.18,s=n*.1,a=t*.22,l=n*.18;e.beginFill(16762533,1),e.drawRoundedRect(i-a/2,s-l/2,a,l,10),e.endFill(),e.beginFill(10309341,1),e.moveTo(i-a/2-8,s-l/2),e.lineTo(i,s-l/2-l*.55),e.lineTo(i+a/2+8,s-l/2),e.lineTo(i-a/2-8,s-l/2),e.endFill();const r=t*.05,p=n*.15;e.beginFill(9262372,1),e.drawRoundedRect(r-8,p,16,n*.18,6),e.endFill(),e.beginFill(2792847,1),e.drawCircle(r,p,n*.14),e.endFill(),e.beginFill(16777215,1),e.drawCircle(-t*.28,-n*.28,n*.05),e.drawCircle(-t*.24,-n*.26,n*.06),e.drawCircle(-t*.2,-n*.29,n*.04),e.endFill()}createOneDifference(e){const t=Math.random()*.75+.125,n=Math.random()*.7+.15,i=Math.random()*.05+.035,s=new c,a=this.localX(t,!1),l=this.localY(n),r=i*this.panelW,p=Math.random();if(p<.33){s.beginFill(16773542,1);for(let f=0;f<8;f++){const m=f/8*Math.PI*2,M=a+Math.cos(m)*r*(f%2===0?.8:.3),w=l+Math.sin(m)*r*(f%2===0?.8:.3);f===0?s.moveTo(M,w):s.lineTo(M,w)}s.closePath(),s.endFill()}else p<.66?(s.beginFill(15167313,.9),s.drawRoundedRect(a-r*.8,l-r*.5,r*1.6,r*1,r*.3),s.endFill()):(s.lineStyle(Math.max(2,r*.15),2508371,1),s.drawCircle(a,l,r*.8));return e.addChild(s),{cx:t,cy:n,r:i,found:!1}}onTap(e){if(this.finished)return;const t=e.global,n=this.leftPanel.toLocal(t),i=this.rightPanel.toLocal(t),s=this.pointInsidePanel(n.x,n.y),a=this.pointInsidePanel(i.x,i.y);let l=!1;s&&(l=this.tryHit(n.x,n.y,!0)||l),a&&(l=this.tryHit(i.x,i.y,!1)||l),!l&&!this.allowMiss&&(this.flashMiss(this.leftPanel),this.flashMiss(this.rightPanel))}pointInsidePanel(e,t){return Math.abs(e)<=this.panelW/2&&Math.abs(t)<=this.panelH/2}tryHit(e,t,n){(e+this.panelW/2)/this.panelW,(t+this.panelH/2)/this.panelH;for(const i of this.diffs){if(i.found)continue;const s=this.localX(i.cx,!0)-e,a=this.localY(i.cy)-t,l=i.r*this.panelW;if(s*s+a*a<=l*l)return this.markFound(i),!0}return!1}markFound(e){e.found=!0,this.found++;const t=n=>{const i=n==="left"?e.leftMark:e.rightMark,s=this.localX(e.cx,n==="left"),a=this.localY(e.cy),l=e.r*this.panelW;i.clear(),i.lineStyle(Math.max(3,l*.18),65416,.9),i.drawCircle(s,a,l*.9),i.lineStyle(Math.max(3,l*.12),16777215,.9),i.moveTo(s-l*.6,a-l*0),i.lineTo(s+l*.6,a+l*0),i.moveTo(s,a-l*.6),i.lineTo(s,a+l*.6)};t("left"),t("right"),this.found>=this.goals&&this.finish(!0)}flashMiss(e){const t=e.getChildByName("missOverlay");if(!t)return;t.alpha=.35;const n=6;for(let i=1;i<=n;i++)setTimeout(()=>{t.alpha=Math.max(0,.35*(1-i/n))},i*40)}localX(e,t){return-this.panelW/2+e*this.panelW}localY(e){return-this.panelH/2+e*this.panelH}finish(e){var i;if(this.finished)return;this.finished=!0;const t=Math.round(this.remainMs/10),n=Math.max(0,this.found*400+t+(e?800:0));(i=this.onGameEnd)==null||i.call(this,e,n)}}export{R as SpotDifferenceGame};
//# sourceMappingURL=SpotDifferenceGame-aa5bc3d9.js.map
