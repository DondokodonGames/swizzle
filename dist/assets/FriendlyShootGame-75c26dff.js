var p=Object.defineProperty;var g=(l,d,t)=>d in l?p(l,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[d]=t;var r=(l,d,t)=>(g(l,typeof d!="symbol"?d+"":d,t),t);import{G as b,C as x,a as M,b as w}from"./index-a4c7ba8a.js";function B(l){return l==="easy"||l==="normal"||l==="hard"}function y(l){const d=l.difficulty;return B(d)?d:"normal"}function F(l,d){return typeof l=="number"&&isFinite(l)?Math.max(1e3,Math.round(l*1e3)):d}function f(l,d,t){return Math.max(d,Math.min(t,l))}class C extends b{constructor(t,i){super(t,i);r(this,"onGameEnd");r(this,"scene",new x);r(this,"finished",!1);r(this,"remainMs",3e4);r(this,"targets",[]);r(this,"spawnAccum",0);r(this,"spawnBaseMs",700);r(this,"lifetimeMs",1200);r(this,"moveTargets",!0);r(this,"badRatio",.2);r(this,"allowBadMax",2);r(this,"hitsNeeded",15);r(this,"goodHits",0);r(this,"badHits",0);r(this,"sizeMul",1);r(this,"rateMul",1);r(this,"score",0);r(this,"combo",0);r(this,"infoText");r(this,"colors",{bgTop:725024,bgBottom:1382955,good:9627303,bad:16734810,targetGood:16777215,targetBad:16347926,text:16777215,dim:9741240})}async createScene(){const t=this.settings,i=y(t),a=this.app.renderer.width,o=this.app.renderer.height;this.remainMs=F(t.duration,3e4),i==="easy"?(this.hitsNeeded=12,this.spawnBaseMs=780,this.lifetimeMs=1400,this.sizeMul=1.15,this.rateMul=.95,this.allowBadMax=3):i==="hard"?(this.hitsNeeded=18,this.spawnBaseMs=580,this.lifetimeMs=1e3,this.sizeMul=.9,this.rateMul=1.15,this.allowBadMax=1):(this.hitsNeeded=15,this.spawnBaseMs=680,this.lifetimeMs=1200,this.sizeMul=1,this.rateMul=1,this.allowBadMax=2),typeof t.targetHits=="number"&&isFinite(t.targetHits)&&(this.hitsNeeded=f(Math.round(t.targetHits),6,40)),typeof t.spawnBaseMs=="number"&&isFinite(t.spawnBaseMs)&&(this.spawnBaseMs=f(Math.round(t.spawnBaseMs),120,2e3)),typeof t.lifetimeMs=="number"&&isFinite(t.lifetimeMs)&&(this.lifetimeMs=f(Math.round(t.lifetimeMs),400,4e3)),typeof t.badRatio=="number"&&isFinite(t.badRatio)&&(this.badRatio=f(t.badRatio,0,1)),typeof t.allowBadMax=="number"&&isFinite(t.allowBadMax)&&(this.allowBadMax=f(Math.round(t.allowBadMax),0,10)),typeof t.moveTargets=="boolean"&&(this.moveTargets=t.moveTargets),t.palette==="forest"?(this.colors.bgTop=732704,this.colors.bgBottom=201999,this.colors.targetBad=3462041):t.palette==="candy"&&(this.colors.bgTop=3875392,this.colors.bgBottom=1706782,this.colors.targetBad=16739179);const s=new M;s.beginFill(this.colors.bgTop),s.drawRect(0,0,a,Math.floor(o*.45)),s.endFill(),s.beginFill(this.colors.bgBottom),s.drawRect(0,Math.floor(o*.45),a,o),s.endFill(),this.scene.addChild(s),this.infoText=new w("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(a,o)*.05),fill:this.colors.text,stroke:0,strokeThickness:5}),this.infoText.anchor.set(.5),this.infoText.x=a/2,this.infoText.y=Math.floor(o*.22),this.scene.addChild(this.infoText),this.updateInfo(),this.scene.eventMode="static",this.scene.on("pointertap",h=>this.onTap(h)),this.container.addChild(this.scene)}handleInput(t){}updateGame(t){if(this.finished)return;const i=t*(1e3/60),a=i/1e3,o=this.app.renderer.width,s=this.app.renderer.height;if(this.remainMs-=i,this.remainMs<=0){this.remainMs=0,this.finish(this.goodHits>=this.hitsNeeded);return}this.spawnAccum+=i;const h=this.spawnBaseMs/this.rateMul;for(;this.spawnAccum>=h;)this.spawnAccum-=h,this.spawnTarget(),this.rateMul=Math.min(1.6,this.rateMul*1.01);const c=[];for(const n of this.targets){if(n.lifeMs-=i,this.moveTargets){n.x+=n.vx*a,n.y+=n.vy*a;const e=n.r;(n.x<e+10||n.x>o-e-10)&&(n.vx*=-1),(n.y<e+10||n.y>s-e-10)&&(n.vy*=-1),n.g.x=n.x,n.g.y=n.y}n.lifeMs<=0?this.scene.removeChild(n.g):c.push(n)}this.targets=c}showResult(t){var i;(i=this.onGameEnd)==null||i.call(this,t.success,t.score)}updateInfo(){this.infoText.text=`Hits: ${this.goodHits}/${this.hitsNeeded}  Bad: ${this.badHits}/${this.allowBadMax}`}spawnTarget(){const t=this.app.renderer.width,i=this.app.renderer.height,a=Math.random()>this.badRatio,o=Math.min(t,i)*.05,s=f(o*(a?1:.9)*this.sizeMul,14,46),h=20+s,c=h+Math.random()*(t-h*2),n=Math.max(h+40,Math.min(i-h-20,h+40+Math.random()*(i-h*2-60))),e=new M;a?(e.beginFill(16777215,1),e.drawCircle(0,0,s),e.endFill(),e.beginFill(2042167,1),e.drawCircle(0,0,s*.65),e.endFill(),e.beginFill(16777215,1),e.drawCircle(0,0,s*.35),e.endFill()):(e.beginFill(this.colors.targetBad,1),e.drawCircle(0,0,s*.9),e.endFill(),e.beginFill(2236962,1),e.drawRect(-s*.15,-s*1.1,s*.3,s*.35),e.endFill()),e.x=c,e.y=n,e.eventMode="passive",this.scene.addChild(e);const m=(Math.random()-.5)*(a?40:60),u=(Math.random()-.5)*(a?40:60);this.targets.push({g:e,x:c,y:n,r:s,lifeMs:this.lifetimeMs,good:a,vx:m,vy:u})}onTap(t){if(this.finished)return;const i=this.scene.toLocal(t.global);for(let a=this.targets.length-1;a>=0;a--){const o=this.targets[a],s=i.x-o.x,h=i.y-o.y;if(s*s+h*h<=o.r*o.r){o.good?this.onGoodHit(o):this.onBadHit(o),this.scene.removeChild(o.g),this.targets.splice(a,1);return}}}onGoodHit(t){this.goodHits++,this.combo++;const i=f(t.lifeMs/this.lifetimeMs,0,1),a=280,o=Math.min(8,this.combo)*50,s=Math.round(160*i);this.score+=a+o+s,this.flashCircle(t.x,t.y,this.colors.good,t.r*1.3),this.goodHits>=this.hitsNeeded?this.finish(!0):this.updateInfo()}onBadHit(t){this.combo=0,this.badHits++,this.score=Math.max(0,this.score-200),this.flashCircle(t.x,t.y,this.colors.bad,t.r*1.3),this.updateInfo(),this.badHits>this.allowBadMax&&this.finish(!1)}flashCircle(t,i,a,o){const s=new M;s.beginFill(a,.28),s.drawCircle(0,0,o),s.endFill(),s.x=t,s.y=i,this.scene.addChild(s);const h=8;for(let c=1;c<=h;c++)setTimeout(()=>{s.alpha=Math.max(0,.28*(1-c/h)),c===h&&this.scene.removeChild(s)},c*30)}finish(t){var h;if(this.finished)return;this.finished=!0;const i=Math.round(this.remainMs/8),a=this.goodHits*60,o=this.badHits*120,s=Math.max(0,this.score+i+a-o+(t?800:0));(h=this.onGameEnd)==null||h.call(this,t,s)}}export{C as FriendlyShootGame};
//# sourceMappingURL=FriendlyShootGame-75c26dff.js.map
