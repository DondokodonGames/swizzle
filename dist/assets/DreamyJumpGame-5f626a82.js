var b=Object.defineProperty;var v=(o,n,t)=>n in o?b(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t;var e=(o,n,t)=>(v(o,typeof n!="symbol"?n+"":n,t),t);import{G as Y,C as S,a as m,b as C}from"./index-a4c7ba8a.js";function T(o){return o==="easy"||o==="normal"||o==="hard"}function G(o){const n=o.difficulty;return T(n)?n:"normal"}function F(o,n){return typeof o=="number"&&isFinite(o)?Math.max(1e3,Math.round(o*1e3)):n}function c(o,n,t){return Math.max(n,Math.min(t,o))}class B extends Y{constructor(t,s){super(t,s);e(this,"onGameEnd");e(this,"scene",new S);e(this,"finished",!1);e(this,"remainMs",3e4);e(this,"cameraY",0);e(this,"player");e(this,"px",0);e(this,"py",0);e(this,"pw",42);e(this,"ph",48);e(this,"vx",0);e(this,"vy",0);e(this,"gravity",1500);e(this,"jumpVel",700);e(this,"moveSpeed",180);e(this,"wrap",!0);e(this,"clouds",[]);e(this,"cloudGapY",120);e(this,"cloudW",120);e(this,"cloudH",28);e(this,"topSpawnY",0);e(this,"bottomCullY",0);e(this,"maxHeight",0);e(this,"bounces",0);e(this,"score",0);e(this,"infoText");e(this,"colors",{bgTop:16766629,bgBottom:15817653,cloud:16777215,player:16777215,good:9627303,bad:16734810,text:16777215,deco:9741240})}async createScene(){const t=this.settings,s=G(t),i=this.app.renderer.width,h=this.app.renderer.height;this.remainMs=F(t.duration,3e4),s==="easy"?(this.gravity=1450,this.jumpVel=680,this.moveSpeed=170,this.cloudGapY=130,this.wrap=!0):s==="hard"?(this.gravity=1600,this.jumpVel=720,this.moveSpeed=200,this.cloudGapY=110,this.wrap=!1):(this.gravity=1500,this.jumpVel=700,this.moveSpeed=180,this.cloudGapY=120,this.wrap=!0),typeof t.gravity=="number"&&isFinite(t.gravity)&&(this.gravity=c(t.gravity,900,2400)),typeof t.jumpVel=="number"&&isFinite(t.jumpVel)&&(this.jumpVel=c(t.jumpVel,480,1e3)),typeof t.moveSpeed=="number"&&isFinite(t.moveSpeed)&&(this.moveSpeed=c(t.moveSpeed,100,360)),typeof t.cloudGapY=="number"&&isFinite(t.cloudGapY)&&(this.cloudGapY=c(t.cloudGapY,80,200)),typeof t.wrapHorizontal=="boolean"&&(this.wrap=t.wrapHorizontal),t.palette==="twilight"?(this.colors.bgTop=3152180,this.colors.bgBottom=1706782):t.palette==="night"&&(this.colors.bgTop=725024,this.colors.bgBottom=1382955);const a=new m;a.beginFill(this.colors.bgTop),a.drawRect(0,0,i,Math.floor(h*.45)),a.endFill(),a.beginFill(this.colors.bgBottom),a.drawRect(0,Math.floor(h*.45),i,h),a.endFill(),this.scene.addChild(a);for(let r=0;r<5;r++){const l=new m;l.lineStyle(2,this.colors.deco,.25);const d=(r+1)*(i/6);l.moveTo(d,0),l.lineTo(d,h),this.scene.addChild(l)}for(this.infoText=new C("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(i,h)*.045),fill:this.colors.text,stroke:0,strokeThickness:4}),this.infoText.anchor.set(.5),this.infoText.x=i/2,this.infoText.y=Math.floor(h*.2),this.scene.addChild(this.infoText),this.updateInfo(0),this.pw=Math.min(64,Math.floor(i*.08)),this.ph=Math.floor(this.pw*1.15),this.px=i/2,this.py=h-80,this.vx=0,this.vy=0,this.cameraY=0,this.maxHeight=this.py,this.player=new m,this.drawPlayer(),this.scene.addChild(this.player),this.cloudW=Math.min(140,Math.floor(i*.34)),this.cloudH=Math.max(22,Math.floor(this.cloudW*.22)),this.topSpawnY=this.py-40,this.bottomCullY=this.py+h+100,this.spawnCloud(i/2,this.py+30,this.cloudW*1.2);this.topSpawnY>this.py-h*1.5;)this.spawnNextAbove();this.scene.eventMode="static",this.scene.on("pointertap",r=>{r.global.x<i/2?this.vx=-this.moveSpeed:this.vx=this.moveSpeed}),this.container.addChild(this.scene)}handleInput(t){}updateGame(t){if(this.finished)return;const s=t*(1e3/60),i=s/1e3,h=this.app.renderer.width,a=this.app.renderer.height;if(this.remainMs-=s,this.remainMs<=0){this.remainMs=0,this.finish(!0);return}if(this.vy+=this.gravity*i,this.py+=this.vy*i,this.px+=this.vx*i,this.wrap?(this.px<-this.pw/2&&(this.px=h+this.pw/2),this.px>h+this.pw/2&&(this.px=-this.pw/2)):this.px=c(this.px,this.pw/2,h-this.pw/2),this.vy>0){const p=this.py+this.ph/2;for(const u of this.clouds){const M=u.x,w=u.y,g=u.w,x=u.h;if(Math.abs(this.px-M)<this.pw/2+g/2&&Math.abs(p-w)<this.ph/2+x/2){const f=w-x/2;if(p>=f-8&&p<=f+14){this.py=f-this.ph/2,this.vy=-this.jumpVel*(.96+Math.random()*.08),this.bounces++,this.score+=40;break}}}}const r=this.py-this.cameraY,l=a*.42;if(r<l){const p=l-r;this.cameraY-=p}if(this.py<this.maxHeight){const p=this.maxHeight-this.py;this.maxHeight=this.py,this.score+=Math.round(p*.1)}for(;this.topSpawnY>this.cameraY-a*.5;)this.spawnNextAbove();const d=this.cameraY+a+60,y=[];for(const p of this.clouds)p.y<d?y.push(p):this.scene.removeChild(p.g);if(this.clouds=y,this.py-this.cameraY>a+40){this.finish(!1);return}this.drawPlayer(),this.updateInfo(s),this.layoutClouds()}showResult(t){var s;(s=this.onGameEnd)==null||s.call(this,t.success,t.score)}updateInfo(t){const s=Math.ceil(this.remainMs/1e3);Math.max(0,Math.round((this.clouds.length>0?this.clouds[0].y-this.py:0)*.02)+Math.round((this.maxHeight>0?0:-this.maxHeight)*.01)),this.infoText.text=`Bounces ${this.bounces}   Time ${s}s`}drawPlayer(){const t=this.player;this.app.renderer.width,this.app.renderer.height;const s=this.px,i=this.py-this.cameraY;t.clear(),t.beginFill(this.colors.player,.95),t.drawRoundedRect(s-this.pw/2,i-this.ph/2,this.pw,this.ph,12),t.endFill(),t.beginFill(1118481,.9),t.drawCircle(s-this.pw*.18,i-this.ph*.1,Math.max(2,Math.floor(this.pw*.07))),t.drawCircle(s+this.pw*.1,i-this.ph*.12,Math.max(2,Math.floor(this.pw*.07))),t.endFill()}layoutClouds(){for(const t of this.clouds)t.g.x=t.x,t.g.y=t.y-this.cameraY}spawnNextAbove(){const t=this.app.renderer.width,s=this.topSpawnY-this.cloudGapY*(.9+Math.random()*.3),i=this.cloudW*(.8+Math.random()*.6),h=Math.max(i/2+10,Math.min(t-i/2-10,Math.random()*t));this.spawnCloud(h,s,i)}spawnCloud(t,s,i){const h=this.cloudH*(.9+Math.random()*.3),a=new m;this.drawCloudShape(a,i,h),this.scene.addChild(a),this.clouds.push({g:a,x:t,y:s,w:i,h}),this.topSpawnY=Math.min(this.topSpawnY,s)}drawCloudShape(t,s,i){t.clear(),t.beginFill(this.colors.cloud,.96),t.drawEllipse(-s/4,0,s*.32,i),t.drawEllipse(0,0,s*.42,i*1.2),t.drawEllipse(s/4,0,s*.32,i),t.drawRoundedRect(-s/2,-i/2,s,i,i/2),t.endFill()}finish(t){var r;if(this.finished)return;this.finished=!0;const s=Math.round(this.remainMs/6),i=this.bounces*30,h=Math.max(0,Math.round(-this.maxHeight*.2)),a=Math.max(0,this.score+s+i+h+(t?800:0));(r=this.onGameEnd)==null||r.call(this,t,a)}}export{B as DreamyJumpGame};
//# sourceMappingURL=DreamyJumpGame-5f626a82.js.map
