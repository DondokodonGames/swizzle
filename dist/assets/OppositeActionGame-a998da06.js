var m=Object.defineProperty;var w=(h,d,e)=>d in h?m(h,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[d]=e;var n=(h,d,e)=>(w(h,typeof d!="symbol"?d+"":d,e),e);import{G as p,C as M,a as c,b as g}from"./index-a4c7ba8a.js";function T(h){return h==="easy"||h==="normal"||h==="hard"}function b(h){const d=h.difficulty;return T(d)?d:"normal"}function x(h,d){return typeof h=="number"&&isFinite(h)?Math.max(1e3,Math.round(h*1e3)):d}function f(h,d,e){return Math.max(d,Math.min(e,h))}class F extends p{constructor(e,t){super(e,t);n(this,"onGameEnd");n(this,"scene",new M);n(this,"finished",!1);n(this,"remainMs",3e4);n(this,"leftZone");n(this,"rightZone");n(this,"cueText");n(this,"cueArrow");n(this,"roundsNeeded",10);n(this,"roundsDone",0);n(this,"missesAllowed",2);n(this,"misses",0);n(this,"windowMs",1200);n(this,"cueRemainMs",0);n(this,"awaiting",!1);n(this,"requiredSide","left");n(this,"displayedSide","left");n(this,"score",0);n(this,"combo",0);n(this,"colors",{bgTop:959977,bgBottom:142404,left:959977,right:16347926,good:9627303,bad:16734810,text:16777215})}async createScene(){const e=this.settings,t=b(e);this.remainMs=x(e.duration,3e4),t==="easy"?(this.roundsNeeded=8,this.windowMs=1400,this.missesAllowed=3):t==="hard"?(this.roundsNeeded=12,this.windowMs=900,this.missesAllowed=1):(this.roundsNeeded=10,this.windowMs=1200,this.missesAllowed=2),typeof e.rounds=="number"&&isFinite(e.rounds)&&(this.roundsNeeded=f(Math.round(e.rounds),4,30)),typeof e.windowMs=="number"&&isFinite(e.windowMs)&&(this.windowMs=f(Math.round(e.windowMs),400,4e3)),typeof e.missesAllowed=="number"&&isFinite(e.missesAllowed)&&(this.missesAllowed=f(Math.round(e.missesAllowed),0,10)),e.palette==="warm"&&(this.colors.bgTop=16755021,this.colors.bgBottom=5908992,this.colors.left=16760952,this.colors.right=16746375);const r=this.app.renderer.width,i=this.app.renderer.height,s=new c;s.beginFill(this.colors.bgTop),s.drawRect(0,0,r,i/2),s.endFill(),s.beginFill(this.colors.bgBottom),s.drawRect(0,i/2,r,i/2),s.endFill(),this.scene.addChild(s),this.leftZone=new c,this.leftZone.beginFill(this.colors.left,.12),this.leftZone.drawRect(0,0,r/2,i),this.leftZone.endFill(),this.leftZone.eventMode="static",this.leftZone.on("pointertap",o=>{o.stopPropagation(),this.onTap("left")}),this.scene.addChild(this.leftZone),this.rightZone=new c,this.rightZone.beginFill(this.colors.right,.12),this.rightZone.drawRect(r/2,0,r/2,i),this.rightZone.endFill(),this.rightZone.eventMode="static",this.rightZone.on("pointertap",o=>{o.stopPropagation(),this.onTap("right")}),this.scene.addChild(this.rightZone),this.cueText=new g("READY",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(r,i)*.08),fill:this.colors.text,stroke:0,strokeThickness:5}),this.cueText.anchor.set(.5),this.cueText.x=r/2,this.cueText.y=i*.28,this.scene.addChild(this.cueText),this.cueArrow=new c,this.scene.addChild(this.cueArrow),this.container.addChild(this.scene),this.nextCue()}handleInput(e){}updateGame(e){if(this.finished)return;const t=e*(1e3/60);if(this.remainMs-=t,this.remainMs<=0){this.remainMs=0,this.finish(this.roundsDone>=this.roundsNeeded);return}this.awaiting&&(this.cueRemainMs-=t,this.cueRemainMs<=0&&this.registerMiss("timeout"))}showResult(e){var t;(t=this.onGameEnd)==null||t.call(this,e.success,e.score)}nextCue(){const e=this.app.renderer.width,t=this.app.renderer.height;this.displayedSide=Math.random()<.5?"left":"right",this.requiredSide=this.displayedSide==="left"?"right":"left",this.cueText.text=this.displayedSide.toUpperCase(),this.drawArrow(this.displayedSide==="left"?-1:1,e,t),this.cueRemainMs=this.windowMs,this.awaiting=!0}onTap(e){if(!(!this.awaiting||this.finished))if(e===this.requiredSide){this.awaiting=!1,this.roundsDone++,this.combo++;const t=300,r=Math.min(7,this.combo)*60,i=this.cueRemainMs/this.windowMs,s=Math.round(120*i);this.score+=t+r+s,this.windowMs=f(this.windowMs*.985,550,4e3),this.flashZone(e,this.colors.good),this.roundsDone>=this.roundsNeeded?this.finish(!0):setTimeout(()=>this.nextCue(),80)}else this.registerMiss("wrong")}registerMiss(e){if(!this.awaiting||this.finished)return;this.awaiting=!1,this.combo=0,this.misses++,this.score=Math.max(0,this.score-120);const t=this.requiredSide==="left"?"right":"left";this.flashZone(t,this.colors.bad),this.misses>this.missesAllowed?this.finish(!1):setTimeout(()=>this.nextCue(),120)}drawArrow(e,t,r){const i=this.cueArrow;i.clear();const s=Math.min(t,r)*.25,o=t/2,a=r*.58,u=Math.max(10,Math.floor(s*.08)),l=Math.max(20,Math.floor(s*.22));i.lineStyle(u,16777215,.95),i.moveTo(o-e*s*.5,a),i.lineTo(o+e*s*.5,a),i.beginFill(16777215,.95),e<0?(i.moveTo(o-s*.5,a),i.lineTo(o-s*.5+l,a-l*.7),i.lineTo(o-s*.5+l,a+l*.7)):(i.moveTo(o+s*.5,a),i.lineTo(o+s*.5-l,a-l*.7),i.lineTo(o+s*.5-l,a+l*.7)),i.closePath(),i.endFill()}flashZone(e,t){const r=this.app.renderer.width,i=this.app.renderer.height,s=new c;s.beginFill(t,.28),e==="left"?s.drawRect(0,0,r/2,i):s.drawRect(r/2,0,r/2,i),s.endFill(),this.scene.addChild(s);const o=8;for(let a=1;a<=o;a++)setTimeout(()=>{s.alpha=Math.max(0,.28*(1-a/o)),a===o&&this.scene.removeChild(s)},a*30)}finish(e){var o;if(this.finished)return;this.finished=!0;const t=Math.round(this.remainMs/8),r=this.roundsDone*100,i=this.misses*120,s=Math.max(0,this.score+t+r-i+(e?600:0));(o=this.onGameEnd)==null||o.call(this,e,s)}}export{F as OppositeActionGame};
//# sourceMappingURL=OppositeActionGame-a998da06.js.map
