import{r as i,j as e}from"./index-a4c7ba8a.js";import{useAuth as F}from"./useAuth-c99b66df.js";const P=({isOpen:o,onClose:n,mode:u="setup",title:k})=>{const{profile:r,updateProfile:E,checkUsernameAvailable:p,loading:d,error:j,clearError:y}=F(),[s,N]=i.useState({username:"",displayName:"",bio:"",language:"ja"}),[l,f]=i.useState({}),[C,v]=i.useState(!1),[m,x]=i.useState(null),[c,h]=i.useState(!1);i.useEffect(()=>{r&&o&&(N({username:r.username||"",displayName:r.display_name||"",bio:r.bio||"",language:r.language||"ja"}),x(null),h(!1))},[r,o]),i.useEffect(()=>{o?(f({}),y()):h(!1)},[o,y]),i.useEffect(()=>{const a=t=>{t.key==="Escape"&&o&&(c?window.confirm("Â§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÈñâ„Åò„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü")&&n():n())};return o&&(document.addEventListener("keydown",a),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",a),document.body.style.overflow="unset"}},[o,c,n]),i.useEffect(()=>{if(!s.username||s.username===(r==null?void 0:r.username)){x(null);return}const a=setTimeout(async()=>{if(s.username.length>=3){v(!0);try{const t=await p(s.username);x(t)}catch(t){console.error("Username check error:",t),x(null)}finally{v(!1)}}},500);return()=>clearTimeout(a)},[s.username,r==null?void 0:r.username,p]);const z=()=>{const a={};return s.username.trim()?s.username.length<3?a.username="„É¶„Éº„Ç∂„ÉºÂêç„ÅØ3ÊñáÂ≠ó‰ª•‰∏ä„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô":s.username.length>20?a.username="„É¶„Éº„Ç∂„ÉºÂêç„ÅØ20ÊñáÂ≠ó‰ª•‰∏ã„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô":/^[a-zA-Z0-9_]+$/.test(s.username)?s.username!==(r==null?void 0:r.username)&&m===!1&&(a.username="„Åì„ÅÆ„É¶„Éº„Ç∂„ÉºÂêç„ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô"):a.username="„É¶„Éº„Ç∂„ÉºÂêç„ÅØËã±Êï∞Â≠ó„Å®„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢„ÅÆ„Åø‰ΩøÁî®„Åß„Åç„Åæ„Åô":a.username="„É¶„Éº„Ç∂„ÉºÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",s.displayName.length>50&&(a.displayName="Ë°®Á§∫Âêç„ÅØ50ÊñáÂ≠ó‰ª•‰∏ã„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô"),s.bio.length>160&&(a.bio="Ëá™Â∑±Á¥π‰ªã„ÅØ160ÊñáÂ≠ó‰ª•‰∏ã„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô"),f(a),Object.keys(a).length===0},A=async a=>{if(a.preventDefault(),!!z())try{const t={username:s.username.trim(),display_name:s.displayName.trim()||s.username.trim(),bio:s.bio.trim()||null,language:s.language};await E(t),h(!1),n()}catch(t){console.error("Profile update error:",t)}},b=a=>{const{name:t,value:S}=a.target;N(g=>({...g,[t]:S})),h(!0),l[t]&&f(g=>({...g,[t]:""}))},w=({current:a,max:t})=>e.jsxs("span",{className:`text-xs ${a>t?"text-red-500":"text-gray-400"}`,children:[a,"/",t]});return o?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:()=>{c?window.confirm("Â§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÈñâ„Åò„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü")&&n():n()}}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 transform transition-all",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:()=>{c?window.confirm("Â§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÈñâ„Åò„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü")&&n():n()},className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:d,children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"üë§"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:k||(u==="setup"?"„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö":"„Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ")}),e.jsx("p",{className:"text-gray-600 mt-2",children:u==="setup"?"„ÅÇ„Å™„Åü„ÅÆ„Éó„É≠„Éï„Ç£„Éº„É´„ÇíË®≠ÂÆö„Åó„Åæ„Åó„Çá„ÅÜ":"„Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åß„Åç„Åæ„Åô"})]}),j&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:j}),c&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-xl text-amber-700 text-sm",children:"üí° Â§âÊõ¥„ÅåÊú™‰øùÂ≠ò„Åß„Åô„ÄÇ„Äå‰øùÂ≠ò„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}),e.jsxs("form",{onSubmit:A,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:["„É¶„Éº„Ç∂„ÉºÂêç ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:b,className:`w-full px-4 py-3 pr-12 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${l.username?"border-red-300 bg-red-50":m===!0?"border-green-300 bg-green-50":m===!1?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"ÂçäËßíËã±Êï∞Â≠ó„Å®„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢",disabled:d}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:C?e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):m===!0?e.jsx("span",{className:"text-green-500",children:"‚úì"}):m===!1?e.jsx("span",{className:"text-red-500",children:"√ó"}):null})]}),l.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.username}),!l.username&&m===!0&&s.username!==(r==null?void 0:r.username)&&e.jsx("p",{className:"mt-1 text-sm text-green-600",children:"„Åì„ÅÆ„É¶„Éº„Ç∂„ÉºÂêç„ÅØ‰ΩøÁî®„Åß„Åç„Åæ„Åô"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"3-20ÊñáÂ≠ó„ÄÅÂçäËßíËã±Êï∞Â≠ó„Å®„Ç¢„É≥„ÉÄ„Éº„Çπ„Ç≥„Ç¢Ôºà_Ôºâ„ÅÆ„Åø‰ΩøÁî®ÂèØËÉΩ"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ë°®Á§∫Âêç"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"displayName",name:"displayName",value:s.displayName,onChange:b,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${l.displayName?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"„Åø„Çì„Å™„Å´Ë°®Á§∫„Åï„Çå„ÇãÂêçÂâç",disabled:d}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(w,{current:s.displayName.length,max:50})})]}),l.displayName&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.displayName}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Á©∫ÁôΩ„ÅÆÂ†¥Âêà„ÅØ„É¶„Éº„Ç∂„ÉºÂêç„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ëá™Â∑±Á¥π‰ªã"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"bio",name:"bio",value:s.bio,onChange:b,rows:3,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none ${l.bio?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"„ÅÇ„Å™„Åü„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ...",disabled:d}),e.jsx("div",{className:"absolute right-3 bottom-3",children:e.jsx(w,{current:s.bio.length,max:160})})]}),l.bio&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.bio})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ë®ÄË™ûË®≠ÂÆö"}),e.jsxs("select",{id:"language",name:"language",value:s.language,onChange:b,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",disabled:d,children:[e.jsx("option",{value:"ja",children:"Êó•Êú¨Ë™û"}),e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ko",children:"ÌïúÍµ≠Ïñ¥"}),e.jsx("option",{value:"zh",children:"‰∏≠Êñá"}),e.jsx("option",{value:"fr",children:"Fran√ßais"}),e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"es",children:"Espa√±ol"}),e.jsx("option",{value:"it",children:"Italiano"}),e.jsx("option",{value:"pt",children:"Portugu√™s"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[u==="edit"&&e.jsx("button",{type:"button",onClick:()=>{c?window.confirm("Â§âÊõ¥„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÈñâ„Åò„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü")&&n():n()},className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 focus:ring-4 focus:ring-gray-200 transition-all",disabled:d,children:"„Ç≠„É£„É≥„Çª„É´"}),e.jsx("button",{type:"submit",disabled:d||!c||Object.keys(l).length>0,className:`${u==="edit"?"flex-1":"w-full"} bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 focus:ring-4 focus:ring-blue-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:d?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"‰øùÂ≠ò‰∏≠..."]}):"‰øùÂ≠ò"})]})]}),u==="edit"&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"„Éó„É¨„Éì„É•„Éº"}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:(s.displayName||s.username).charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.displayName||s.username}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",s.username]}),s.bio&&e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:s.bio})]})]})]})]})})]}):null};export{P as default};
//# sourceMappingURL=ProfileSetup-91fbc1f9.js.map
