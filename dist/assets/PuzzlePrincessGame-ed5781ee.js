var A=Object.defineProperty;var Y=(s,l,i)=>l in s?A(s,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[l]=i;var r=(s,l,i)=>(Y(s,typeof l!="symbol"?l+"":l,i),i);import{G as E,C as G,a as b,b as X,S as B,T as F,d as v}from"./index-a4c7ba8a.js";function _(s){return s==="easy"||s==="normal"||s==="hard"}function z(s){const l=s.difficulty;return _(l)?l:"normal"}function k(s,l){return typeof s=="number"&&isFinite(s)?Math.max(1e3,Math.round(s*1e3)):l}function I(s,l,i){return Math.max(l,Math.min(i,s))}function q(s){for(let l=s.length-1;l>0;l--){const i=Math.random()*(l+1)|0;[s[l],s[i]]=[s[i],s[l]]}return s}class J extends E{constructor(i,e){super(i,e);r(this,"onGameEnd");r(this,"scene",new G);r(this,"finished",!1);r(this,"remainMs",3e4);r(this,"grid",3);r(this,"gridW",480);r(this,"gridH",480);r(this,"tileW",120);r(this,"tileH",120);r(this,"tiles",[]);r(this,"boardX",0);r(this,"boardY",0);r(this,"selA",null);r(this,"selBox");r(this,"artTex");r(this,"artW",480);r(this,"artH",480);r(this,"preview");r(this,"moves",0);r(this,"score",0);r(this,"colors",{bgTop:3152180,bgBottom:1706782,frame:16304127,lines:16777215,select:16769162,text:16777215})}async createScene(){const i=this.settings,e=z(i),t=this.app.renderer.width,h=this.app.renderer.height;this.remainMs=k(i.duration,3e4),e==="easy"?this.grid=2:e==="hard"?this.grid=4:this.grid=3,typeof i.grid=="number"&&isFinite(i.grid)&&(this.grid=I(Math.round(i.grid),2,5));const c=i.showPreview??!0;i.palette==="royal"?(this.colors.bgTop=4988309,this.colors.bgBottom=3018853,this.colors.frame=16569165):i.palette==="forest"&&(this.colors.bgTop=1332013,this.colors.bgBottom=339478,this.colors.frame=3462041);const n=new b;n.beginFill(this.colors.bgTop),n.drawRect(0,0,t,Math.floor(h*.45)),n.endFill(),n.beginFill(this.colors.bgBottom),n.drawRect(0,Math.floor(h*.45),t,h),n.endFill(),this.scene.addChild(n),this.gridW=Math.min(Math.floor(t*.86),Math.floor(h*.52)),this.gridH=this.gridW,this.tileW=Math.floor(this.gridW/this.grid),this.tileH=Math.floor(this.gridH/this.grid),this.boardX=Math.floor((t-this.gridW)/2),this.boardY=Math.floor(h*.4);const d=new X("Puzzle Princess",{fontFamily:"serif",fontSize:Math.floor(Math.min(t,h)*.06),fill:this.colors.text,stroke:0,strokeThickness:5});if(d.anchor.set(.5),d.x=t/2,d.y=Math.floor(h*.18),this.scene.addChild(d),this.artW=this.gridW,this.artH=this.gridH,this.artTex=this.generatePrincessTexture(this.artW,this.artH),c){this.preview=new B(new F(this.artTex.baseTexture,new v(0,0,this.artW,this.artH)));const o=Math.min(.25,Math.min(t*.32/this.artW,h*.18/this.artH));this.preview.scale.set(o),this.preview.x=Math.floor(t/2-this.preview.width/2),this.preview.y=Math.floor(this.boardY-this.preview.height-20),this.scene.addChild(this.preview)}const f=new b;f.lineStyle(6,this.colors.frame,.95),f.drawRoundedRect(this.boardX-6,this.boardY-6,this.gridW+12,this.gridH+12,16),f.endFill(),this.scene.addChild(f);const a=new b;a.lineStyle(2,this.colors.lines,.35);for(let o=1;o<this.grid;o++){const g=this.boardX+o*this.tileW,x=this.boardY+o*this.tileH;a.moveTo(g,this.boardY),a.lineTo(g,this.boardY+this.gridH),a.moveTo(this.boardX,x),a.lineTo(this.boardX+this.gridW,x)}this.scene.addChild(a);const u=q(Array.from({length:this.grid*this.grid},(o,g)=>g));u.every((o,g)=>o===g)&&u.length>1&&([u[0],u[1]]=[u[1],u[0]]);for(let o=0;o<u.length;o++){const g=o,x=u[o],m=o%this.grid,T=Math.floor(o/this.grid),M=this.boardX+m*this.tileW+this.tileW/2,p=this.boardY+T*this.tileH+this.tileH/2,P=new v(x%this.grid*this.tileW,Math.floor(x/this.grid)*this.tileH,this.tileW,this.tileH),S=new F(this.artTex.baseTexture,P),w=new B(S);w.anchor.set(.5),w.x=M,w.y=p,w.eventMode="static",w.on("pointertap",R=>{R.stopPropagation(),this.onTapTile(C)});const C={sprite:w,index:x,correct:g,x0:M,y0:p};w.__tile__=C,this.tiles.push(C),this.scene.addChild(w)}this.selBox=new b,this.selBox.visible=!1,this.scene.addChild(this.selBox),this.container.addChild(this.scene)}handleInput(i){}updateGame(i){if(this.finished)return;const e=i*(1e3/60);if(this.remainMs-=e,this.remainMs<=0){this.remainMs=0,this.finish(!1);return}}showResult(i){var e;(e=this.onGameEnd)==null||e.call(this,i.success,i.score)}onTapTile(i){if(!this.finished){if(!this.selA){this.selA=i,this.drawSelection(i);return}if(this.selA===i){this.selA=null,this.selBox.visible=!1;return}this.swapTiles(this.selA,i),this.moves++,this.selA=null,this.selBox.visible=!1,this.isSolved()&&this.finish(!0)}}drawSelection(i){this.selBox.clear(),this.selBox.lineStyle(6,this.colors.select,.95),this.selBox.drawRoundedRect(i.sprite.x-this.tileW/2-4,i.sprite.y-this.tileH/2-4,this.tileW+8,this.tileH+8,12),this.selBox.endFill(),this.selBox.visible=!0}swapTiles(i,e){const t=i.index,h=e.index;if(t===h)return;i.index=h,e.index=t;const c=new v(i.index%this.grid*this.tileW,Math.floor(i.index/this.grid)*this.tileH,this.tileW,this.tileH),n=new v(e.index%this.grid*this.tileW,Math.floor(e.index/this.grid)*this.tileH,this.tileW,this.tileH);i.sprite.texture=new F(this.artTex.baseTexture,c),e.sprite.texture=new F(this.artTex.baseTexture,n)}isSolved(){return this.tiles.every(i=>i.index===i.correct)}generatePrincessTexture(i,e){const t=new b;t.beginFill(3875392,1),t.drawRoundedRect(0,0,i,e,24),t.endFill(),t.beginFill(1706782,.55),t.drawCircle(-i*.15,-e*.1,Math.max(i,e)*.6),t.drawCircle(i*1.15,-e*.1,Math.max(i,e)*.6),t.drawCircle(-i*.1,e*1.1,Math.max(i,e)*.6),t.drawCircle(i*1.1,e*1.1,Math.max(i,e)*.6),t.endFill(),t.beginFill(16020150,1),t.drawEllipse(i*.5,e*.82,i*.36,e*.22),t.endFill(),t.beginFill(9262372,1),t.drawEllipse(i*.5,e*.44,i*.34,e*.3),t.drawEllipse(i*.3,e*.55,i*.16,e*.18),t.drawEllipse(i*.7,e*.55,i*.16,e*.18),t.endFill(),t.beginFill(16769213,1),t.drawEllipse(i*.5,e*.46,i*.2,e*.18),t.endFill(),t.beginFill(1118481,1),t.drawCircle(i*.44,e*.46,Math.min(i,e)*.012),t.drawCircle(i*.56,e*.46,Math.min(i,e)*.012),t.endFill(),t.beginFill(16739179,1);const h=i*.5,c=e*.54,n=Math.min(i,e)*.03;t.moveTo(h,c+n*.6),t.quadraticCurveTo(h-n,c-n*.2,h,c-n*.2),t.quadraticCurveTo(h+n,c-n*.2,h,c+n*.6),t.endFill(),t.beginFill(16569165,1);const d=e*.29,f=i*.28,a=e*.12;t.drawPolygon([i*.5-f/2,d+a,i*.5-f*.22,d+a*.35,i*.5,d,i*.5+f*.22,d+a*.35,i*.5+f/2,d+a]),t.endFill(),t.beginFill(9684477,1),t.drawCircle(i*.5,d+a*.55,e*.018),t.endFill(),t.beginFill(16557477,1),t.drawCircle(i*.5-f*.18,d+a*.75,e*.014),t.endFill(),t.beginFill(16557477,1),t.drawCircle(i*.5+f*.18,d+a*.75,e*.014),t.endFill(),t.beginFill(16773542,.9);for(let y=0;y<6;y++){const o=i*(.15+Math.random()*.7),g=e*(.12+Math.random()*.2),x=Math.min(i,e)*.01*(.8+Math.random()*.6);for(let m=0;m<5;m++){const T=m/5*Math.PI*2-Math.PI/2,M=o+Math.cos(T)*x*(m%2?.6:1.1),p=g+Math.sin(T)*x*(m%2?.6:1.1);m===0?t.moveTo(M,p):t.lineTo(M,p)}t.closePath()}return t.endFill(),this.app.renderer.generateTexture(t)}finish(i){var n;if(this.finished)return;this.finished=!0;const e=Math.round(this.remainMs/6),t=this.moves*20,c=Math.max(0,(i?800:0)+e-t);(n=this.onGameEnd)==null||n.call(this,i,c)}}export{J as PuzzlePrincessGame};
//# sourceMappingURL=PuzzlePrincessGame-ed5781ee.js.map
