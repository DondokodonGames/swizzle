var u=Object.defineProperty;var m=(i,h,e)=>h in i?u(i,h,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[h]=e;var s=(i,h,e)=>(m(i,typeof h!="symbol"?h+"":h,e),e);import{G as M,C as y,a as f}from"./index-a4c7ba8a.js";function D(i){return i==="easy"||i==="normal"||i==="hard"}function x(i){const h=i.difficulty;return D(h)?h:"normal"}const p=Math.PI/180;function l(i){return i%=360,i<0&&(i+=360),i}function S(i,h,e){return i=l(i),h=l(h),e=l(e),h<=e?i>=h&&i<=e:i>=h||i<=e}function g(i,h,e){return Math.max(h,Math.min(e,i))}class b extends M{constructor(e,t){super(e,t);s(this,"onGameEnd");s(this,"scene",new y);s(this,"ring");s(this,"zone");s(this,"perfectZone");s(this,"needle");s(this,"hitFlash");s(this,"finished",!1);s(this,"remainMs",3e4);s(this,"cx",0);s(this,"cy",0);s(this,"R",160);s(this,"angleDeg",0);s(this,"speedDeg",180);s(this,"dir",1);s(this,"zoneSize",40);s(this,"perfectSize",16);s(this,"zoneStart",0);s(this,"roundsNeeded",8);s(this,"roundsDone",0);s(this,"combo",0);s(this,"score",0);s(this,"rotatePolicy","alternate")}async createScene(){const e=this.settings,t=x(e),n=this.app.renderer.width,a=this.app.renderer.height;this.cx=n/2,this.cy=a/2,this.R=Math.min(n,a)*.34;const o=e.duration;this.remainMs=typeof o=="number"&&isFinite(o)?Math.max(1e3,Math.round(o*1e3)):3e4,t==="easy"?(this.roundsNeeded=6,this.speedDeg=e.baseSpeedDeg??160,this.zoneSize=e.zoneSizeDeg??60,this.perfectSize=e.perfectDeg??Math.floor(this.zoneSize*.45)):t==="hard"?(this.roundsNeeded=10,this.speedDeg=e.baseSpeedDeg??240,this.zoneSize=e.zoneSizeDeg??28,this.perfectSize=e.perfectDeg??Math.max(8,Math.floor(this.zoneSize*.35))):(this.roundsNeeded=8,this.speedDeg=e.baseSpeedDeg??180,this.zoneSize=e.zoneSizeDeg??40,this.perfectSize=e.perfectDeg??Math.floor(this.zoneSize*.4)),this.zoneSize=g(this.zoneSize,8,120),this.perfectSize=g(this.perfectSize,4,Math.max(6,this.zoneSize-4)),this.rotatePolicy=e.rotateDir??"alternate",this.rotatePolicy==="cw"?this.dir=1:this.rotatePolicy==="ccw"?this.dir=-1:this.dir=Math.random()<.5?1:-1,this.scene.eventMode="static",this.scene.on("pointerdown",r=>{r.stopPropagation(),this.onTap()}),this.ring=new f,this.drawRing(),this.scene.addChild(this.ring),this.zone=new f,this.perfectZone=new f,this.randomizeZone(!0),this.scene.addChild(this.zone,this.perfectZone),this.needle=new f,this.drawNeedle(),this.scene.addChild(this.needle),this.hitFlash=new f,this.hitFlash.alpha=0,this.scene.addChild(this.hitFlash),this.container.addChild(this.scene)}handleInput(e){}updateGame(e){if(this.finished)return;const t=e*(1e3/60),n=t/1e3;if(this.remainMs-=t,this.remainMs<=0){this.remainMs=0,this.finish(!1);return}this.angleDeg=l(this.angleDeg+this.dir*this.speedDeg*n),this.drawNeedle(),this.hitFlash.alpha>0&&(this.hitFlash.alpha=Math.max(0,this.hitFlash.alpha-3*n))}showResult(e){var t;(t=this.onGameEnd)==null||t.call(this,e.success,e.score)}drawRing(){const e=this.ring;e.clear(),e.lineStyle(10,1197401,1),e.drawCircle(this.cx,this.cy,this.R),e.lineStyle(2,8962256,.5),e.drawCircle(this.cx,this.cy,this.R*.75)}drawZone(){const e=this.R*.95,t=this.R*.65,n=this.zoneStart*p,a=(this.zoneStart+this.zoneSize)*p,o=this.perfectSize,r=(this.zoneStart+(this.zoneSize-o)/2)*p,z=(this.zoneStart+(this.zoneSize+o)/2)*p,c=this.zone;c.clear(),c.beginFill(9627303,.5),c.moveTo(this.cx+t*Math.cos(n),this.cy+t*Math.sin(n)),c.arc(this.cx,this.cy,e,n,a),c.lineTo(this.cx+t*Math.cos(a),this.cy+t*Math.sin(a)),c.arc(this.cx,this.cy,t,a,n,!0),c.closePath(),c.endFill();const d=this.perfectZone;d.clear(),d.beginFill(16769162,.9),d.moveTo(this.cx+t*Math.cos(r),this.cy+t*Math.sin(r)),d.arc(this.cx,this.cy,e,r,z),d.lineTo(this.cx+t*Math.cos(z),this.cy+t*Math.sin(z)),d.arc(this.cx,this.cy,t,z,r,!0),d.closePath(),d.endFill()}drawNeedle(){const e=this.needle,t=this.angleDeg*p,n=this.cx+Math.cos(t)*(this.R*.1),a=this.cy+Math.sin(t)*(this.R*.1),o=this.cx+Math.cos(t)*(this.R*1.02),r=this.cy+Math.sin(t)*(this.R*1.02);e.clear(),e.lineStyle(6,16777215,1),e.moveTo(this.cx,this.cy),e.lineTo(o,r),e.lineStyle(10,16777215,.2),e.moveTo(n,a),e.lineTo(this.cx,this.cy),e.beginFill(16777215),e.drawCircle(this.cx,this.cy,6),e.endFill()}onTap(){if(this.finished)return;const e=l(this.angleDeg),t=this.zoneStart,n=this.zoneStart+this.zoneSize,a=S(e,t,n),o=this.perfectSize/2,r=this.zoneStart+this.zoneSize/2-o,z=this.zoneStart+this.zoneSize/2+o,c=S(e,r,z);if(!a){this.combo=0,this.score=Math.max(0,this.score-150),this.flash(16734810),this.speedDeg=Math.max(120,this.speedDeg*.97);return}if(this.roundsDone++,c){this.combo++;const d=600+Math.min(8,this.combo)*80;this.score+=d,this.flash(16773542)}else this.combo=0,this.score+=300,this.flash(9627303);if(this.zoneSize=g(this.zoneSize*.985,10,120),this.speedDeg=g(this.speedDeg*1.02,100,420),this.roundsDone>=this.roundsNeeded){this.finish(!0);return}this.randomizeZone(this.rotatePolicy==="alternate")}randomizeZone(e){const t=this.angleDeg;let n=Math.random()*360;const a=20;for(let o=0;o<a;o++){const r=Math.random()*360;if(Math.abs(l(r-t))>25){n=r;break}}this.zoneStart=l(n),e&&(this.dir*=-1),this.drawZone()}flash(e){const t=this.hitFlash;t.clear(),t.beginFill(e,.35),t.drawCircle(this.cx,this.cy,this.R*1.08),t.endFill(),t.alpha=1}finish(e){var o;if(this.finished)return;this.finished=!0;const t=Math.round(this.remainMs/8),n=this.roundsDone*120,a=Math.max(0,this.score+t+n+(e?800:0));(o=this.onGameEnd)==null||o.call(this,e,a)}}export{b as TimingPerfectGame};
//# sourceMappingURL=TimingPerfectGame-11e42f7d.js.map
