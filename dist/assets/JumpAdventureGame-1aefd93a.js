var M=Object.defineProperty;var m=(h,r,s)=>r in h?M(h,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[r]=s;var i=(h,r,s)=>(m(h,typeof r!="symbol"?r+"":r,s),s);import{G as g,C as y,a as c}from"./index-a4c7ba8a.js";function b(h){return h==="easy"||h==="normal"||h==="hard"}function B(h){const r=h.difficulty;return b(r)?r:"normal"}function v(h,r){return typeof h=="number"&&isFinite(h)?Math.max(1e3,Math.round(h*1e3)):r}function p(h,r,s){return Math.max(r,Math.min(s,h))}class R extends g{constructor(s,o){super(s,o);i(this,"onGameEnd");i(this,"scene",new y);i(this,"finished",!1);i(this,"remainMs",3e4);i(this,"groundY",0);i(this,"worldSpeed",320);i(this,"spawnBaseMs",780);i(this,"spawnAccum",0);i(this,"player");i(this,"px",0);i(this,"py",0);i(this,"pw",50);i(this,"ph",58);i(this,"vy",0);i(this,"gravity",1600);i(this,"jumpVel",620);i(this,"holdBoostMs",140);i(this,"holdRemain",0);i(this,"holding",!1);i(this,"onGround",!0);i(this,"allowDouble",!1);i(this,"hasDouble",!0);i(this,"obstacles",[]);i(this,"speedMul",1);i(this,"sizeMul",1);i(this,"passed",0);i(this,"score",0);i(this,"colors",{bgTop:8900331,bgBottom:2063016,ground:989997,deco:16777215,player:16777215,obstacle:16347926,good:9627303,bad:16734810})}async createScene(){const s=this.settings,o=B(s),l=this.app.renderer.width,a=this.app.renderer.height;this.remainMs=v(s.duration,3e4),o==="easy"?(this.worldSpeed=300,this.spawnBaseMs=860,this.gravity=1500,this.jumpVel=600,this.holdBoostMs=170,this.speedMul=.95,this.sizeMul=.95,this.allowDouble=!0):o==="hard"?(this.worldSpeed=360,this.spawnBaseMs=680,this.gravity=1700,this.jumpVel=650,this.holdBoostMs=120,this.speedMul=1.1,this.sizeMul=1.1,this.allowDouble=!1):(this.worldSpeed=330,this.spawnBaseMs=760,this.gravity=1600,this.jumpVel=620,this.holdBoostMs=140,this.speedMul=1,this.sizeMul=1,this.allowDouble=!0),typeof s.speedPxPerSec=="number"&&isFinite(s.speedPxPerSec)&&(this.worldSpeed=p(Math.round(s.speedPxPerSec),180,520)),typeof s.spawnBaseMs=="number"&&isFinite(s.spawnBaseMs)&&(this.spawnBaseMs=p(Math.round(s.spawnBaseMs),220,2e3)),typeof s.gravity=="number"&&isFinite(s.gravity)&&(this.gravity=p(s.gravity,800,2600)),typeof s.jumpVel=="number"&&isFinite(s.jumpVel)&&(this.jumpVel=p(s.jumpVel,380,980)),typeof s.holdBoostMs=="number"&&isFinite(s.holdBoostMs)&&(this.holdBoostMs=p(Math.round(s.holdBoostMs),60,400)),typeof s.allowDouble=="boolean"&&(this.allowDouble=s.allowDouble),s.palette==="night"?(this.colors.bgTop=725024,this.colors.bgBottom=1382955,this.colors.ground=1053986,this.colors.deco=9741240):s.palette==="forest"?(this.colors.bgTop=1332013,this.colors.bgBottom=339478,this.colors.ground=732704,this.colors.obstacle=3462041):s.palette==="dawn"&&(this.colors.bgTop=16766629,this.colors.bgBottom=15817653,this.colors.ground=5908992,this.colors.obstacle=16746375),this.groundY=Math.floor(a*.78),this.pw=Math.min(70,Math.floor(l*.09)),this.ph=Math.floor(this.pw*1.1),this.px=Math.floor(l*.22),this.py=this.groundY-this.ph/2,this.vy=0,this.onGround=!0,this.hasDouble=this.allowDouble;const e=new c;e.beginFill(this.colors.bgTop),e.drawRect(0,0,l,Math.floor(a*.45)),e.endFill(),e.beginFill(this.colors.bgBottom),e.drawRect(0,Math.floor(a*.45),l,a),e.endFill(),this.scene.addChild(e);const n=new c;n.beginFill(this.colors.ground,1),n.drawRect(0,this.groundY,l,a-this.groundY),n.endFill();for(let t=0;t<6;t++){const d=new c;d.lineStyle(2,this.colors.deco,.25);const u=(t+1)*(l/7);d.moveTo(u,this.groundY),d.lineTo(u,a),this.scene.addChild(d)}this.scene.addChild(n),this.player=new c,this.drawPlayer(),this.scene.addChild(this.player),this.scene.eventMode="static",this.scene.on("pointerdown",t=>{t.stopPropagation(),this.onDown()}),this.scene.on("pointerup",t=>{t.stopPropagation(),this.onUp()}),this.scene.on("pointerupoutside",t=>{t.stopPropagation(),this.onUp()}),this.container.addChild(this.scene)}handleInput(s){}updateGame(s){if(this.finished)return;const o=s*(1e3/60),l=o/1e3;if(this.app.renderer.height,this.remainMs-=o,this.remainMs<=0){this.remainMs=0,this.finish(!0);return}this.spawnAccum+=o;const a=this.spawnBaseMs/this.speedMul;for(;this.spawnAccum>=a;)this.spawnAccum-=a,this.spawnObstacle(),this.speedMul=Math.min(1.5,this.speedMul*1.01);if(this.holding&&this.holdRemain>0){const t=Math.min(this.holdRemain,o);this.vy-=this.gravity*.5*(t/1e3),this.holdRemain-=t}this.vy+=this.gravity*l,this.py+=this.vy*l,this.py+this.ph/2>=this.groundY?(this.py=this.groundY-this.ph/2,this.vy=0,this.onGround||(this.onGround=!0,this.hasDouble=this.allowDouble)):this.onGround=!1,this.drawPlayer();const n=[];for(const t of this.obstacles){if(t.x-=this.worldSpeed*this.speedMul*l,t.g.x=t.x,this.intersectAABB(this.px-this.pw/2,this.py-this.ph/2,this.pw,this.ph,t.x-t.w/2,t.y-t.h/2,t.w,t.h)){this.finish(!1);return}t.x+t.w/2<this.px-this.pw/2&&!t.__counted&&(t.__counted=!0,this.passed++,this.score+=30),t.x+t.w/2>-20?n.push(t):this.scene.removeChild(t.g)}this.obstacles=n}showResult(s){var o;(o=this.onGameEnd)==null||o.call(this,s.success,s.score)}drawPlayer(){const s=this.player;s.clear(),s.beginFill(this.colors.player,.95),s.drawRoundedRect(this.px-this.pw/2,this.py-this.ph/2,this.pw,this.ph,12),s.endFill(),s.beginFill(1118481,.9),s.drawCircle(this.px+this.pw*.18,this.py-this.ph*.15,Math.max(2,Math.floor(this.pw*.07))),s.endFill()}tryJump(){this.onGround?(this.vy=-this.jumpVel,this.holdRemain=this.holdBoostMs,this.onGround=!1):this.allowDouble&&this.hasDouble&&(this.vy=-this.jumpVel*.9,this.holdRemain=Math.floor(this.holdBoostMs*.6),this.hasDouble=!1)}onDown(){this.finished||(this.holding=!0,this.tryJump())}onUp(){this.finished||(this.holding=!1,this.holdRemain=0)}spawnObstacle(){const s=this.app.renderer.width,o=Math.random(),l=Math.max(24,Math.floor(this.ph*(.5+Math.random()*.9)*this.sizeMul)),a=Math.max(24,Math.floor(this.pw*(.8+Math.random()*.9)*this.sizeMul)),e=p(l,20,this.ph*1.4),n=p(a,24,this.pw*1.6),t=new c;t.beginFill(this.colors.obstacle,.95);let d=s+n/2+10,u=this.groundY-e/2;if(o>.7){const f=Math.floor(e*.6),w=Math.floor(n*.8);t.drawRoundedRect(-n/2,-e/2,n,e,8),t.drawRoundedRect(-w/2,-e/2-f-6,w,f,8),u=this.groundY-(e+f+6)/2}else t.drawRoundedRect(-n/2,-e/2,n,e,8);t.x=d,t.y=u,this.scene.addChild(t),this.obstacles.push({g:t,x:d,y:u,w:n,h:e,vx:-this.worldSpeed})}intersectAABB(s,o,l,a,e,n,t,d){return s<e+t&&s+l>e&&o<n+d&&o+a>n}finish(s){var e;if(this.finished)return;this.finished=!0;const o=Math.round(this.remainMs/8),l=this.passed*25,a=Math.max(0,this.score+o+l+(s?800:0));(e=this.onGameEnd)==null||e.call(this,s,a)}}export{R as JumpAdventureGame};
//# sourceMappingURL=JumpAdventureGame-1aefd93a.js.map
