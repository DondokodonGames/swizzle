var M=Object.defineProperty;var w=(s,n,e)=>n in s?M(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var c=(s,n,e)=>(w(s,typeof n!="symbol"?n+"":n,e),e);import{G as g,C as x,a as y,S,T as b}from"./index-a4c7ba8a.js";function v(s){return s==="easy"||s==="normal"||s==="hard"}function C(s){const n=s.difficulty;return v(n)?n:"normal"}function B(s,n,e){const t=s==null?void 0:s[n];return typeof t=="number"&&isFinite(t)?Math.max(1e3,Math.round(t*1e3)):e}function G(s,n,e,t,r){const a=t??s.renderer.width,d=r??s.renderer.height,h=document.createElement("canvas");h.width=a,h.height=d;const l=h.getContext("2d"),o=l.createLinearGradient(0,0,0,d),p=i=>`#${i.toString(16).padStart(6,"0")}`;return o.addColorStop(0,p(n)),o.addColorStop(1,p(e)),l.fillStyle=o,l.fillRect(0,0,a,d),new S(b.from(h))}function f(s,n,e){return Math.max(n,Math.min(e,s))}class R extends g{constructor(e,t){super(e,t);c(this,"onGameEnd");c(this,"scene",new x);c(this,"player");c(this,"obstacles",[]);c(this,"finished",!1);c(this,"remainMs",3e4);c(this,"spawnAccumMs",0);c(this,"spawnBaseMs",650);c(this,"targetX",0);c(this,"playerSpeed",600);c(this,"playerRadius",22);c(this,"diffMul",1)}async createScene(){const e=this.settings,t=C(e);this.remainMs=B(e,"duration",3e4),this.spawnBaseMs=typeof e.spawnBaseMs=="number"&&isFinite(e.spawnBaseMs)?Math.max(50,Math.round(e.spawnBaseMs)):650,this.playerSpeed=typeof e.playerSpeed=="number"&&isFinite(e.playerSpeed)?e.playerSpeed:600,t==="easy"?this.diffMul=.85:t==="hard"?this.diffMul=1.25:this.diffMul=1;const r=this.app.renderer.width,a=this.app.renderer.height,d=G(this.app,959977,142404);this.scene.addChild(d),this.player=new y,this.player.beginFill(16777215),this.player.drawCircle(0,0,this.playerRadius),this.player.endFill(),this.player.x=r/2,this.player.y=a-80,this.targetX=this.player.x,this.scene.addChild(this.player);const h=o=>{const p=o.global;this.targetX=f(p.x,20,r-20)},l=o=>h(o);this.scene.eventMode="static",this.scene.on("pointermove",h),this.scene.on("pointerdown",l),this.container.addChild(this.scene)}handleInput(e){}updateGame(e){if(this.finished)return;const t=e*(1e3/60),r=t/1e3,a=this.app.renderer.width,d=this.app.renderer.height;if(this.remainMs-=t,this.remainMs<=0){this.remainMs=0,this.finish(!0);return}this.spawnAccumMs+=t;const h=this.spawnBaseMs/this.diffMul;for(;this.spawnAccumMs>=h;)this.spawnAccumMs-=h,this.spawnObstacle(a);const l=this.targetX-this.player.x,o=this.playerSpeed*r;Math.abs(l)<=o?this.player.x=this.targetX:this.player.x+=Math.sign(l)*o;const p=[];for(const i of this.obstacles){if(i.g.x+=i.vx*r,i.g.y+=i.vy*r,(i.g.x<i.w/2||i.g.x>a-i.w/2)&&(i.vx*=-1),this.hitCircleAABB(this.player.x,this.player.y,this.playerRadius,i)){this.finish(!1);return}i.g.y-i.h/2<=d+10?p.push(i):this.scene.removeChild(i.g)}this.obstacles=p}showResult(e){var t;(t=this.onGameEnd)==null||t.call(this,e.success,e.score)}spawnObstacle(e){const t=new y,r=36+Math.random()*50,a=18+Math.random()*32;t.beginFill(16769162),t.drawRoundedRect(-r/2,-a/2,r,a,6),t.endFill(),t.x=30+Math.random()*(e-60),t.y=-40;const d=220*this.diffMul+Math.random()*180*this.diffMul,h=(Math.random()-.5)*160*(.7+.6*Math.random());this.scene.addChild(t),this.obstacles.push({g:t,vx:h,vy:d,w:r,h:a})}hitCircleAABB(e,t,r,a){const d=a.g.x,h=a.g.y,l=a.w/2,o=a.h/2,p=f(e,d-l,d+l),i=f(t,h-o,h+o),u=e-p,m=t-i;return u*u+m*m<=r*r}finish(e){if(this.finished)return;this.finished=!0;const t=Math.round(e?1e3+this.remainMs/10:500+this.remainMs/20);this.showResult({success:e,score:t})}}export{R as QuickDodgeGame};
//# sourceMappingURL=QuickDodgeGame-f6072646.js.map
