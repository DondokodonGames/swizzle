var C=Object.defineProperty;var S=(i,h,t)=>h in i?C(i,h,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[h]=t;var a=(i,h,t)=>(S(i,typeof h!="symbol"?h+"":h,t),t);import{G,C as v,a as M,S as B,T as F}from"./index-a4c7ba8a.js";function R(i){return i==="easy"||i==="normal"||i==="hard"}function H(i){const h=i.difficulty;return R(h)?h:"normal"}function T(i,h){return typeof i=="number"&&isFinite(i)?Math.max(1e3,Math.round(i*1e3)):h}function W(i,h,t,n,e){const o=n??i.renderer.width,d=e??i.renderer.height,r=document.createElement("canvas");r.width=o,r.height=d;const l=r.getContext("2d"),c=l.createLinearGradient(0,0,0,d),f=m=>`#${m.toString(16).padStart(6,"0")}`;return c.addColorStop(0,f(h)),c.addColorStop(1,f(t)),l.fillStyle=c,l.fillRect(0,0,o,d),new B(F.from(r))}function u(i,h,t){return Math.max(h,Math.min(t,i))}class E extends G{constructor(t,n){super(t,n);a(this,"onGameEnd");a(this,"scene",new v);a(this,"basket");a(this,"basketW",140);a(this,"basketH",24);a(this,"targetX",0);a(this,"playerSpeed",700);a(this,"items",[]);a(this,"finished",!1);a(this,"remainMs",3e4);a(this,"spawnAccum",0);a(this,"spawnBaseMs",700);a(this,"goodNeeded",12);a(this,"goodCount",0);a(this,"badCount",0);a(this,"badRatio",.35);a(this,"diffMul",1);a(this,"maxBad",2)}async createScene(){const t=this.settings,n=H(t);this.remainMs=T(t.duration,3e4),this.spawnBaseMs=typeof t.spawnBaseMs=="number"&&isFinite(t.spawnBaseMs)?Math.max(50,Math.round(t.spawnBaseMs)):700,this.playerSpeed=typeof t.playerSpeed=="number"&&isFinite(t.playerSpeed)?t.playerSpeed:700,this.badRatio=typeof t.badRatio=="number"&&isFinite(t.badRatio)?u(t.badRatio,0,1):.35,n==="easy"?(this.diffMul=.85,this.maxBad=3,this.goodNeeded=10):n==="hard"?(this.diffMul=1.25,this.maxBad=1,this.goodNeeded=14):(this.diffMul=1,this.maxBad=2,this.goodNeeded=12),typeof t.targetGood=="number"&&isFinite(t.targetGood)&&(this.goodNeeded=Math.max(1,Math.round(t.targetGood)));const e=this.app.renderer.width,o=this.app.renderer.height,d=W(this.app,1332013,339478);this.scene.addChild(d),this.basket=new M,this.basket.beginFill(16777215,.95),this.basket.drawRoundedRect(-this.basketW/2,-this.basketH/2,this.basketW,this.basketH,10),this.basket.endFill(),this.basket.x=e/2,this.basket.y=o-70,this.targetX=this.basket.x,this.scene.addChild(this.basket);const r=c=>{const f=c.global;this.targetX=u(f.x,this.basketW/2+10,e-this.basketW/2-10)},l=c=>r(c);this.scene.eventMode="static",this.scene.on("pointermove",r),this.scene.on("pointerdown",l),this.container.addChild(this.scene)}handleInput(t){}updateGame(t){if(this.finished)return;const n=t*(1e3/60),e=n/1e3,o=this.app.renderer.width,d=this.app.renderer.height;if(this.remainMs-=n,this.remainMs<=0){this.remainMs=0,this.finish(this.goodCount>=this.goodNeeded);return}this.spawnAccum+=n;const r=this.spawnBaseMs/this.diffMul;for(;this.spawnAccum>=r;)this.spawnAccum-=r,this.spawnItem(o);const l=this.targetX-this.basket.x,c=this.playerSpeed*e;Math.abs(l)<=c?this.basket.x=this.targetX:this.basket.x+=Math.sign(l)*c;const f=this.basket.x-this.basketW/2,m=this.basket.x+this.basketW/2,x=this.basket.y-this.basketH/2,y=this.basket.y+this.basketH/2,p=[];for(const s of this.items){s.x+=s.vx*e,s.y+=s.vy*e,s.g.x=s.x,s.g.y=s.y;const k=u(s.x,f,m),w=u(s.y,x,y),b=s.x-k,g=s.y-w;if(b*b+g*g<=s.r*s.r){if(s.good?this.goodCount++:this.badCount++,this.scene.removeChild(s.g),s.good&&this.goodCount>=this.goodNeeded){this.finish(!0);return}if(!s.good&&this.badCount>this.maxBad){this.finish(!1);return}continue}if(s.y-s.r>d+10){this.scene.removeChild(s.g);continue}p.push(s)}this.items=p}showResult(t){var n;(n=this.onGameEnd)==null||n.call(this,t.success,t.score)}spawnItem(t){const n=Math.random()>this.badRatio,e=new M;let o=18+Math.random()*10;n?(e.beginFill(16773542),e.drawCircle(0,0,o),e.endFill()):(o=20,e.beginFill(16734810),e.moveTo(0,-o),e.lineTo(o*.9,o),e.lineTo(-o*.9,o),e.lineTo(0,-o),e.endFill());const d=20+Math.random()*(t-40),r=-30;e.x=d,e.y=r;const l=(n?260:300)*this.diffMul+Math.random()*120*this.diffMul,c=(Math.random()-.5)*60;this.scene.addChild(e),this.items.push({g:e,good:n,x:d,y:r,r:o,vx:c,vy:l})}finish(t){var d;if(this.finished)return;this.finished=!0;const n=this.goodCount*100-this.badCount*200,e=Math.round(this.remainMs/20),o=Math.max(0,n+e+(t?500:0));(d=this.onGameEnd)==null||d.call(this,t,o)}}export{E as CollectItemsGame};
//# sourceMappingURL=CollectItemsGame-402277c3.js.map
