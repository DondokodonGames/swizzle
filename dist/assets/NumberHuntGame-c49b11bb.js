var R=Object.defineProperty;var y=(o,h,t)=>h in o?R(o,h,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[h]=t;var e=(o,h,t)=>(y(o,typeof h!="symbol"?h+"":h,t),t);import{G as B,C as w,a as M,b as T}from"./index-a4c7ba8a.js";function H(o){return o==="easy"||o==="normal"||o==="hard"}function C(o){const h=o.difficulty;return H(h)?h:"normal"}function W(o,h){return typeof o=="number"&&isFinite(o)?Math.max(1e3,Math.round(o*1e3)):h}function d(o,h,t){return Math.max(h,Math.min(t,o))}function k(o){for(let h=o.length-1;h>0;h--){const t=Math.random()*(h+1)|0;[o[h],o[t]]=[o[t],o[h]]}return o}class S extends B{constructor(t,s){super(t,s);e(this,"onGameEnd");e(this,"scene",new w);e(this,"finished",!1);e(this,"remainMs",3e4);e(this,"titleText");e(this,"infoText");e(this,"promptText");e(this,"timeBar");e(this,"tiles",[]);e(this,"cols",4);e(this,"rows",4);e(this,"tileW",120);e(this,"tileH",120);e(this,"gapX",16);e(this,"gapY",16);e(this,"roundsNeeded",8);e(this,"roundsDone",0);e(this,"missesAllowed",3);e(this,"misses",0);e(this,"digitsMax",9);e(this,"targetsPerRound",null);e(this,"currentTarget",0);e(this,"remainingTargets",0);e(this,"roundTimeMs",3e3);e(this,"roundRemain",3e3);e(this,"awaiting",!1);e(this,"score",0);e(this,"combo",0);e(this,"colors",{bgTop:725024,bgBottom:1382955,tile:16777215,tileText:1776411,good:9627303,bad:16734810,barBack:3621201,barFill:3900150,text:16777215})}async createScene(){const t=this.settings,s=C(t),n=this.app.renderer.width,i=this.app.renderer.height;this.remainMs=W(t.duration,3e4),s==="easy"?(this.roundsNeeded=6,this.cols=3,this.rows=3,this.digitsMax=6,this.missesAllowed=4,this.roundTimeMs=3600):s==="hard"?(this.roundsNeeded=10,this.cols=5,this.rows=5,this.digitsMax=9,this.missesAllowed=2,this.roundTimeMs=2800):(this.roundsNeeded=8,this.cols=4,this.rows=4,this.digitsMax=8,this.missesAllowed=3,this.roundTimeMs=3200),typeof t.rounds=="number"&&isFinite(t.rounds)&&(this.roundsNeeded=d(Math.round(t.rounds),3,30)),typeof t.gridCols=="number"&&isFinite(t.gridCols)&&(this.cols=d(Math.round(t.gridCols),3,6)),typeof t.gridRows=="number"&&isFinite(t.gridRows)&&(this.rows=d(Math.round(t.gridRows),3,6)),typeof t.digitsMax=="number"&&isFinite(t.digitsMax)&&(this.digitsMax=d(Math.round(t.digitsMax),3,9)),typeof t.targetsPerRound=="number"&&isFinite(t.targetsPerRound)&&(this.targetsPerRound=d(Math.round(t.targetsPerRound),1,Math.max(1,Math.floor(this.cols*this.rows*.5)))),typeof t.roundTimeMs=="number"&&isFinite(t.roundTimeMs)&&(this.roundTimeMs=d(Math.round(t.roundTimeMs),1200,6e3)),typeof t.missesAllowed=="number"&&isFinite(t.missesAllowed)&&(this.missesAllowed=d(Math.round(t.missesAllowed),0,10)),t.palette==="forest"?(this.colors.bgTop=732704,this.colors.bgBottom=201999,this.colors.barFill=3462041):t.palette==="sunset"&&(this.colors.bgTop=3152180,this.colors.bgBottom=1706782,this.colors.barFill=16739179);const a=new M;a.beginFill(this.colors.bgTop),a.drawRect(0,0,n,Math.floor(i*.45)),a.endFill(),a.beginFill(this.colors.bgBottom),a.drawRect(0,Math.floor(i*.45),n,i),a.endFill(),this.scene.addChild(a),this.titleText=new T("Number Hunt",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(n,i)*.06),fill:this.colors.text,stroke:0,strokeThickness:5}),this.titleText.anchor.set(.5),this.titleText.x=n/2,this.titleText.y=Math.floor(i*.2),this.scene.addChild(this.titleText),this.infoText=new T("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(n,i)*.045),fill:this.colors.text,stroke:0,strokeThickness:4}),this.infoText.anchor.set(.5),this.infoText.x=n/2,this.infoText.y=Math.floor(i*.27),this.scene.addChild(this.infoText),this.updateInfo(),this.promptText=new T("Ready?",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(n,i)*.09),fill:this.colors.text,stroke:0,strokeThickness:6}),this.promptText.anchor.set(.5),this.promptText.x=n/2,this.promptText.y=Math.floor(i*.36),this.scene.addChild(this.promptText),this.timeBar=new M,this.scene.addChild(this.timeBar);const r=n-80,l=i-Math.floor(i*.5)-40;this.tileW=Math.min(200,Math.floor(r/this.cols)-16),this.tileH=Math.min(160,Math.floor(l/this.rows)-16),this.gapX=Math.max(12,Math.floor((r-this.cols*this.tileW)/(this.cols+1))),this.gapY=Math.max(10,Math.floor((l-this.rows*this.tileH)/(this.rows+1)));const f=Math.floor(i*.52),b=(n-(this.cols*this.tileW+(this.cols-1)*this.gapX))/2+this.tileW/2;for(let m=0;m<this.rows;m++)for(let g=0;g<this.cols;g++){const p=m*this.cols+g,c=new w,u=new M;u.beginFill(this.colors.tile,.96),u.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),u.endFill();const x=new T("",{fontFamily:"sans-serif",fontSize:Math.floor(this.tileH*.5),fill:this.colors.tileText});x.anchor.set(.5),c.addChild(u,x),c.eventMode="static",c.on("pointertap",F=>{F.stopPropagation(),this.onTap(p)}),c.x=b+g*(this.tileW+this.gapX),c.y=f+m*(this.tileH+this.gapY),this.scene.addChild(c),this.tiles.push({root:c,bg:u,label:x,value:0,found:!1,index:p})}this.container.addChild(this.scene),this.nextRound(!0)}handleInput(t){}updateGame(t){if(this.finished)return;const s=t*(1e3/60);if(this.remainMs-=s,this.remainMs<=0){this.remainMs=0,this.finish(this.roundsDone>=this.roundsNeeded);return}this.awaiting&&(this.roundRemain-=s,this.drawTimeBar(),this.roundRemain<=0&&this.registerMiss("timeout"))}showResult(t){var s;(s=this.onGameEnd)==null||s.call(this,t.success,t.score)}updateInfo(){const t=Math.ceil(this.remainMs/1e3);this.infoText.text=`Round ${this.roundsDone}/${this.roundsNeeded}   Miss ${this.misses}/${this.missesAllowed}   Time ${t}s`}drawTimeBar(){const t=this.app.renderer.width,s=Math.floor(this.app.renderer.height*.47),n=Math.floor(t*.7),i=Math.floor((t-n)/2),a=10,r=d(this.roundRemain/this.roundTimeMs,0,1);this.timeBar.clear(),this.timeBar.beginFill(this.colors.barBack,.4),this.timeBar.drawRoundedRect(i,s,n,a,6),this.timeBar.endFill(),this.timeBar.beginFill(this.colors.barFill,.95),this.timeBar.drawRoundedRect(i,s,Math.floor(n*r),a,6),this.timeBar.endFill()}nextRound(t=!1){this.currentTarget=Math.random()*(this.digitsMax+1)|0;const s=this.cols*this.rows,n=d(Math.round(s*(.18+Math.random()*.12)),1,Math.max(1,Math.floor(s*.4)));this.remainingTargets=this.targetsPerRound??n;const i=Array.from({length:s},(r,l)=>l);k(i);const a=i.slice(0,this.remainingTargets);for(let r=0;r<this.tiles.length;r++){const l=this.tiles[r];if(l.found=!1,l.bg.clear(),l.bg.beginFill(this.colors.tile,.96),l.bg.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),l.bg.endFill(),a.includes(r))l.value=this.currentTarget;else{let f=Math.random()*(this.digitsMax+1)|0;f===this.currentTarget&&(f=(f+1+(Math.random()*this.digitsMax|0))%(this.digitsMax+1)),l.value=f}l.label.text=String(l.value),l.label.style={fontFamily:"sans-serif",fontSize:Math.floor(this.tileH*.5),fill:this.colors.tileText}}this.promptText.text=`Find all ${this.currentTarget}!`,this.roundRemain=this.roundTimeMs,this.awaiting=!0,this.drawTimeBar(),t||this.updateInfo()}onTap(t){if(!this.awaiting||this.finished)return;const s=this.tiles[t];if(s.found)return;if(s.value===this.currentTarget){s.found=!0,this.remainingTargets--,this.combo++;const i=d(this.roundRemain/this.roundTimeMs,0,1),a=120,r=Math.min(10,this.combo)*20,l=Math.round(60*i);this.score+=a+r+l,this.flashTile(s,this.colors.good),s.label.style={fontFamily:"sans-serif",fontSize:Math.floor(this.tileH*.5),fill:1003826},this.remainingTargets<=0&&(this.awaiting=!1,this.roundsDone++,this.roundsDone>=this.roundsNeeded?this.finish(!0):setTimeout(()=>this.nextRound(),160))}else this.registerMiss("wrong",t)}registerMiss(t,s=null){!this.awaiting||this.finished||(this.awaiting=!1,this.combo=0,this.misses++,this.score=Math.max(0,this.score-150),s!=null&&this.flashTile(this.tiles[s],this.colors.bad),this.misses>this.missesAllowed?this.finish(!1):setTimeout(()=>this.nextRound(),220))}flashTile(t,s,n=.28){const i=new M;i.beginFill(s,n),i.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),i.endFill(),i.x=t.root.x,i.y=t.root.y,this.scene.addChild(i);const a=8;for(let r=1;r<=a;r++)setTimeout(()=>{i.alpha=Math.max(0,n*(1-r/a)),r===a&&this.scene.removeChild(i)},r*30)}finish(t){var r;if(this.finished)return;this.finished=!0;const s=Math.round(this.remainMs/8),n=this.roundsDone*70,i=this.misses*120,a=Math.max(0,this.score+s+n-i+(t?700:0));(r=this.onGameEnd)==null||r.call(this,t,a)}}export{S as NumberHuntGame};
//# sourceMappingURL=NumberHuntGame-c49b11bb.js.map
