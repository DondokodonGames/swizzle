var ie=Object.defineProperty;var ne=(t,l,i)=>l in t?ie(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i;var W=(t,l,i)=>(ne(t,typeof l!="symbol"?l+"":l,i),i);import{r as u,j as e}from"./index-a4c7ba8a.js";const v={IMAGE:{BACKGROUND_FRAME_MAX_SIZE:2*1024*1024,BACKGROUND_TOTAL_MAX_SIZE:8*1024*1024,OBJECT_FRAME_MAX_SIZE:1*1024*1024,OBJECT_TOTAL_MAX_SIZE:8*1024*1024,MAX_WIDTH:2048,MAX_HEIGHT:2048,MIN_WIDTH:32,MIN_HEIGHT:32,SUPPORTED_FORMATS:["image/jpeg","image/png","image/webp"],COMPRESSION_QUALITY:.8,AUTO_RESIZE_THRESHOLD:1920},AUDIO:{BGM_MAX_SIZE:5*1024*1024,BGM_MAX_DURATION:30,SE_MAX_SIZE:1*1024*1024,SE_MAX_DURATION:10,SUPPORTED_FORMATS:["audio/mp3","audio/wav","audio/ogg"],DEFAULT_COMPRESSION:128,SAMPLE_RATE:44100},TEXT:{MAX_LENGTH:8,MAX_COUNT:5,MIN_FONT_SIZE:12,MAX_FONT_SIZE:72},PROJECT:{TOTAL_MAX_SIZE:50*1024*1024,MAX_OBJECTS:15,MAX_SE_COUNT:15,MAX_RULES:50,MAX_FLAGS:20,MAX_TEXTS:5,AUTO_SAVE_INTERVAL:3e4,VERSION_HISTORY_COUNT:10},PERFORMANCE:{MAX_ANIMATION_FPS:30,MAX_PARTICLES:100,MAX_CONCURRENT_SOUNDS:8,SCRIPT_EXECUTION_TIMEOUT:5e3},GAME_SETTINGS:{NAME_MIN_LENGTH:1,NAME_MAX_LENGTH:50,DESCRIPTION_MAX_LENGTH:200,DURATION_OPTIONS:[5,10,15,20,30],MAX_UNLIMITED_SECONDS:300,DIFFICULTY_LEVELS:["easy","normal","hard"],MAX_TAGS:10,MAX_SCREENSHOTS:5},TEST_PLAY:{MAX_DURATION:60,SIMULATION_TIME:3e3,SUCCESS_PROBABILITY:.7,TIMEOUT_MESSAGE:"ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ"},PUBLISHING:{MIN_ASSETS_COUNT:1,MIN_RULES_OR_CONDITIONS:0,VISIBILITY_OPTIONS:["public","unlisted","private"],THUMBNAIL_WIDTH:300,THUMBNAIL_HEIGHT:400,EXPORT_FORMATS:["json","zip"]},SCRIPT:{MAX_CONDITIONS_PER_RULE:10,MAX_ACTIONS_PER_RULE:10,MAX_RULE_NAME_LENGTH:30,MAX_FLAG_NAME_LENGTH:20,MAX_SUCCESS_CONDITIONS:5,MAX_MOVEMENT_SPEED:1e3,MAX_MOVEMENT_DURATION:10,MAX_EFFECT_DURATION:5,MAX_ORBIT_RADIUS:200,COMPLEXITY_THRESHOLD:80,MAX_CONCURRENT_RULES:20}},se=[{type:"touch",label:"ã‚¿ãƒƒãƒã—ãŸã¨ã",icon:"ğŸ‘†",color:"bg-blue-100"},{type:"time",label:"â—‹ç§’å¾Œ",icon:"â°",color:"bg-green-100"},{type:"collision",label:"ã¶ã¤ã‹ã£ãŸã¨ã",icon:"ğŸ’¥",color:"bg-red-100"},{type:"animation",label:"ã‚¢ãƒ‹ãƒ¡çµ‚äº†æ™‚",icon:"ğŸ¬",color:"bg-purple-100"},{type:"flag",label:"ãƒ•ãƒ©ã‚°ãŒONã®ã¨ã",icon:"ğŸš©",color:"bg-yellow-100"}],ae=[{type:"move",label:"ç§»å‹•ã™ã‚‹",icon:"ğŸƒ",color:"bg-cyan-100"},{type:"playSound",label:"éŸ³ã‚’é³´ã‚‰ã™",icon:"ğŸ”Š",color:"bg-indigo-100"},{type:"success",label:"ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢!",icon:"ğŸ‰",color:"bg-emerald-100"},{type:"failure",label:"ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼",icon:"ğŸ’€",color:"bg-rose-100"},{type:"switchAnimation",label:"ã‚¢ãƒ‹ãƒ¡å¤‰æ›´",icon:"ğŸ”„",color:"bg-orange-100"},{type:"show",label:"è¡¨ç¤ºã™ã‚‹",icon:"ğŸ‘ï¸",color:"bg-teal-100"},{type:"hide",label:"éš ã™",icon:"ğŸ«¥",color:"bg-gray-100"}],H=t=>{if(t===0)return"0 B";const l=1024,i=["B","KB","MB","GB"],d=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,d)).toFixed(2))+" "+i[d]},oe=async(t,l,i,d=.8)=>new Promise((c,g)=>{const b=document.createElement("canvas"),m=b.getContext("2d"),f=new Image;f.onload=()=>{let{width:N,height:h}=f;if(N>l||h>i){const A=Math.min(l/N,i/h);N*=A,h*=A}b.width=N,b.height=h,m.fillStyle="white",m.fillRect(0,0,N,h),m.drawImage(f,0,0,N,h),b.toBlob(A=>{A?c(A):g(new Error("Canvas to blob conversion failed"))},"image/webp",d)},f.onerror=()=>g(new Error("Image load failed")),f.src=URL.createObjectURL(t)}),de=({project:t,onProjectUpdate:l})=>{const[i,d]=u.useState("background"),[c,g]=u.useState("none");u.useState(null);const[b,m]=u.useState(!1),[f,N]=u.useState(!1),[h,A]=u.useState(""),[T,j]=u.useState("#000000"),[S,E]=u.useState(24),[I,U]=u.useState("normal"),_=u.useRef(null);u.useRef(null);const p=u.useCallback(()=>{let a=0;return t.assets.background&&(a+=t.assets.background.totalSize),t.assets.objects.forEach(s=>a+=s.totalSize),a},[t.assets]),M=p(),P=M/v.PROJECT.TOTAL_MAX_SIZE*100,z=u.useCallback(async a=>{if(!f){N(!0);try{const s=a[0];if(!s||!s.type.startsWith("image/")){alert("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");return}const r=i==="background"?v.IMAGE.BACKGROUND_FRAME_MAX_SIZE:v.IMAGE.OBJECT_FRAME_MAX_SIZE;if(s.size>r){alert(`ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ã€‚æœ€å¤§${H(r)}ã¾ã§å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚`);return}const w=await oe(s,i==="background"?1080:512,i==="background"?1920:512,.8),y=new FileReader;y.onload=O=>{var K,J,Z;const L=(K=O.target)==null?void 0:K.result,C={id:crypto.randomUUID(),dataUrl:L,originalName:s.name,width:i==="background"?1080:512,height:i==="background"?1920:512,fileSize:(w==null?void 0:w.size)||s.size,uploadedAt:new Date().toISOString()},D=new Date().toISOString(),k={...t.assets};if(i==="background")k.background={id:crypto.randomUUID(),name:"Background",frames:[C],animationSettings:{speed:10,loop:!0,pingPong:!1,autoStart:!0},totalSize:C.fileSize,createdAt:D,lastModified:D};else if(i==="objects"){const Y={id:crypto.randomUUID(),name:`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ${k.objects.length+1}`,frames:[C],animationSettings:{speed:10,loop:!0,pingPong:!1,autoStart:!0},totalSize:C.fileSize,createdAt:D,lastModified:D,defaultScale:1,defaultOpacity:1};k.objects.push(Y)}const B=k.objects.reduce((Y,ee)=>Y+ee.totalSize,0)+(((J=k.background)==null?void 0:J.totalSize)||0),$=(((Z=k.audio.bgm)==null?void 0:Z.fileSize)||0)+k.audio.se.reduce((Y,ee)=>Y+ee.fileSize,0);k.statistics={totalImageSize:B,totalAudioSize:$,totalSize:B+$,usedSlots:{background:k.background?1:0,objects:k.objects.length,texts:k.texts.length,bgm:k.audio.bgm?1:0,se:k.audio.se.length},limitations:{isNearImageLimit:B>v.IMAGE.BACKGROUND_TOTAL_MAX_SIZE*.8,isNearAudioLimit:$>v.AUDIO.BGM_MAX_SIZE*.8,isNearTotalLimit:B+$>v.PROJECT.TOTAL_MAX_SIZE*.8,hasViolations:!1}},k.lastModified=D,l({...t,assets:k,totalSize:B+$,lastModified:D})},y.readAsDataURL(w||s)}catch(s){console.error("ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",s),alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{N(!1)}}},[i,t,l,f,p]),X=u.useCallback(()=>{var O,L;if(t.assets.texts.length>=v.TEXT.MAX_COUNT){alert(`ãƒ†ã‚­ã‚¹ãƒˆã¯æœ€å¤§${v.TEXT.MAX_COUNT}å€‹ã¾ã§è¿½åŠ ã§ãã¾ã™`);return}if(!h.trim()){alert("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return}if(h.length>v.TEXT.MAX_LENGTH){alert(`ãƒ†ã‚­ã‚¹ãƒˆã¯${v.TEXT.MAX_LENGTH}æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„`);return}const a=new Date().toISOString(),s={id:crypto.randomUUID(),content:h.trim(),style:{fontSize:S,color:T,fontWeight:I,fontFamily:"Inter, sans-serif"},createdAt:a,lastModified:a},r={...t.assets};r.texts.push(s),r.lastModified=a;const w=r.objects.reduce((C,D)=>C+D.totalSize,0)+(((O=r.background)==null?void 0:O.totalSize)||0),y=(((L=r.audio.bgm)==null?void 0:L.fileSize)||0)+r.audio.se.reduce((C,D)=>C+D.fileSize,0);r.statistics={totalImageSize:w,totalAudioSize:y,totalSize:w+y,usedSlots:{background:r.background?1:0,objects:r.objects.length,texts:r.texts.length,bgm:r.audio.bgm?1:0,se:r.audio.se.length},limitations:{isNearImageLimit:!1,isNearAudioLimit:!1,isNearTotalLimit:!1,hasViolations:!1}},l({...t,assets:r,lastModified:a}),A(""),g("none")},[h,T,S,I,t,l]),R=u.useCallback((a,s)=>{var C,D;const r={...t.assets};let w=0;const y=new Date().toISOString();if(a==="background")r.background&&(w=r.background.totalSize,r.background=null);else if(a==="objects"&&s){const k=r.objects.findIndex(B=>B.id===s);k>=0&&(w=r.objects[k].totalSize,r.objects.splice(k,1))}else if(a==="texts"&&s){const k=r.texts.findIndex(B=>B.id===s);k>=0&&r.texts.splice(k,1)}const O=r.objects.reduce((k,B)=>k+B.totalSize,0)+(((C=r.background)==null?void 0:C.totalSize)||0),L=(((D=r.audio.bgm)==null?void 0:D.fileSize)||0)+r.audio.se.reduce((k,B)=>k+B.fileSize,0);r.statistics={totalImageSize:O,totalAudioSize:L,totalSize:O+L,usedSlots:{background:r.background?1:0,objects:r.objects.length,texts:r.texts.length,bgm:r.audio.bgm?1:0,se:r.audio.se.length},limitations:{isNearImageLimit:!1,isNearAudioLimit:!1,isNearTotalLimit:!1,hasViolations:!1}},r.lastModified=y,l({...t,assets:r,totalSize:t.totalSize-w,lastModified:y})},[t,l]),n=a=>{a.preventDefault(),m(!0)},x=()=>{m(!1)},o=a=>{a.preventDefault(),m(!1);const s=a.dataTransfer.files;s.length>0&&z(s)};return e.jsxs("div",{className:"assets-tab p-6",children:[e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ä½¿ç”¨å®¹é‡"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[H(M)," / ",H(v.PROJECT.TOTAL_MAX_SIZE)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${P>90?"bg-red-500":P>70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(P,100)}%`}})}),P>80&&e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"å®¹é‡ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ä¸è¦ãªã‚¢ã‚»ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚"})]}),e.jsx("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-xl",children:[{id:"background",label:"èƒŒæ™¯",icon:"ğŸ–¼ï¸"},{id:"objects",label:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",icon:"ğŸ¨"},{id:"texts",label:"ãƒ†ã‚­ã‚¹ãƒˆ",icon:"ğŸ“"}].map(a=>e.jsxs("button",{onClick:()=>d(a.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ${i===a.id?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx("span",{children:a.icon}),e.jsx("span",{children:a.label})]},a.id))}),i==="background"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:["ğŸ–¼ï¸ èƒŒæ™¯",e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"(1æšã¾ã§)"})]}),t.assets.background?e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:t.assets.background.frames[0].dataUrl,alt:"èƒŒæ™¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",className:"w-20 h-36 object-cover rounded-lg border border-gray-200"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-lg",children:t.assets.background.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.assets.background.frames[0].width,"Ã—",t.assets.background.frames[0].height,"px"]}),e.jsx("p",{className:"text-sm text-gray-500",children:H(t.assets.background.totalSize)})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:()=>R("background"),className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 font-medium",children:"ğŸ—‘ï¸ å‰Šé™¤"})})]})}):e.jsxs("div",{onDragOver:n,onDragLeave:x,onDrop:o,className:`border-2 border-dashed rounded-xl p-8 text-center transition-colors ${b?"border-purple-400 bg-purple-50":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ–¼ï¸"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"èƒŒæ™¯ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"}),e.jsx("input",{ref:_,type:"file",accept:"image/*",onChange:a=>a.target.files&&z(a.target.files),className:"hidden"}),e.jsx("button",{onClick:()=>{var a;return(a=_.current)==null?void 0:a.click()},disabled:f,className:"px-6 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 font-medium disabled:opacity-50",children:f?"å‡¦ç†ä¸­...":"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-4",children:["æ¨å¥¨ã‚µã‚¤ã‚º: 1080Ã—1920px (9:16) â€¢ æœ€å¤§",H(v.IMAGE.BACKGROUND_FRAME_MAX_SIZE)]})]})]}),i==="objects"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:["ğŸ¨ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ",e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",t.assets.objects.length,"/",v.PROJECT.MAX_OBJECTS,")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[t.assets.objects.map(a=>e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:[e.jsx("img",{src:a.frames[0].dataUrl,alt:a.name,className:"w-full aspect-square object-cover rounded-lg mb-3"}),e.jsx("h4",{className:"font-medium text-sm",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:H(a.totalSize)}),e.jsx("button",{onClick:()=>R("objects",a.id),className:"mt-2 w-full px-3 py-2 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200",children:"ğŸ—‘ï¸ å‰Šé™¤"})]},a.id)),t.assets.objects.length<v.PROJECT.MAX_OBJECTS&&e.jsxs("div",{onDragOver:n,onDragLeave:x,onDrop:o,className:`border-2 border-dashed rounded-xl p-4 flex flex-col items-center justify-center aspect-square cursor-pointer transition-colors ${b?"border-purple-400 bg-purple-50":"border-gray-300 hover:border-gray-400"}`,onClick:()=>{var a;return(a=_.current)==null?void 0:a.click()},children:[e.jsx("div",{className:"text-2xl mb-2",children:"â•"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¿½åŠ "}),e.jsx("input",{ref:_,type:"file",accept:"image/*",onChange:a=>a.target.files&&z(a.target.files),className:"hidden"})]})]}),t.assets.objects.length>=v.PROJECT.MAX_OBJECTS&&e.jsxs("p",{className:"text-center text-sm text-gray-500 py-4",children:["ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æœ€å¤§",v.PROJECT.MAX_OBJECTS,"å€‹ã¾ã§è¿½åŠ ã§ãã¾ã™"]})]}),i==="texts"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:["ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆ",e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",t.assets.texts.length,"/",v.TEXT.MAX_COUNT,")"]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:t.assets.texts.map(a=>e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 text-2xl",style:{fontSize:`${a.style.fontSize}px`,color:a.style.color,fontWeight:a.style.fontWeight},children:a.content}),e.jsx("button",{onClick:()=>R("texts",a.id),className:"ml-4 px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200",children:"ğŸ—‘ï¸"})]})},a.id))}),t.assets.texts.length<v.TEXT.MAX_COUNT&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:[e.jsx("h4",{className:"font-medium mb-4",children:"æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ "}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ (",h.length,"/",v.TEXT.MAX_LENGTH,")"]}),e.jsx("input",{type:"text",value:h,onChange:a=>A(a.target.value),maxLength:v.TEXT.MAX_LENGTH,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–‡å­—è‰²"}),e.jsx("input",{type:"color",value:T,onChange:a=>j(a.target.value),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["æ–‡å­—ã‚µã‚¤ã‚º (",S,"px)"]}),e.jsx("input",{type:"range",min:v.TEXT.MIN_FONT_SIZE,max:v.TEXT.MAX_FONT_SIZE,value:S,onChange:a=>E(parseInt(a.target.value)),className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ•ã‚©ãƒ³ãƒˆã®å¤ªã•"}),e.jsxs("select",{value:I,onChange:a=>U(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"normal",children:"æ¨™æº–"}),e.jsx("option",{value:"bold",children:"å¤ªå­—"})]})]}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:"}),e.jsx("div",{style:{fontSize:`${S}px`,color:T,fontWeight:I},children:h||"ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"})]}),e.jsx("button",{onClick:X,disabled:!h.trim(),className:"w-full px-4 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"âœ¨ ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ "})]})]}),t.assets.texts.length>=v.TEXT.MAX_COUNT&&e.jsxs("p",{className:"text-center text-sm text-gray-500 py-4",children:["ãƒ†ã‚­ã‚¹ãƒˆã¯æœ€å¤§",v.TEXT.MAX_COUNT,"å€‹ã¾ã§è¿½åŠ ã§ãã¾ã™"]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"animate-spin text-4xl mb-4",children:"ğŸ¨"}),e.jsx("p",{className:"text-lg font-semibold",children:"ç”»åƒã‚’å‡¦ç†ä¸­..."}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"å°‘ã€…ãŠå¾…ã¡ãã ã•ã„"})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-purple-600 bg-opacity-20 flex items-center justify-center z-40 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center shadow-2xl",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ“"}),e.jsx("p",{className:"text-xl font-semibold text-gray-800",children:"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦è¿½åŠ "})]})}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"ğŸ’¡ ã‚¢ã‚»ãƒƒãƒˆç®¡ç†ã®ãƒ’ãƒ³ãƒˆ"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ èƒŒæ™¯ã¯9:16ï¼ˆç¸¦å‘ãï¼‰ã®æ¯”ç‡ãŒæ¨å¥¨ã§ã™"}),e.jsx("li",{children:"â€¢ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯é€æ˜èƒŒæ™¯ã®PNGå½¢å¼ãŒæ¨å¥¨ã§ã™"}),e.jsxs("li",{children:["â€¢ ãƒ†ã‚­ã‚¹ãƒˆã¯",v.TEXT.MAX_LENGTH,"æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"]}),e.jsx("li",{children:"â€¢ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã„å ´åˆã¯è‡ªå‹•ã§æœ€é©åŒ–ã•ã‚Œã¾ã™"})]})]})]})},le=({accept:t,maxSize:l,onUpload:i,disabled:d=!1,className:c="",children:g})=>{const b=u.useRef(null),[m,f]=u.useState(!1),N=j=>{j.preventDefault(),d||f(!0)},h=()=>{f(!1)},A=j=>{if(j.preventDefault(),f(!1),d)return;const S=j.dataTransfer.files;S.length>0&&i(S)},T=j=>{const S=j.target.files;S&&S.length>0&&i(S)};return e.jsxs("div",{className:`${c} ${m?"bg-purple-50 border-purple-400":""}`,onDragOver:N,onDragLeave:h,onDrop:A,children:[e.jsx("input",{ref:b,type:"file",accept:t,onChange:T,disabled:d,className:"hidden"}),e.jsx("div",{onClick:()=>{var j;return!d&&((j=b.current)==null?void 0:j.click())},className:"cursor-pointer",children:g})]})},ce=t=>new Promise((l,i)=>{const d=new Audio,c=URL.createObjectURL(t);d.addEventListener("loadedmetadata",()=>{l({duration:d.duration,format:t.type.split("/")[1]||"unknown"}),URL.revokeObjectURL(c)}),d.addEventListener("error",()=>{i(new Error("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")),URL.revokeObjectURL(c)}),d.src=c}),Q=t=>{const l=Math.floor(t/60),i=Math.floor(t%60);return`${l}:${i.toString().padStart(2,"0")}`},V=t=>{if(t===0)return"0 B";const l=1024,i=["B","KB","MB","GB"],d=Math.floor(Math.log(t)/Math.log(l));return parseFloat((t/Math.pow(l,d)).toFixed(2))+" "+i[d]},ue=({project:t,onProjectUpdate:l})=>{const[i,d]=u.useState("bgm"),[c,g]=u.useState(null),[b,m]=u.useState(0),[f,N]=u.useState(!1),[h,A]=u.useState(null),[T,j]=u.useState(1),S=u.useRef(null),E=u.useRef(null);u.useRef(null);const U=u.useCallback(()=>{let n=0;return t.assets.audio.bgm&&(n+=t.assets.audio.bgm.fileSize),t.assets.audio.se.forEach(x=>n+=x.fileSize),n},[t.assets.audio])(),_=v.AUDIO.BGM_MAX_SIZE+v.AUDIO.SE_MAX_SIZE*v.PROJECT.MAX_SE_COUNT,p=U/_*100,M=u.useCallback(async(n,x)=>{if(!f){N(!0);try{const o=n[0];if(!o||!o.type.startsWith("audio/")){alert("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");return}const a=await ce(o),s=x==="bgm"?v.AUDIO.BGM_MAX_DURATION:v.AUDIO.SE_MAX_DURATION;if(a.duration>s){alert(`éŸ³å£°ãŒé•·ã™ãã¾ã™ã€‚æœ€å¤§${s}ç§’ã¾ã§ã§ã™ã€‚`);return}if(x==="se"&&t.assets.audio.se.length>=v.PROJECT.MAX_SE_COUNT){alert(`åŠ¹æœéŸ³ã¯æœ€å¤§${v.PROJECT.MAX_SE_COUNT}å€‹ã¾ã§è¿½åŠ ã§ãã¾ã™`);return}const r=new FileReader;r.onload=w=>{var B,$,K;const y=(B=w.target)==null?void 0:B.result,O=new Date().toISOString(),L={id:crypto.randomUUID(),name:o.name.replace(/\.[^/.]+$/,""),dataUrl:y,originalName:o.name,duration:a.duration,fileSize:o.size,format:a.format,volume:.8,loop:x==="bgm",uploadedAt:O},C={...t.assets};x==="bgm"?C.audio.bgm=L:C.audio.se.push(L);const D=C.objects.reduce((J,Z)=>J+Z.totalSize,0)+((($=C.background)==null?void 0:$.totalSize)||0),k=(((K=C.audio.bgm)==null?void 0:K.fileSize)||0)+C.audio.se.reduce((J,Z)=>J+Z.fileSize,0);C.statistics={totalImageSize:D,totalAudioSize:k,totalSize:D+k,usedSlots:{background:C.background?1:0,objects:C.objects.length,texts:C.texts.length,bgm:C.audio.bgm?1:0,se:C.audio.se.length},limitations:{isNearImageLimit:!1,isNearAudioLimit:k>_*.8,isNearTotalLimit:D+k>v.PROJECT.TOTAL_MAX_SIZE*.8,hasViolations:!1}},C.lastModified=O,l({...t,assets:C,totalSize:D+k,lastModified:O})},r.readAsDataURL(o)}catch(o){console.error("éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:",o),alert("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{N(!1)}}},[t,l,f,_]),P=u.useCallback(n=>{if(S.current){if(c===n.id){S.current.pause(),g(null);return}S.current.src=n.dataUrl,S.current.volume=n.volume*T,S.current.loop=n.loop,S.current.play().then(()=>{g(n.id)}).catch(x=>{console.error("éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:",x),alert("éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ")})}},[c,T]),z=u.useCallback(()=>{S.current&&(S.current.pause(),S.current.currentTime=0),g(null),m(0)},[]),X=u.useCallback((n,x)=>{var y,O,L;const o={...t.assets};let a=0;const s=new Date().toISOString();if(n==="bgm"&&o.audio.bgm)a=o.audio.bgm.fileSize,o.audio.bgm=null;else if(n==="se"&&x){const C=o.audio.se.findIndex(D=>D.id===x);C>=0&&(a=o.audio.se[C].fileSize,o.audio.se.splice(C,1))}(n==="bgm"&&c===((y=t.assets.audio.bgm)==null?void 0:y.id)||n==="se"&&c===x)&&z();const r=o.objects.reduce((C,D)=>C+D.totalSize,0)+(((O=o.background)==null?void 0:O.totalSize)||0),w=(((L=o.audio.bgm)==null?void 0:L.fileSize)||0)+o.audio.se.reduce((C,D)=>C+D.fileSize,0);o.statistics={totalImageSize:r,totalAudioSize:w,totalSize:r+w,usedSlots:{background:o.background?1:0,objects:o.objects.length,texts:o.texts.length,bgm:o.audio.bgm?1:0,se:o.audio.se.length},limitations:{isNearImageLimit:!1,isNearAudioLimit:!1,isNearTotalLimit:!1,hasViolations:!1}},o.lastModified=s,l({...t,assets:o,totalSize:t.totalSize-a,lastModified:s})},[t,l,c,z]),R=u.useCallback((n,x,o,a)=>{var w;const s={...t.assets},r=new Date().toISOString();if(n==="bgm"&&((w=s.audio.bgm)==null?void 0:w.id)===x)s.audio.bgm={...s.audio.bgm,[o]:a};else if(n==="se"){const y=s.audio.se.findIndex(O=>O.id===x);y>=0&&(s.audio.se[y]={...s.audio.se[y],[o]:a})}s.lastModified=r,l({...t,assets:s,lastModified:r})},[t,l]);return u.useEffect(()=>{const n=S.current;if(!n)return;const x=()=>m(n.currentTime),o=()=>{g(null),m(0)};return n.addEventListener("timeupdate",x),n.addEventListener("ended",o),()=>{n.removeEventListener("timeupdate",x),n.removeEventListener("ended",o)}},[]),e.jsxs("div",{className:"audio-tab p-6",children:[e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"éŸ³å£°å®¹é‡"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[V(U)," / ",V(_)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${p>90?"bg-red-500":p>70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(p,100)}%`}})})]}),e.jsx("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-xl",children:[{id:"bgm",label:"BGM",icon:"ğŸµ"},{id:"se",label:"åŠ¹æœéŸ³",icon:"ğŸ”Š"}].map(n=>e.jsxs("button",{onClick:()=>d(n.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ${i===n.id?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx("span",{children:n.icon}),e.jsx("span",{children:n.label})]},n.id))}),e.jsxs("div",{className:"mb-6 p-4 bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"ğŸ”Š ãƒã‚¹ã‚¿ãƒ¼éŸ³é‡"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(T*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:T,onChange:n=>j(parseFloat(n.target.value)),className:"w-full"})]}),i==="bgm"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:["ğŸµ BGM",e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"(1æ›²ã¾ã§)"})]}),t.assets.audio.bgm?e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-lg",children:t.assets.audio.bgm.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Q(t.assets.audio.bgm.duration)," â€¢ ",V(t.assets.audio.bgm.fileSize)]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(t.assets.audio.bgm),className:`px-4 py-2 rounded-lg font-medium transition-colors ${c===t.assets.audio.bgm.id?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:c===t.assets.audio.bgm.id?"â¹ï¸ åœæ­¢":"â–¶ï¸ å†ç”Ÿ"}),e.jsx("button",{onClick:()=>A(h===t.assets.audio.bgm.id?null:t.assets.audio.bgm.id),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"âš™ï¸ è¨­å®š"}),e.jsx("button",{onClick:()=>X("bgm"),className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200",children:"ğŸ—‘ï¸ å‰Šé™¤"})]})]}),e.jsxs("div",{className:"mb-4 bg-gray-100 rounded-lg p-4",children:[e.jsx("canvas",{ref:E,width:400,height:60,className:"w-full h-15 bg-gray-50 rounded"}),c===t.assets.audio.bgm.id&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["å†ç”Ÿæ™‚é–“: ",Q(b)," / ",Q(t.assets.audio.bgm.duration)]})]}),h===t.assets.audio.bgm.id&&e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["éŸ³é‡ (",Math.round(t.assets.audio.bgm.volume*100),"%)"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:t.assets.audio.bgm.volume,onChange:n=>R("bgm",t.assets.audio.bgm.id,"volume",parseFloat(n.target.value)),className:"w-full"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:t.assets.audio.bgm.loop,onChange:n=>R("bgm",t.assets.audio.bgm.id,"loop",n.target.checked)}),e.jsx("span",{className:"text-sm",children:"ãƒ«ãƒ¼ãƒ—å†ç”Ÿ"})]})})]})]}):e.jsx(le,{accept:"audio/*",maxSize:v.AUDIO.BGM_MAX_SIZE,onUpload:n=>M(n,"bgm"),disabled:f,className:"mb-4",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-purple-400 hover:bg-purple-50 transition-colors",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸµ"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"BGMã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ"}),e.jsx("div",{className:"px-6 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 font-medium inline-block",children:f?"å‡¦ç†ä¸­...":"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-4",children:["æœ€å¤§",v.AUDIO.BGM_MAX_DURATION,"ç§’ â€¢ ",V(v.AUDIO.BGM_MAX_SIZE),"ã¾ã§"]})]})})]}),i==="se"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:["ğŸ”Š åŠ¹æœéŸ³",e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",t.assets.audio.se.length,"/",v.PROJECT.MAX_SE_COUNT,")"]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:t.assets.audio.se.map(n=>e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Q(n.duration)," â€¢ ",V(n.fileSize)]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(n),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${c===n.id?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:c===n.id?"â¹ï¸":"â–¶ï¸"}),e.jsx("button",{onClick:()=>A(h===n.id?null:n.id),className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200",children:"âš™ï¸"}),e.jsx("button",{onClick:()=>X("se",n.id),className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200",children:"ğŸ—‘ï¸"})]})]}),h===n.id&&e.jsxs("div",{className:"border-t mt-4 pt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åŠ¹æœéŸ³å"}),e.jsx("input",{type:"text",value:n.name,onChange:x=>R("se",n.id,"name",x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["éŸ³é‡ (",Math.round(n.volume*100),"%)"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:n.volume,onChange:x=>R("se",n.id,"volume",parseFloat(x.target.value)),className:"w-full"})]})]})]},n.id))}),t.assets.audio.se.length<v.PROJECT.MAX_SE_COUNT&&e.jsx(le,{accept:"audio/*",maxSize:v.AUDIO.SE_MAX_SIZE,onUpload:n=>M(n,"se"),disabled:f,className:"mb-4",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-purple-400 hover:bg-purple-50 transition-colors",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ğŸ”Š"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"åŠ¹æœéŸ³ã‚’è¿½åŠ "}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—"}),e.jsx("div",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium inline-block",children:f?"å‡¦ç†ä¸­...":"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-3",children:["æœ€å¤§",v.AUDIO.SE_MAX_DURATION,"ç§’ â€¢ ",V(v.AUDIO.SE_MAX_SIZE),"ã¾ã§"]})]})})]}),e.jsx("audio",{ref:S,onLoadedData:()=>{},preload:"none"}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"animate-spin text-4xl mb-4",children:"ğŸµ"}),e.jsx("p",{className:"text-lg font-semibold",children:"éŸ³å£°ã‚’å‡¦ç†ä¸­..."}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"å°‘ã€…ãŠå¾…ã¡ãã ã•ã„"})]})}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"ğŸ’¡ éŸ³å£°ã®ãƒ’ãƒ³ãƒˆ"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ BGMã¯è‡ªå‹•ãƒ«ãƒ¼ãƒ—ã€åŠ¹æœéŸ³ã¯1å›å†ç”Ÿã•ã‚Œã¾ã™"}),e.jsxs("li",{children:["â€¢ BGMã¯æœ€å¤§",v.AUDIO.BGM_MAX_DURATION,"ç§’ã€åŠ¹æœéŸ³ã¯æœ€å¤§",v.AUDIO.SE_MAX_DURATION,"ç§’ã¾ã§"]}),e.jsx("li",{children:"â€¢ å¯¾å¿œå½¢å¼: MP3, WAV, OGG"}),e.jsx("li",{children:"â€¢ éŸ³é‡ã¯0%ã€œ100%ã§èª¿æ•´ã§ãã¾ã™"})]})]})]})},me=({project:t,onProjectUpdate:l})=>{var M,P,z,X,R;const[i,d]=u.useState("layout"),[c,g]=u.useState(null),[b,m]=u.useState(null),[f,N]=u.useState(!1),[h,A]=u.useState(null),T=u.useRef(null),j=u.useCallback(n=>{l({...t,...n})},[t,l]),S=u.useCallback((n,x)=>{const o={...t.script},a=o.layout.objects.findIndex(s=>s.objectId===n);a!==-1&&(o.layout.objects[a].position=x,j({script:o}))},[t.script,j]),E=u.useCallback(()=>{const n=new Date().toISOString(),x={id:`rule_${Date.now()}`,name:"æ–°ã—ã„ãƒ«ãƒ¼ãƒ«",enabled:!0,priority:t.script.rules.length+1,targetObjectId:"stage",triggers:{operator:"AND",conditions:[]},actions:[],createdAt:n,lastModified:n};m(x),N(!0)},[t.script.rules.length]),I=u.useCallback(n=>{const x={...t.script},o=x.rules.findIndex(s=>s.id===n.id),a={...n,lastModified:new Date().toISOString()};o!==-1?x.rules[o]=a:x.rules.push(a),x.statistics={totalRules:x.rules.length,totalConditions:x.rules.reduce((s,r)=>s+r.triggers.conditions.length,0),totalActions:x.rules.reduce((s,r)=>s+r.actions.length,0),complexityScore:Math.min(100,x.rules.length*10),usedTriggerTypes:[...new Set(x.rules.flatMap(s=>s.triggers.conditions.map(r=>r.type)))],usedActionTypes:[...new Set(x.rules.flatMap(s=>s.actions.map(r=>r.type)))],flagCount:x.flags.length,estimatedCPUUsage:x.rules.length>20?"high":x.rules.length>10?"medium":"low",estimatedMemoryUsage:x.rules.length*.5,maxConcurrentEffects:Math.max(0,...x.rules.map(s=>s.actions.filter(r=>r.type==="effect").length))},j({script:x}),N(!1),m(null)},[t.script,j]),U=u.useCallback(n=>{const x={...t.script};x.rules=x.rules.filter(o=>o.id!==n),x.statistics={totalRules:x.rules.length,totalConditions:x.rules.reduce((o,a)=>o+a.triggers.conditions.length,0),totalActions:x.rules.reduce((o,a)=>o+a.actions.length,0),complexityScore:Math.min(100,x.rules.length*10),usedTriggerTypes:[...new Set(x.rules.flatMap(o=>o.triggers.conditions.map(a=>a.type)))],usedActionTypes:[...new Set(x.rules.flatMap(o=>o.actions.map(a=>a.type)))],flagCount:x.flags.length,estimatedCPUUsage:x.rules.length>20?"high":x.rules.length>10?"medium":"low",estimatedMemoryUsage:x.rules.length*.5,maxConcurrentEffects:Math.max(0,...x.rules.map(o=>o.actions.filter(a=>a.type==="effect").length))},j({script:x})},[t.script,j]),_=u.useCallback(n=>{n.preventDefault(),n.dataTransfer.dropEffect="move"},[]),p=u.useCallback(n=>{var w;if(n.preventDefault(),i!=="layout"||!h)return;const x=(w=T.current)==null?void 0:w.getBoundingClientRect();if(!x)return;const o=(n.clientX-x.left)/x.width,a=(n.clientY-x.top)/x.height,s=Math.max(0,Math.min(1,o)),r=Math.max(0,Math.min(1,a));S(h.id,{x:s,y:r}),A(null)},[i,h,S]);return e.jsxs("div",{className:"script-tab h-full flex flex-col",children:[e.jsxs("div",{className:"flex mb-4 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${i==="layout"?"bg-white shadow-sm text-blue-600":"text-gray-600 hover:text-gray-800"}`,onClick:()=>d("layout"),children:"ğŸ¨ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ"}),e.jsx("button",{className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${i==="rules"?"bg-white shadow-sm text-blue-600":"text-gray-600 hover:text-gray-800"}`,onClick:()=>d("rules"),children:"âš™ï¸ ãƒ«ãƒ¼ãƒ«è¨­å®š"})]}),i==="layout"&&e.jsxs("div",{className:"flex flex-1 gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800",children:"ğŸ® ã‚²ãƒ¼ãƒ ç”»é¢"}),e.jsxs("div",{ref:T,className:"relative w-full bg-gradient-to-b from-sky-200 to-green-200 rounded-xl border-2 border-gray-300 overflow-hidden",style:{aspectRatio:"9/16",minHeight:"400px"},onDragOver:_,onDrop:p,children:[t.script.layout.background.visible&&t.assets.background&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:(M=t.assets.background.frames[0])!=null&&M.dataUrl?`url(${t.assets.background.frames[0].dataUrl})`:void 0}}),t.script.layout.objects.map((n,x)=>{const o=t.assets.objects.find(a=>a.id===n.objectId);return!o||!o.frames[0]?null:e.jsxs("div",{className:`absolute cursor-move border-2 border-dashed transition-all ${c===n.objectId?"border-blue-500 shadow-lg":"border-transparent hover:border-blue-300"}`,style:{left:`${n.position.x*100}%`,top:`${n.position.y*100}%`,transform:"translate(-50%, -50%)",zIndex:n.zIndex},onClick:()=>g(n.objectId),draggable:!0,onDragStart:a=>{A({id:n.objectId,type:"object"}),a.dataTransfer.effectAllowed="move"},children:[e.jsx("img",{src:o.frames[0].dataUrl,alt:o.name,className:"max-w-16 max-h-16 object-contain",style:{transform:`scale(${n.scale.x}, ${n.scale.y}) rotate(${n.rotation}deg)`}}),e.jsx("div",{className:"absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs bg-black bg-opacity-70 text-white px-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:o.name})]},n.objectId)}),e.jsxs("div",{className:"absolute inset-0 pointer-events-none opacity-10",children:[Array.from({length:10}).map((n,x)=>e.jsx("div",{className:"absolute border-t border-gray-400",style:{top:`${x*10}%`,width:"100%"}},`h-${x}`)),Array.from({length:6}).map((n,x)=>e.jsx("div",{className:"absolute border-l border-gray-400",style:{left:`${x*16.67}%`,height:"100%"}},`v-${x}`))]})]})]}),e.jsxs("div",{className:"w-80 bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"ğŸ”§ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š"}),c?e.jsx("div",{className:"space-y-4",children:(()=>{var o;const n=t.script.layout.objects.find(a=>a.objectId===c),x=t.assets.objects.find(a=>a.id===c);return!n||!x?e.jsx("p",{className:"text-gray-500",children:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:(o=x.frames[0])==null?void 0:o.dataUrl,alt:x.name,className:"w-16 h-16 mx-auto object-contain border rounded-lg"}),e.jsx("p",{className:"mt-2 font-medium",children:x.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä½ç½®"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Xåº§æ¨™"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n.position.x,onChange:a=>S(c,{x:parseFloat(a.target.value),y:n.position.y}),className:"w-full"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(n.position.x*100),"%"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Yåº§æ¨™"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:n.position.y,onChange:a=>S(c,{x:n.position.x,y:parseFloat(a.target.value)}),className:"w-full"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(n.position.y*100),"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åˆæœŸçŠ¶æ…‹"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.initialState.visible,onChange:a=>{const s={...t.script},r=s.layout.objects.findIndex(w=>w.objectId===c);r!==-1&&(s.layout.objects[r].initialState.visible=a.target.checked,j({script:s}))},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"æœ€åˆã‹ã‚‰è¡¨ç¤º"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.initialState.autoStart,onChange:a=>{const s={...t.script},r=s.layout.objects.findIndex(w=>w.objectId===c);r!==-1&&(s.layout.objects[r].initialState.autoStart=a.target.checked,j({script:s}))},className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"ã‚¢ãƒ‹ãƒ¡è‡ªå‹•é–‹å§‹"})]})]})]})]})})()}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ‘†"}),e.jsxs("p",{children:["ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¿ãƒƒãƒ—ã—ã¦",e.jsx("br",{}),"è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã™"]})]})]})]}),i==="rules"&&e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"âš™ï¸ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«"}),e.jsx("button",{onClick:E,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"â• ãƒ«ãƒ¼ãƒ«è¿½åŠ "})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((P=t.script.statistics)==null?void 0:P.totalRules)||0}),e.jsx("div",{className:"text-sm text-blue-700",children:"ãƒ«ãƒ¼ãƒ«æ•°"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((z=t.script.statistics)==null?void 0:z.totalConditions)||0}),e.jsx("div",{className:"text-sm text-green-700",children:"æ¡ä»¶æ•°"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:((X=t.script.statistics)==null?void 0:X.totalActions)||0}),e.jsx("div",{className:"text-sm text-purple-700",children:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°"})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:((R=t.script.statistics)==null?void 0:R.complexityScore)||0}),e.jsx("div",{className:"text-sm text-orange-700",children:"è¤‡é›‘åº¦"})]})]}),e.jsx("div",{className:"space-y-3",children:t.script.rules.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ¯"}),e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-2",children:"ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"ã‚²ãƒ¼ãƒ ã‚’å‹•ã‹ã™ãŸã‚ã®ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼"}),e.jsx("button",{onClick:E,className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"æœ€åˆã®ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆ"})]}):t.script.rules.map(n=>{var x;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.enabled,onChange:o=>{const a={...t.script},s=a.rules.findIndex(r=>r.id===n.id);s!==-1&&(a.rules[s].enabled=o.target.checked,j({script:a}))},className:"mr-2"}),e.jsx("span",{className:"font-medium text-gray-800",children:n.name})]}),e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:["å„ªå…ˆåº¦: ",n.priority]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{m(n),N(!0)},className:"text-blue-500 hover:text-blue-700 text-sm font-medium",children:"ç·¨é›†"}),e.jsx("button",{onClick:()=>U(n.id),className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"å‰Šé™¤"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"æ¡ä»¶:"})," ",n.triggers.conditions.length,"å€‹ (",n.triggers.operator,")"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:"})," ",n.actions.length,"å€‹"]}),n.targetObjectId&&n.targetObjectId!=="stage"&&e.jsxs("p",{children:[e.jsx("strong",{children:"å¯¾è±¡:"})," ",((x=t.assets.objects.find(o=>o.id===n.targetObjectId))==null?void 0:x.name)||n.targetObjectId]})]})]},n.id)})})]}),f&&b&&e.jsx(xe,{rule:b,project:t,onSave:I,onClose:()=>{N(!1),m(null)}})]})},xe=({rule:t,project:l,onSave:i,onClose:d})=>{const[c,g]=u.useState(t),b=()=>{i(c)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"ğŸ”§ ãƒ«ãƒ¼ãƒ«ç·¨é›†"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ«ãƒ¼ãƒ«å"}),e.jsx("input",{type:"text",value:c.name,onChange:m=>g({...c,name:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ãƒ«ãƒ¼ãƒ«åã‚’å…¥åŠ›"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ"}),e.jsxs("select",{value:c.targetObjectId,onChange:m=>g({...c,targetObjectId:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"stage",children:"ğŸ® ã‚²ãƒ¼ãƒ å…¨ä½“"}),l.assets.objects.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-3",children:"ğŸ¯ ç™ºå‹•æ¡ä»¶"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"æ¡ä»¶ã®çµ„ã¿åˆã‚ã›:"}),e.jsxs("select",{value:c.triggers.operator,onChange:m=>g({...c,triggers:{...c.triggers,operator:m.target.value}}),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[e.jsx("option",{value:"AND",children:"ã™ã¹ã¦ã®æ¡ä»¶ (AND)"}),e.jsx("option",{value:"OR",children:"ã„ãšã‚Œã‹ã®æ¡ä»¶ (OR)"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:se.map(m=>e.jsxs("button",{onClick:()=>{const f={type:m.type,target:"self"};g({...c,triggers:{...c.triggers,conditions:[...c.triggers.conditions,f]}})},className:`p-3 text-center rounded-lg border-2 border-dashed border-gray-300 hover:border-blue-500 transition-colors ${m.color}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:m.icon}),e.jsx("div",{className:"text-xs font-medium",children:m.label})]},m.type))}),e.jsx("div",{className:"space-y-2",children:c.triggers.conditions.map((m,f)=>{var N;return e.jsxs("div",{className:"flex items-center gap-2 bg-white p-2 rounded border",children:[e.jsx("span",{className:"text-sm",children:((N=se.find(h=>h.type===m.type))==null?void 0:N.label)||m.type}),e.jsx("button",{onClick:()=>{const h=c.triggers.conditions.filter((A,T)=>T!==f);g({...c,triggers:{...c.triggers,conditions:h}})},className:"text-red-500 hover:text-red-700 text-sm",children:"å‰Šé™¤"})]},f)})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-3",children:"âš¡ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:ae.map(m=>e.jsxs("button",{onClick:()=>{const f={type:m.type};g({...c,actions:[...c.actions,f]})},className:`p-3 text-center rounded-lg border-2 border-dashed border-gray-300 hover:border-green-500 transition-colors ${m.color}`,children:[e.jsx("div",{className:"text-xl mb-1",children:m.icon}),e.jsx("div",{className:"text-xs font-medium",children:m.label})]},m.type))}),e.jsx("div",{className:"space-y-2",children:c.actions.map((m,f)=>{var N;return e.jsxs("div",{className:"flex items-center gap-2 bg-white p-2 rounded border",children:[e.jsx("span",{className:"text-sm",children:((N=ae.find(h=>h.type===m.type))==null?void 0:N.label)||m.type}),e.jsx("button",{onClick:()=>{const h=c.actions.filter((A,T)=>T!==f);g({...c,actions:h})},className:"text-red-500 hover:text-red-700 text-sm",children:"å‰Šé™¤"})]},f)})})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsx("button",{onClick:b,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors",children:"ä¿å­˜"})]})]})})},ge=[{value:5,label:"5ç§’",description:"ã‚µã‚¯ãƒƒã¨",emoji:"âš¡",color:"bg-yellow-100 border-yellow-300"},{value:10,label:"10ç§’",description:"ã¡ã‚‡ã†ã©ã„ã„",emoji:"â°",color:"bg-blue-100 border-blue-300"},{value:15,label:"15ç§’",description:"ã˜ã£ãã‚Š",emoji:"ğŸ¯",color:"bg-green-100 border-green-300"},{value:30,label:"30ç§’",description:"ãŸã£ã·ã‚Š",emoji:"ğŸƒ",color:"bg-purple-100 border-purple-300"}],he=[{value:"easy",label:"ã‚„ã•ã—ã„",description:"èª°ã§ã‚‚æ¥½ã—ã‚ã‚‹",emoji:"ğŸ˜Š",color:"bg-green-100 border-green-300"},{value:"normal",label:"ãµã¤ã†",description:"ã¡ã‚‡ã†ã©ã„ã„æŒ‘æˆ¦",emoji:"ğŸ™‚",color:"bg-blue-100 border-blue-300"},{value:"hard",label:"ã‚€ãšã‹ã—ã„",description:"ä¸Šç´šè€…å‘ã‘",emoji:"ğŸ˜¤",color:"bg-red-100 border-red-300"}],be=({project:t,onProjectUpdate:l})=>{var z,X,R,n,x,o,a;const[i,d]=u.useState(!1),[c,g]=u.useState(null),[b,m]=u.useState(!1),[f,N]=u.useState(null),[h,A]=u.useState(!1);u.useRef(null);const T=u.useCallback(s=>{l({...t,...s})},[t,l]),j=u.useCallback(s=>{const r={...t.settings,...s};T({settings:r})},[t.settings,T]),S=u.useCallback(s=>{j({name:s.slice(0,50)})},[j]),E=u.useCallback(s=>{j({description:s.slice(0,200)})},[j]),I=u.useCallback(s=>{j({duration:{type:"fixed",seconds:s}})},[j]),U=u.useCallback(s=>{j({difficulty:s})},[j]),_=u.useCallback(async()=>{d(!0),g(null);try{if(!t.assets.objects.length&&!t.assets.background)throw new Error("ã‚²ãƒ¼ãƒ ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯èƒŒæ™¯ã‚’è¿½åŠ ã—ã¦ãã ã•ã„");if(!t.script.rules.length&&!t.script.successConditions.length)throw new Error("ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã¾ãŸã¯æˆåŠŸæ¡ä»¶ã‚’è¨­å®šã—ã¦ãã ã•ã„");setTimeout(()=>{const s=Math.random()>.3;g(s?"success":"failure"),d(!1)},3e3)}catch(s){console.error("Test play error:",s),g("failure"),d(!1)}},[t]),p=u.useCallback(async()=>{var s,r;A(!0);try{await new Promise(L=>setTimeout(L,2e3));const w=document.createElement("canvas");w.width=300,w.height=400;const y=w.getContext("2d");if(y){const L=y.createLinearGradient(0,0,0,400);L.addColorStop(0,"#3B82F6"),L.addColorStop(1,"#1D4ED8"),y.fillStyle=L,y.fillRect(0,0,300,400),y.fillStyle="white",y.font="bold 24px Arial",y.textAlign="center",y.fillText(t.settings.name||"My Game",150,50),(s=t.assets.background)!=null&&s.frames[0]&&(y.fillStyle="rgba(255,255,255,0.1)",y.fillRect(50,100,200,150),y.fillStyle="white",y.font="16px Arial",y.fillText("Background Image",150,175)),y.fillStyle="rgba(255,255,255,0.9)",y.font="14px Arial",y.fillText(`Objects: ${t.assets.objects.length}`,150,300),y.fillText(`Rules: ${t.script.rules.length}`,150,320),y.fillText(`Duration: ${((r=t.settings.duration)==null?void 0:r.seconds)||10}s`,150,340)}const O=w.toDataURL("image/png");j({preview:{...t.settings.preview,thumbnailDataUrl:O}})}catch(w){console.error("Thumbnail generation error:",w)}finally{A(!1)}},[t,j]),M=u.useCallback(async()=>{var s;m(!0),N(null);try{if(!((s=t.settings.name)!=null&&s.trim()))throw new Error("ã‚²ãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");if(!t.assets.objects.length&&!t.assets.background)throw new Error("æœ€ä½1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯èƒŒæ™¯ã‚’è¿½åŠ ã—ã¦ãã ã•ã„");if(!t.script.rules.length&&!t.script.successConditions.length)throw new Error("ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã¾ãŸã¯æˆåŠŸæ¡ä»¶ã‚’è¨­å®šã—ã¦ãã ã•ã„");await new Promise(r=>setTimeout(r,2e3)),j({publishing:{...t.settings.publishing,isPublished:!0,publishedAt:new Date().toISOString(),visibility:"public"}}),T({status:"published"})}catch(r){N(r instanceof Error?r.message:"å…¬é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{m(!1)}},[t,j,T]),P=u.useCallback(async()=>{try{const s={...t,exportedAt:new Date().toISOString(),exportSettings:t.settings.export},r=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),w=URL.createObjectURL(r),y=document.createElement("a");y.href=w,y.download=`${t.settings.name||"my-game"}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(w)}catch(s){console.error("Export error:",s)}},[t]);return e.jsx("div",{className:"settings-tab h-full overflow-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("section",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:"ğŸ® ã‚²ãƒ¼ãƒ æƒ…å ±"}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ã‚²ãƒ¼ãƒ å ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.settings.name||"",onChange:s=>S(s.target.value),placeholder:"ç´ æ™´ã‚‰ã—ã„ã‚²ãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",maxLength:50}),e.jsxs("div",{className:"text-right text-sm text-gray-500 mt-1",children:[(t.settings.name||"").length,"/50"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚²ãƒ¼ãƒ èª¬æ˜"}),e.jsx("textarea",{value:t.settings.description||"",onChange:s=>E(s.target.value),placeholder:"ã“ã®ã‚²ãƒ¼ãƒ ã®æ¥½ã—ã•ã‚’èª¬æ˜ã—ã¦ãã ã•ã„",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",maxLength:200}),e.jsxs("div",{className:"text-right text-sm text-gray-500 mt-1",children:[(t.settings.description||"").length,"/200"]})]})]})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:"âš™ï¸ ã‚²ãƒ¼ãƒ è¨­å®š"}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"ã‚²ãƒ¼ãƒ æ™‚é–“"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:ge.map(s=>{var r;return e.jsxs("button",{onClick:()=>I(s.value),className:`p-4 border-2 rounded-lg text-center transition-all hover:scale-105 ${((r=t.settings.duration)==null?void 0:r.seconds)===s.value?s.color+" border-current shadow-lg":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.emoji}),e.jsx("div",{className:"font-semibold",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]},s.value)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"é›£æ˜“åº¦"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:he.map(s=>e.jsxs("button",{onClick:()=>U(s.value),className:`p-4 border-2 rounded-lg text-center transition-all hover:scale-105 ${t.settings.difficulty===s.value?s.color+" border-current shadow-lg":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.emoji}),e.jsx("div",{className:"font-semibold",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]},s.value))})]})]})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:"ğŸ¯ ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤"}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[!i&&c===null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ•¹ï¸"}),e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-2",children:"ã‚²ãƒ¼ãƒ ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"ä½œæˆã—ãŸã‚²ãƒ¼ãƒ ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ç¢ºèªã§ãã¾ã™"}),e.jsx("button",{onClick:_,disabled:!t.settings.name,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-8 py-3 rounded-lg font-medium transition-colors",children:"â–¶ï¸ ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤é–‹å§‹"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:"ğŸ®"}),e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-2",children:"ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ä¸­..."}),e.jsx("p",{className:"text-gray-600",children:"ã‚²ãƒ¼ãƒ ã®å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã™"}),e.jsx("div",{className:"mt-4 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full animate-pulse",style:{width:"70%"}})})]}),c==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ‰"}),e.jsx("h4",{className:"text-lg font-medium text-green-600 mb-2",children:"ãƒ†ã‚¹ãƒˆæˆåŠŸï¼"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"ã‚²ãƒ¼ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™"}),e.jsx("button",{onClick:()=>g(null),className:"text-blue-500 hover:text-blue-700 font-medium",children:"ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆ"})]}),c==="failure"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-6xl mb-4",children:"âš ï¸"}),e.jsx("h4",{className:"text-lg font-medium text-red-600 mb-2",children:"ãƒ†ã‚¹ãƒˆã§å•é¡Œç™ºè¦‹"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"ã‚²ãƒ¼ãƒ è¨­å®šã‚’ç¢ºèªã—ã¦ã€å†åº¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>g(null),className:"text-blue-500 hover:text-blue-700 font-medium",children:"ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆ"}),e.jsx("button",{onClick:()=>{},className:"text-orange-500 hover:text-orange-700 font-medium",children:"ãƒ«ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª"})]})]})]})})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:"ğŸ“¸ ã‚µãƒ ãƒã‚¤ãƒ«"}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-32 h-40 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden",children:(z=t.settings.preview)!=null&&z.thumbnailDataUrl?e.jsx("img",{src:t.settings.preview.thumbnailDataUrl,alt:"Game Thumbnail",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-2xl mb-1",children:"ğŸ“¸"}),e.jsx("div",{className:"text-xs",children:"No Thumbnail"})]})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"ã‚²ãƒ¼ãƒ ã‚µãƒ ãƒã‚¤ãƒ«"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"ã‚²ãƒ¼ãƒ ã®é­…åŠ›ã‚’ä¼ãˆã‚‹ã‚µãƒ ãƒã‚¤ãƒ«ã‚’è¨­å®šã—ã¾ã™"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,disabled:h,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:h?"ç”Ÿæˆä¸­...":"ğŸ¨ è‡ªå‹•ç”Ÿæˆ"}),e.jsxs("label",{className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors cursor-pointer",children:["ğŸ“ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>{var w;const r=(w=s.target.files)==null?void 0:w[0];if(r){const y=new FileReader;y.onload=O=>{var C;const L=(C=O.target)==null?void 0:C.result;j({preview:{...t.settings.preview,thumbnailDataUrl:L}})},y.readAsDataURL(r)}}})]})]})]})]})})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:"ğŸŒ å…¬é–‹è¨­å®š"}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:((X=t.settings.publishing)==null?void 0:X.visibility)==="public",onChange:s=>j({publishing:{...t.settings.publishing,visibility:s.target.checked?"public":"private"}}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"ğŸŒ ä¸€èˆ¬å…¬é–‹"}),e.jsx("div",{className:"text-sm text-gray-600",children:"èª°ã§ã‚‚ã‚²ãƒ¼ãƒ ã‚’éŠã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹"})]})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:((R=t.settings.publishing)==null?void 0:R.allowComments)||!1,onChange:s=>j({publishing:{...t.settings.publishing,allowComments:s.target.checked}}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆè¨±å¯"}),e.jsx("div",{className:"text-sm text-gray-600",children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ¡ãƒ³ãƒˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹"})]})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:((n=t.settings.publishing)==null?void 0:n.allowRemix)||!1,onChange:s=>j({publishing:{...t.settings.publishing,allowRemix:s.target.checked}}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:"ğŸ”„ ãƒªãƒŸãƒƒã‚¯ã‚¹è¨±å¯"}),e.jsx("div",{className:"text-sm text-gray-600",children:"ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚²ãƒ¼ãƒ ã‚’æ”¹å¤‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹"})]})]})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"text-red-600 text-sm",children:["âš ï¸ ",f]})})]})]}),e.jsxs("section",{className:"flex flex-wrap gap-4 justify-center",children:[e.jsx("button",{onClick:_,disabled:!t.settings.name||i,className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"ğŸ¯ ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤"}),e.jsx("button",{onClick:M,disabled:!t.settings.name||b||!t.assets.objects.length,className:"flex items-center gap-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-medium transition-colors",children:b?"å…¬é–‹ä¸­...":(x=t.settings.publishing)!=null&&x.isPublished?"ğŸ”„ æ›´æ–°":"ğŸš€ å…¬é–‹"}),e.jsx("button",{onClick:P,className:"flex items-center gap-2 bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"ğŸ“¦ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"})]}),((o=t.settings.publishing)==null?void 0:o.isPublished)&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 bg-green-50 border border-green-200 px-4 py-2 rounded-lg",children:[e.jsx("span",{className:"text-green-600",children:"âœ… å…¬é–‹æ¸ˆã¿"}),((a=t.settings.publishing)==null?void 0:a.publishedAt)&&e.jsx("span",{className:"text-green-600 text-sm",children:new Date(t.settings.publishing.publishedAt).toLocaleString("ja-JP")})]})}),e.jsxs("section",{className:"mt-8 bg-gray-50 rounded-lg p-6",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"ğŸ“Š ã‚²ãƒ¼ãƒ çµ±è¨ˆ"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.assets.objects.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.script.rules.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ãƒ«ãƒ¼ãƒ«"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.assets.texts.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"ãƒ†ã‚­ã‚¹ãƒˆ"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round((t.totalSize||0)/1024/1024*10)/10,"MB"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"ç·å®¹é‡"})]})]})]})]})})},fe=({project:t,onProjectUpdate:l,onSave:i,onPublish:d,onTestPlay:c,tabs:g})=>{var U,_;const[b,m]=u.useState("assets"),[f,N]=u.useState(!1),[h,A]=u.useState(!0),T=p=>{var M,P;l({...p,lastModified:new Date().toISOString(),editorState:{...p.editorState,activeTab:b,lastSaved:new Date().toISOString(),autoSaveEnabled:h,tabStates:((M=p.editorState)==null?void 0:M.tabStates)||{assets:{selectedAssetType:null,selectedAssetId:null,showAnimationEditor:!1},audio:{selectedAudioType:null,selectedAudioId:null,isPlaying:!1},script:{mode:"layout",selectedObjectId:null,selectedRuleId:null,showRuleEditor:!1},settings:{showTestPlay:!1,lastTestResult:null}},ui:((P=p.editorState)==null?void 0:P.ui)||{sidebarCollapsed:!1,previewVisible:!0,capacityMeterExpanded:!1}}}),N(!0)};u.useEffect(()=>{if(h&&f){const p=setTimeout(()=>{i(),N(!1)},v.PROJECT.AUTO_SAVE_INTERVAL);return()=>clearTimeout(p)}},[h,f,i]);const S=(()=>{const p=t.assets;let M=0;return p.background&&(M+=p.background.totalSize),p.objects.forEach(P=>{M+=P.totalSize}),p.audio.bgm&&(M+=p.audio.bgm.fileSize),p.audio.se.forEach(P=>{M+=P.fileSize}),M})(),E=S/v.PROJECT.TOTAL_MAX_SIZE*100,I=g||[{id:"assets",label:"çµµ",icon:"ğŸ¨",description:"ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»èƒŒæ™¯ãƒ»ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†",badge:t.assets.objects.length+(t.assets.background?1:0)+t.assets.texts.length||void 0},{id:"audio",label:"éŸ³",icon:"ğŸµ",description:"éŸ³æ¥½ãƒ»åŠ¹æœéŸ³ç®¡ç†",badge:(t.assets.audio.bgm?1:0)+t.assets.audio.se.length||void 0},{id:"script",label:"ãƒ«ãƒ¼ãƒ«",icon:"âš™ï¸",description:"ã‚²ãƒ¼ãƒ å‹•ä½œãƒ»æ¡ä»¶è¨­å®š",badge:t.script.rules.length||void 0},{id:"settings",label:"å…¬é–‹",icon:"ğŸš€",description:"ã‚²ãƒ¼ãƒ è¨­å®šãƒ»ãƒ†ã‚¹ãƒˆãƒ»å…¬é–‹",badge:(U=t.settings.publishing)!=null&&U.isPublished?"âœ“":void 0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.name||t.settings.name||"ãƒã‚¤ã‚²ãƒ¼ãƒ "}),e.jsxs("p",{className:"text-sm text-gray-500",children:["æœ€çµ‚æ›´æ–°: ",new Date(t.lastModified).toLocaleDateString("ja-JP"),f&&e.jsx("span",{className:"text-orange-500 ml-2",children:"â€¢ æœªä¿å­˜"}),t.status==="published"&&e.jsx("span",{className:"text-green-500 ml-2",children:"â€¢ å…¬é–‹ä¸­"})]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-600",children:"å®¹é‡:"}),e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${E>90?"bg-red-500":E>70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(E,100)}%`}})}),e.jsxs("span",{className:`text-xs ${E>90?"text-red-600":"text-gray-600"}`,children:[(S/1024/1024).toFixed(1),"MB"]})]})}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:p=>A(p.target.checked),className:"rounded"}),e.jsx("span",{className:"text-gray-600",children:"è‡ªå‹•ä¿å­˜"})]}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium text-gray-700 transition-colors",children:"ğŸ’¾ ä¿å­˜"}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:"â–¶ï¸ ãƒ†ã‚¹ãƒˆ"}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-lg font-medium transition-colors",children:"ğŸš€ å…¬é–‹"})]})]})})}),e.jsx("nav",{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"flex space-x-1 py-3",children:I.map(p=>e.jsxs("button",{onClick:()=>m(p.id),className:`relative flex items-center space-x-2 px-6 py-3 rounded-full font-semibold transition-all duration-200 ${b===p.id?"bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-md scale-105":"bg-gray-100 text-gray-600 hover:bg-gray-200 hover:scale-102"}`,children:[e.jsx("span",{className:"text-lg",children:p.icon}),e.jsx("span",{children:p.label}),p.badge&&e.jsx("span",{className:`absolute -top-1 -right-1 min-w-5 h-5 flex items-center justify-center text-xs font-bold rounded-full ${b===p.id?"bg-white text-purple-600":"bg-red-500 text-white"}`,children:p.badge})]},p.id))}),e.jsx("div",{className:"pb-3",children:e.jsx("p",{className:"text-sm text-gray-500",children:(_=I.find(p=>p.id===b))==null?void 0:_.description})})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 min-h-[600px]",children:e.jsxs("div",{className:"p-6",children:[b==="assets"&&e.jsx(de,{project:t,onProjectUpdate:T}),b==="audio"&&e.jsx(ue,{project:t,onProjectUpdate:T}),b==="script"&&e.jsx(me,{project:t,onProjectUpdate:T}),b==="settings"&&e.jsx(be,{project:t,onProjectUpdate:T})]})})}),e.jsx("div",{className:"fixed bottom-6 right-6",children:e.jsx("button",{className:"bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-full shadow-lg transition-colors",children:e.jsx("span",{className:"text-xl",children:"â“"})})}),!1]})},pe=({project:t,onSelect:l,onDelete:i})=>{const d=new Date(t.lastModified),c=Date.now()-d.getTime()<24*60*60*1e3,g={objects:t.assets.objects.length,sounds:t.assets.audio.se.length+(t.assets.audio.bgm?1:0),rules:t.script.rules.length,totalSize:t.totalSize||0},b=(g.totalSize/1024/1024).toFixed(1),m=g.totalSize/v.PROJECT.TOTAL_MAX_SIZE*100;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-300 overflow-hidden group",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-br from-purple-100 to-pink-100 relative",children:[t.thumbnailDataUrl?e.jsx("img",{src:t.thumbnailDataUrl,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-1",children:"ğŸ®"}),e.jsx("div",{className:"text-xs text-gray-500",children:"ã‚µãƒ ãƒã‚¤ãƒ«æœªè¨­å®š"})]})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="published"?"bg-green-100 text-green-800":t.status==="testing"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.status==="published"?"å…¬é–‹æ¸ˆã¿":t.status==="testing"?"ãƒ†ã‚¹ãƒˆä¸­":"ä¸‹æ›¸ã"})}),c&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium",children:"NEW"})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),window.confirm(`ã€Œ${t.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)&&i()},className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-red-500 hover:bg-red-600 text-white p-1 rounded-full text-xs",children:"ğŸ—‘ï¸"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2 line-clamp-1",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3 text-xs text-gray-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-700",children:g.objects}),e.jsx("div",{children:"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-700",children:g.sounds}),e.jsx("div",{children:"éŸ³å£°"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-700",children:g.rules}),e.jsx("div",{children:"ãƒ«ãƒ¼ãƒ«"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"å®¹é‡"}),e.jsxs("span",{children:[b,"MB"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${m>90?"bg-red-500":m>70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(m,100)}%`}})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:["æœ€çµ‚æ›´æ–°: ",d.toLocaleDateString("ja-JP")," ",d.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("button",{onClick:l,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-3 rounded-xl font-medium transition-all duration-200 hover:scale-105",children:"ç·¨é›†ã™ã‚‹"})]})]})},Ne=({onProjectSelect:t,onCreateNew:l})=>{const[i,d]=u.useState([]),[c,g]=u.useState(!0),[b,m]=u.useState(""),[f,N]=u.useState(!1),[h,A]=u.useState("");u.useEffect(()=>{(async()=>{try{g(!0);const I=[{id:"demo-1",name:"ãƒã‚¤ã‚²ãƒ¼ãƒ 1",description:"åˆã‚ã¦ä½œã£ãŸã‚²ãƒ¼ãƒ ã§ã™",createdAt:"2025-09-01T10:00:00.000Z",lastModified:"2025-09-01T15:30:00.000Z",version:"1.0.0",creator:{isAnonymous:!0},status:"draft",totalSize:12*1024*1024,assets:{background:null,objects:[{id:"obj1",name:"ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1",frames:[],animationSettings:{speed:10,loop:!0,pingPong:!1,autoStart:!0},totalSize:2*1024*1024,createdAt:"2025-09-01T10:00:00.000Z",lastModified:"2025-09-01T10:00:00.000Z",defaultScale:1,defaultOpacity:1}],texts:[],audio:{bgm:null,se:[]},statistics:{totalImageSize:0,totalAudioSize:0,totalSize:0,usedSlots:{background:0,objects:1,texts:0,bgm:0,se:0},limitations:{isNearImageLimit:!1,isNearAudioLimit:!1,isNearTotalLimit:!1,hasViolations:!1}},lastModified:"2025-09-01T10:00:00.000Z"},script:{layout:{background:{visible:!0,initialAnimation:0,animationSpeed:10,autoStart:!0},objects:[],texts:[],stage:{backgroundColor:"#ffffff"}},flags:[],rules:[],successConditions:[],statistics:{totalRules:0,totalConditions:0,totalActions:0,complexityScore:0,usedTriggerTypes:[],usedActionTypes:[],flagCount:0,estimatedCPUUsage:"low",estimatedMemoryUsage:0,maxConcurrentEffects:0},version:"1.0.0",lastModified:"2025-09-01T10:00:00.000Z"},settings:{name:"ãƒã‚¤ã‚²ãƒ¼ãƒ 1",duration:{type:"fixed",seconds:10},difficulty:"easy",publishing:{isPublished:!1,visibility:"private",allowComments:!0,allowRemix:!0},preview:{},export:{includeSourceData:!0,compressionLevel:"medium",format:"json"}},metadata:{statistics:{totalEditTime:0,saveCount:0,testPlayCount:0,publishCount:0},usage:{lastOpened:"2025-09-01T10:00:00.000Z",totalOpenCount:1,averageSessionTime:0},performance:{lastBuildTime:0,averageFPS:60,memoryUsage:0}},versionHistory:[],projectSettings:{autoSaveInterval:3e4,backupEnabled:!0,compressionEnabled:!1,maxVersionHistory:10}}];d(I)}catch(I){console.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:",I)}finally{g(!1)}})()},[]);const T=i.filter(E=>{var I;return E.name.toLowerCase().includes(b.toLowerCase())||(((I=E.description)==null?void 0:I.toLowerCase().includes(b.toLowerCase()))??!1)}),j=()=>{h.trim()&&(l(h.trim()),N(!1),A(""))},S=E=>{d(I=>I.filter(U=>U.id!==E))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-pink-50",children:[e.jsx("header",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2",children:"ğŸ® ã‚²ãƒ¼ãƒ ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼"}),e.jsx("p",{className:"text-lg text-gray-600",children:"ç°¡å˜ã«ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã€ã¿ã‚“ãªã«éŠã‚“ã§ã‚‚ã‚‰ãŠã†ï¼"})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢...",value:b,onChange:E=>m(E.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"})}),e.jsx("button",{onClick:()=>N(!0),className:"px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg",children:"âœ¨ æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œã‚‹"})]}),c?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-4xl mb-4",children:"â³"}),e.jsx("p",{className:"text-gray-600",children:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã¿ä¸­..."})]}):T.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ¨"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:b?"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":"ã¾ã ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-600 mb-8",children:b?"åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„":"åˆã‚ã¦ã®ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼"}),!b&&e.jsx("button",{onClick:()=>N(!0),className:"px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-semibold transition-all duration-200 hover:scale-105 shadow-lg",children:"âœ¨ æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œã‚‹"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:T.map(E=>e.jsx(pe,{project:E,onSelect:()=>t(E),onDelete:()=>S(E.id)},E.id))})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-4xl mb-2",children:"âœ¨"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œã‚‹"}),e.jsx("p",{className:"text-gray-600",children:"ã‚²ãƒ¼ãƒ ã®åå‰ã‚’æ±ºã‚ã¾ã—ã‚‡ã†"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("input",{type:"text",value:h,onChange:E=>A(E.target.value),placeholder:"ã‚²ãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent",maxLength:50,onKeyPress:E=>{E.key==="Enter"&&j()},autoFocus:!0}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[h.length,"/50æ–‡å­—"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{N(!1),A("")},className:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsx("button",{onClick:j,disabled:!h.trim(),className:"flex-1 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"ä½œæˆ"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"ğŸ’¡ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆæº–å‚™ä¸­ï¼‰"})})]})}),e.jsx("div",{className:"fixed bottom-6 right-6",children:e.jsx("button",{className:"bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-full shadow-lg transition-colors",children:e.jsx("span",{className:"text-xl",children:"â“"})})})]})},ye=t=>({id:crypto.randomUUID(),name:t.trim(),createdAt:new Date().toISOString(),lastModified:new Date().toISOString(),version:"1.0.0",creator:{isAnonymous:!0},status:"draft",totalSize:0,metadata:{statistics:{totalEditTime:0,saveCount:0,testPlayCount:0,publishCount:0},usage:{lastOpened:new Date().toISOString(),totalOpenCount:1,averageSessionTime:0},performance:{lastBuildTime:0,averageFPS:60,memoryUsage:0}},versionHistory:[{id:crypto.randomUUID(),version:"1.0.0",createdAt:new Date().toISOString(),description:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ",author:"Anonymous",changes:[{type:"added",category:"assets",description:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ",affectedItems:[]}],snapshot:{assetsCount:{background:0,objects:0,texts:0,bgm:0,se:0},rulesCount:0,totalSize:0}}],projectSettings:{autoSaveInterval:3e4,backupEnabled:!0,compressionEnabled:!1,maxVersionHistory:10},assets:{background:null,objects:[],texts:[],audio:{bgm:null,se:[]},statistics:{totalImageSize:0,totalAudioSize:0,totalSize:0,usedSlots:{background:0,objects:0,texts:0,bgm:0,se:0},limitations:{isNearImageLimit:!1,isNearAudioLimit:!1,isNearTotalLimit:!1,hasViolations:!1}},lastModified:new Date().toISOString()},script:{layout:{background:{visible:!1,initialAnimation:0,animationSpeed:10,autoStart:!1},objects:[],texts:[],stage:{backgroundColor:"#ffffff"}},flags:[],rules:[],successConditions:[],statistics:{totalRules:0,totalConditions:0,totalActions:0,complexityScore:0,usedTriggerTypes:[],usedActionTypes:[],flagCount:0,estimatedCPUUsage:"low",estimatedMemoryUsage:0,maxConcurrentEffects:0},version:"1.0.0",lastModified:new Date().toISOString()},settings:{name:t.trim(),duration:{type:"fixed",seconds:10},difficulty:"easy",publishing:{isPublished:!1,visibility:"private",allowComments:!0,allowRemix:!0},preview:{},export:{includeSourceData:!0,compressionLevel:"medium",format:"json"}},editorState:{activeTab:"assets",lastSaved:new Date().toISOString(),autoSaveEnabled:!0,tabStates:{assets:{selectedAssetType:null,selectedAssetId:null,showAnimationEditor:!1},audio:{selectedAudioType:null,selectedAudioId:null,isPlaying:!1},script:{mode:"layout",selectedObjectId:null,selectedRuleId:null,showRuleEditor:!1},settings:{showTestPlay:!1,lastTestResult:null}},ui:{sidebarCollapsed:!1,previewVisible:!0,capacityMeterExpanded:!1}}}),G={PROJECTS:"editor_projects",CURRENT_PROJECT_ID:"editor_current_project_id",AUTO_SAVE_ENABLED:"editor_auto_save_enabled"},je=()=>{const[t,l]=u.useState(null),[i,d]=u.useState(!1),[c,g]=u.useState(null),[b,m]=u.useState(!1),f=u.useCallback((o,a)=>{console.error(`${o} failed:`,a),g(`${o}ã«å¤±æ•—ã—ã¾ã—ãŸ: ${a.message}`),d(!1)},[]),N=u.useCallback(()=>{try{const o=localStorage.getItem(G.PROJECTS);return o?JSON.parse(o):[]}catch(o){return console.error("Failed to load projects from storage:",o),[]}},[]),h=u.useCallback(o=>{try{localStorage.setItem(G.PROJECTS,JSON.stringify(o))}catch(a){console.error("Failed to save projects to storage:",a)}},[]),A=u.useCallback(async(o,a)=>{try{if(d(!0),g(null),!o.trim())throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");if(o.length>50)throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„");const s=ye(o);a&&console.log("Template application for:",a);const r=N(),w=[s,...r];return h(w),l(s),localStorage.setItem(G.CURRENT_PROJECT_ID,s.id),m(!1),s}catch(s){throw f("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ",s),s}finally{d(!1)}},[N,h,f]),T=u.useCallback(async o=>{try{d(!0),g(null);const s=N().find(r=>r.id===o);if(!s)throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");l(s),localStorage.setItem(G.CURRENT_PROJECT_ID,o),m(!1)}catch(a){f("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿",a)}finally{d(!1)}},[N,f]),j=u.useCallback(async o=>{try{d(!0),g(null);const a=o||t;if(!a)throw new Error("ä¿å­˜ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚Šã¾ã›ã‚“");const s={...a,lastModified:new Date().toISOString(),totalSize:re(a),assets:{...a.assets,statistics:ve(a.assets)},script:{...a.script,statistics:Se(a.script)}},r=N(),w=r.findIndex(y=>y.id===s.id);w>=0?r[w]=s:r.unshift(s),h(r),l(s),m(!1)}catch(a){f("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¿å­˜",a)}finally{d(!1)}},[t,N,h,f]),S=u.useCallback(o=>{if(!t)return;const a={...t,...o};l(a),m(!0)},[t]),E=u.useCallback(async o=>{try{d(!0),g(null);const s=N().filter(r=>r.id!==o);h(s),(t==null?void 0:t.id)===o&&(l(null),localStorage.removeItem(G.CURRENT_PROJECT_ID),m(!1))}catch(a){f("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤",a)}finally{d(!1)}},[t,N,h,f]),I=u.useCallback(async(o,a)=>{try{d(!0),g(null);const s=N(),r=s.find(O=>O.id===o);if(!r)throw new Error("è¤‡è£½ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const w={...r,id:crypto.randomUUID(),name:a.trim(),createdAt:new Date().toISOString(),lastModified:new Date().toISOString(),status:"draft",settings:{...r.settings,name:a.trim(),publishing:{...r.settings.publishing,isPublished:!1}}},y=[w,...s];return h(y),w}catch(s){throw f("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¤‡è£½",s),s}finally{d(!1)}},[N,h,f]),U=u.useCallback(o=>{t&&S({assets:{...t.assets,...o}})},[t,S]),_=u.useCallback((o,a)=>{if(!t)return;const s=t.assets;let r={...s};switch(o){case"objects":s.objects.length<v.PROJECT.MAX_OBJECTS&&(r.objects=[...s.objects,a]);break;case"texts":s.texts.length<v.TEXT.MAX_COUNT&&(r.texts=[...s.texts,a]);break;case"audio":a.type==="se"&&s.audio.se.length<v.PROJECT.MAX_SE_COUNT?r.audio={...s.audio,se:[...s.audio.se,a]}:a.type==="bgm"&&(r.audio={...s.audio,bgm:a});break}U(r)},[t,U]),p=u.useCallback((o,a)=>{var w;if(!t)return;const s=t.assets;let r={...s};switch(o){case"background":r.background=null;break;case"objects":r.objects=s.objects.filter(y=>y.id!==a);break;case"texts":r.texts=s.texts.filter(y=>y.id!==a);break;case"audio":((w=s.audio.bgm)==null?void 0:w.id)===a?r.audio={...s.audio,bgm:null}:r.audio={...s.audio,se:s.audio.se.filter(y=>y.id!==a)};break}U(r)},[t,U]),M=u.useCallback(o=>{t&&S({script:{...t.script,...o}})},[t,S]),P=u.useCallback(o=>{if(t&&t.script.rules.length<v.PROJECT.MAX_RULES){const a=[...t.script.rules,o];M({rules:a})}},[t,M]),z=u.useCallback(o=>{if(!t)return;const a=t.script.rules.filter(s=>s.id!==o);M({rules:a})},[t,M]),X=u.useCallback(o=>{t&&S({settings:{...t.settings,...o}})},[t,S]),R=u.useCallback(()=>t?re(t):0,[t]),n=u.useCallback((o,a=0)=>{if(!t)return!1;const s=R(),r=v;if(s+a>r.PROJECT.TOTAL_MAX_SIZE)return!1;switch(o){case"background":return!t.assets.background&&a<=r.IMAGE.BACKGROUND_TOTAL_MAX_SIZE;case"object":return t.assets.objects.length<r.PROJECT.MAX_OBJECTS&&a<=r.IMAGE.OBJECT_TOTAL_MAX_SIZE;case"text":return t.assets.texts.length<r.TEXT.MAX_COUNT;case"bgm":return!t.assets.audio.bgm&&a<=r.AUDIO.BGM_MAX_SIZE;case"se":return t.assets.audio.se.length<r.PROJECT.MAX_SE_COUNT&&a<=r.AUDIO.SE_MAX_SIZE;default:return!1}},[t,R]),x=u.useCallback(()=>{if(!t)return[];const o=[];t.name.trim()||o.push("ã‚²ãƒ¼ãƒ åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");const a=R();return a>v.PROJECT.TOTAL_MAX_SIZE&&o.push(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºãŒåˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™ (${(a/1024/1024).toFixed(1)}MB / ${v.PROJECT.TOTAL_MAX_SIZE/1024/1024}MB)`),t.assets.objects.length===0&&!t.assets.background&&o.push("èƒŒæ™¯ã¾ãŸã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æœ€ä½1ã¤è¿½åŠ ã—ã¦ãã ã•ã„"),t.script.rules.length===0&&o.push("ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã‚’æœ€ä½1ã¤è¨­å®šã—ã¦ãã ã•ã„"),t.script.successConditions.length===0&&o.push("æˆåŠŸæ¡ä»¶ã‚’è¨­å®šã—ã¦ãã ã•ã„"),o},[t,R]);return u.useEffect(()=>{const o=localStorage.getItem(G.CURRENT_PROJECT_ID);o&&T(o).catch(()=>{localStorage.removeItem(G.CURRENT_PROJECT_ID)})},[T]),{currentProject:t,loading:i,error:c,hasUnsavedChanges:b,createProject:A,loadProject:T,saveProject:j,updateProject:S,deleteProject:E,duplicateProject:I,updateAssets:U,addAsset:_,removeAsset:p,updateScript:M,addRule:P,removeRule:z,updateSettings:X,getTotalSize:R,canAddAsset:n,getValidationErrors:x}},re=t=>{let l=0;return t.assets.background&&(l+=t.assets.background.totalSize),t.assets.objects.forEach(i=>{l+=i.totalSize}),t.assets.audio.bgm&&(l+=t.assets.audio.bgm.fileSize),t.assets.audio.se.forEach(i=>{l+=i.fileSize}),l},ve=t=>{let l=0,i=0;return t.background&&(l+=t.background.totalSize),t.objects.forEach(d=>{l+=d.totalSize}),t.audio.bgm&&(i+=t.audio.bgm.fileSize),t.audio.se.forEach(d=>{i+=d.fileSize}),{totalImageSize:l,totalAudioSize:i,totalSize:l+i,usedSlots:{background:t.background?1:0,objects:t.objects.length,texts:t.texts.length,bgm:t.audio.bgm?1:0,se:t.audio.se.length},limitations:{isNearImageLimit:!1,isNearAudioLimit:!1,isNearTotalLimit:!1,hasViolations:!1}}},Se=t=>{let l=0,i=0;t.rules.forEach(c=>{l+=c.triggers.conditions.length,i+=c.actions.length});const d=Math.min(100,Math.round(t.rules.length*10+l*5+i*3+t.flags.length*2+t.successConditions.length*5));return{totalRules:t.rules.length,totalConditions:l,totalActions:i,complexityScore:d,usedTriggerTypes:[],usedActionTypes:[],flagCount:t.flags.length,estimatedCPUUsage:d<30?"low":d<70?"medium":"high",estimatedMemoryUsage:t.rules.length*1024,maxConcurrentEffects:Math.min(10,t.rules.length)}},q={PROJECTS:"editor_projects",PROJECT_PREFIX:"editor_project_",METADATA:"editor_metadata",SETTINGS:"editor_settings"},F=class F{constructor(){W(this,"settings");W(this,"dbPromise",null);this.settings=this.loadSettings(),this.initIndexedDB()}static getInstance(){return F.instance||(F.instance=new F),F.instance}initIndexedDB(){if(typeof window>"u"||!("indexedDB"in window)){console.warn("IndexedDB is not available, falling back to localStorage");return}this.dbPromise=new Promise((l,i)=>{const d=indexedDB.open("GameEditorDB",1);d.onerror=()=>i(d.error),d.onsuccess=()=>l(d.result),d.onupgradeneeded=c=>{const g=c.target.result;if(!g.objectStoreNames.contains("projects")){const b=g.createObjectStore("projects",{keyPath:"id"});b.createIndex("lastModified","lastModified",{unique:!1}),b.createIndex("status","status",{unique:!1})}if(!g.objectStoreNames.contains("assets")){const b=g.createObjectStore("assets",{keyPath:"id"});b.createIndex("projectId","projectId",{unique:!1}),b.createIndex("type","type",{unique:!1})}}})}loadSettings(){try{const l=localStorage.getItem(q.SETTINGS);return l?JSON.parse(l):this.getDefaultSettings()}catch(l){return console.error("Failed to load storage settings:",l),this.getDefaultSettings()}}getDefaultSettings(){return{autoSaveEnabled:!0,autoSaveInterval:v.PROJECT.AUTO_SAVE_INTERVAL,maxProjects:50,compressionEnabled:!0}}saveSettings(l){this.settings={...this.settings,...l},localStorage.setItem(q.SETTINGS,JSON.stringify(this.settings))}async listProjects(){try{if(this.dbPromise){const b=(await this.dbPromise).transaction(["projects"],"readonly").objectStore("projects").getAll();return new Promise((m,f)=>{b.onsuccess=()=>{const N=b.result.map(h=>({id:h.id,name:h.name,lastModified:h.lastModified,status:h.status,size:h.totalSize||0,version:h.version}));N.sort((h,A)=>new Date(A.lastModified).getTime()-new Date(h.lastModified).getTime()),m(N)},b.onerror=()=>f(b.error)})}const l=localStorage.getItem(q.PROJECTS);return(l?JSON.parse(l):[]).map(d=>({id:d.id,name:d.name,lastModified:d.lastModified,status:d.status,size:d.totalSize||0,version:d.version})).sort((d,c)=>new Date(c.lastModified).getTime()-new Date(d.lastModified).getTime())}catch(l){return console.error("Failed to list projects:",l),[]}}async saveProject(l){try{if(this.validateProject(l),l.totalSize&&l.totalSize>v.PROJECT.TOTAL_MAX_SIZE)throw new Error(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µã‚¤ã‚ºãŒåˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™ (${(l.totalSize/1024/1024).toFixed(1)}MB)`);if(this.dbPromise){const b=(await this.dbPromise).transaction(["projects"],"readwrite").objectStore("projects");return new Promise((m,f)=>{const N=b.put(l);N.onsuccess=()=>m(),N.onerror=()=>f(N.error)})}const i=await this.loadAllProjects(),d=i.findIndex(c=>c.id===l.id);d>=0?i[d]=l:i.unshift(l),i.length>this.settings.maxProjects&&i.splice(this.settings.maxProjects),localStorage.setItem(q.PROJECTS,JSON.stringify(i))}catch(i){throw console.error("Failed to save project:",i),i}}async loadProject(l){try{if(this.dbPromise){const b=(await this.dbPromise).transaction(["projects"],"readonly").objectStore("projects").get(l);return new Promise((m,f)=>{b.onsuccess=()=>m(b.result||null),b.onerror=()=>f(b.error)})}return(await this.loadAllProjects()).find(d=>d.id===l)||null}catch(i){return console.error("Failed to load project:",i),null}}async deleteProject(l){try{if(this.dbPromise){const g=(await this.dbPromise).transaction(["projects","assets"],"readwrite"),m=g.objectStore("projects").delete(l),h=g.objectStore("assets").index("projectId").openCursor(IDBKeyRange.only(l));return new Promise((A,T)=>{let j=0;const S=()=>{j++,j>=2&&A()};m.onsuccess=S,m.onerror=()=>T(m.error),h.onsuccess=E=>{const I=E.target.result;I?(I.delete(),I.continue()):S()},h.onerror=()=>T(h.error)})}const d=(await this.loadAllProjects()).filter(c=>c.id!==l);localStorage.setItem(q.PROJECTS,JSON.stringify(d))}catch(i){throw console.error("Failed to delete project:",i),i}}async duplicateProject(l,i){const d=await this.loadProject(l);if(!d)throw new Error("è¤‡è£½ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const c={...d,id:crypto.randomUUID(),name:i.trim(),createdAt:new Date().toISOString(),lastModified:new Date().toISOString(),status:"draft",settings:{...d.settings,name:i.trim(),publishing:{...d.settings.publishing,isPublished:!1}}};return await this.saveProject(c),c}async exportProject(l){const i=await this.loadProject(l);if(!i)throw new Error("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const d={project:i,metadata:{id:i.id,name:i.name,lastModified:i.lastModified,status:i.status,size:i.totalSize||0,version:i.version},exportedAt:new Date().toISOString(),version:"1.0.0"},c=JSON.stringify(d,null,2);return new Blob([c],{type:"application/json"})}async importProject(l){try{const i=await l.text(),d=JSON.parse(i);if(!d.project||!d.metadata)throw new Error("ç„¡åŠ¹ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã™");const c={...d.project,id:crypto.randomUUID(),createdAt:new Date().toISOString(),lastModified:new Date().toISOString(),status:"draft"};return this.validateProject(c),await this.saveProject(c),c}catch(i){throw console.error("Failed to import project:",i),new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ")}}async getStorageStats(){const l=await this.loadAllProjects(),i=l.reduce((c,g)=>c+(g.totalSize||0),0);let d=0;if("storage"in navigator&&"estimate"in navigator.storage)try{const c=await navigator.storage.estimate(),g=c.usage||0;d=(c.quota||0)-g}catch(c){console.warn("Could not estimate storage:",c),d=100*1024*1024}else d=50*1024*1024;return{totalProjects:l.length,totalSize:i,availableSpace:d,lastCleanup:localStorage.getItem("editor_last_cleanup")||"never"}}async cleanupStorage(){try{const l=await this.loadAllProjects(),i=Date.now()-30*24*60*60*1e3,d=l.filter(c=>c.status==="draft"&&new Date(c.lastModified).getTime()<i);for(const c of d)await this.deleteProject(c.id);localStorage.setItem("editor_last_cleanup",new Date().toISOString()),console.log(`Cleaned up ${d.length} old projects`)}catch(l){console.error("Storage cleanup failed:",l)}}async loadAllProjects(){try{if(this.dbPromise){const g=(await this.dbPromise).transaction(["projects"],"readonly").objectStore("projects").getAll();return new Promise((b,m)=>{g.onsuccess=()=>b(g.result||[]),g.onerror=()=>m(g.error)})}const l=localStorage.getItem(q.PROJECTS);return l?JSON.parse(l):[]}catch(l){return console.error("Failed to load all projects:",l),[]}}validateProject(l){if(!l.id)throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDãŒå¿…è¦ã§ã™");if(!l.name.trim())throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãŒå¿…è¦ã§ã™");if(l.name.length>50)throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯50æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„");if(!l.version)throw new Error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¿…è¦ã§ã™");if(!l.assets)throw new Error("ã‚¢ã‚»ãƒƒãƒˆæƒ…å ±ãŒå¿…è¦ã§ã™");if(!l.script)throw new Error("ã‚¹ã‚¯ãƒªãƒ—ãƒˆæƒ…å ±ãŒå¿…è¦ã§ã™");if(!l.settings)throw new Error("è¨­å®šæƒ…å ±ãŒå¿…è¦ã§ã™")}getSettings(){return{...this.settings}}async checkStorageCapacity(l=0){const i=await this.getStorageStats(),d=i.totalSize+l,c=d/i.availableSpace*100;return{canStore:d<i.availableSpace,currentUsage:d,availableSpace:i.availableSpace,warningLevel:c>90?"critical":c>75?"warning":"safe"}}async optimizeAssets(l){return this.settings.compressionEnabled?(console.log("Asset optimization for project:",l.name),{...l,lastModified:new Date().toISOString()}):l}async searchProjects(l){const i=await this.listProjects();if(!l.trim())return i;const d=l.toLowerCase();return i.filter(c=>c.name.toLowerCase().includes(d)||c.id.toLowerCase().includes(d))}async createBackup(){try{const l=await this.loadAllProjects(),i=await this.getStorageStats(),d={version:"1.0.0",createdAt:new Date().toISOString(),stats:i,projects:l},c=JSON.stringify(d,null,2);return new Blob([c],{type:"application/json"})}catch(l){throw console.error("Failed to create backup:",l),new Error("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}}async restoreBackup(l,i="merge"){try{const d=await l.text(),c=JSON.parse(d);if(!c.projects||!Array.isArray(c.projects))throw new Error("ç„¡åŠ¹ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™");if(i==="replace"){const g=await this.listProjects();for(const b of g)await this.deleteProject(b.id)}for(const g of c.projects){const b={...g,id:crypto.randomUUID(),createdAt:new Date().toISOString(),lastModified:new Date().toISOString()};await this.saveProject(b)}}catch(d){throw console.error("Failed to restore backup:",d),new Error("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ")}}enableAutoSave(){this.saveSettings({autoSaveEnabled:!0})}disableAutoSave(){this.saveSettings({autoSaveEnabled:!1})}isAutoSaveEnabled(){return this.settings.autoSaveEnabled}isIndexedDBAvailable(){return this.dbPromise!==null}getStorageType(){return this.dbPromise?"indexeddb":"localstorage"}};W(F,"instance",null);let te=F;const we=[{id:"assets",label:"çµµ",icon:"ğŸ¨",description:"èƒŒæ™¯ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’ç®¡ç†ã—ã¾ã™"},{id:"audio",label:"éŸ³",icon:"ğŸµ",description:"BGMã¨åŠ¹æœéŸ³ã‚’ç®¡ç†ã—ã¾ã™"},{id:"script",label:"ãƒ«ãƒ¼ãƒ«",icon:"âš™ï¸",description:"ã‚²ãƒ¼ãƒ ã®å‹•ä½œãƒ«ãƒ¼ãƒ«ã¨æˆåŠŸæ¡ä»¶ã‚’è¨­å®šã—ã¾ã™"},{id:"settings",label:"å…¬é–‹",icon:"ğŸš€",description:"ã‚²ãƒ¼ãƒ æƒ…å ±ã®è¨­å®šã¨ãƒ†ã‚¹ãƒˆã€å…¬é–‹ã‚’è¡Œã„ã¾ã™"}],Te=(t,l)=>{var i,d,c,g,b,m,f,N,h,A,T,j,S,E;switch(t){case"assets":const I=!!((i=l.assets)!=null&&i.background),U=((c=(d=l.assets)==null?void 0:d.objects)==null?void 0:c.length)>0,_=(I?50:0)+(U?50:0);return{completed:_===100,progress:_};case"audio":const p=!!((b=(g=l.assets)==null?void 0:g.audio)!=null&&b.bgm),M=((N=(f=(m=l.assets)==null?void 0:m.audio)==null?void 0:f.se)==null?void 0:N.length)>0,P=(p?50:0)+(M?50:0);return{completed:P===100,progress:P};case"script":const z=((A=(h=l.script)==null?void 0:h.rules)==null?void 0:A.length)>0,X=((j=(T=l.script)==null?void 0:T.successConditions)==null?void 0:j.length)>0,R=(z?50:0)+(X?50:0);return{completed:R===100,progress:R};case"settings":const n=!!((S=l.name)!=null&&S.trim()),x=!!((E=l.settings)!=null&&E.duration),o=(n?50:0)+(x?50:0);return{completed:o===100,progress:o};default:return{completed:!1,progress:0}}},Ee=t=>we.map(l=>{const{completed:i,progress:d}=Te(l.id,t);return{...l,badge:i?"âœ“":d>0?`${d}%`:void 0}}),Ie=({onClose:t,initialProjectId:l,className:i=""})=>{const[d,c]=u.useState("selector"),[g,b]=u.useState(null),{currentProject:m,loading:f,error:N,hasUnsavedChanges:h,createProject:A,loadProject:T,saveProject:j,updateProject:S,deleteProject:E,duplicateProject:I,getTotalSize:U,getValidationErrors:_}=je();u.useEffect(()=>{l&&M({id:l})},[l]);const p=u.useCallback((s,r)=>{b({type:s,message:r}),setTimeout(()=>b(null),5e3)},[]),M=u.useCallback(async s=>{try{await T(s.id),c("editor"),p("success",`ã€Œ${s.name}ã€ã‚’é–‹ãã¾ã—ãŸ`)}catch(r){p("error",`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`)}},[T,p]),P=u.useCallback(async s=>{try{const r=await A(s);c("editor"),p("success",`ã€Œ${s}ã€ã‚’ä½œæˆã—ã¾ã—ãŸ`)}catch(r){p("error",`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`)}},[A,p]),z=u.useCallback(async()=>{if(m)try{await j(),p("success","ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ")}catch(s){p("error",`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`)}},[m,j,p]),X=u.useCallback(()=>{if(!m)return;const s=_();if(s.length>0){p("error",`ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã§ãã¾ã›ã‚“: ${s[0]}`);return}p("info","ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™"),console.log("Test play for project:",m.name)},[m,_,p]),R=u.useCallback(async()=>{if(!m)return;const s=_();if(s.length>0){p("error",`å…¬é–‹ã§ãã¾ã›ã‚“: ${s[0]}`);return}try{await j(),S({status:"published",settings:{...m.settings,publishing:{...m.settings.publishing,isPublished:!0,publishedAt:new Date().toISOString()}}}),await j(),p("success","ã‚²ãƒ¼ãƒ ã‚’å…¬é–‹ã—ã¾ã—ãŸï¼")}catch(r){p("error",`å…¬é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`)}},[m,_,j,S,p]),n=u.useCallback(()=>{h&&window.confirm("æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ")?z().then(()=>c("selector")):c("selector")},[h,z]),x=u.useCallback(async s=>{try{await E(s),p("success","ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ")}catch(r){p("error",`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`)}},[E,p]),o=u.useCallback(async s=>{try{const w=`${(m||{name:"ã‚³ãƒ”ãƒ¼"}).name} ã®ã‚³ãƒ”ãƒ¼`,y=await I(s,w);p("success",`ã€Œ${y.name}ã€ã‚’ä½œæˆã—ã¾ã—ãŸ`)}catch(r){p("error",`è¤‡è£½ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`)}},[m,I,p]),a=u.useCallback(async s=>{try{const w=await te.getInstance().exportProject(s),y=URL.createObjectURL(w),O=document.createElement("a");O.href=y,O.download=`${(m==null?void 0:m.name)||"project"}_export.json`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(y),p("success","ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ")}catch(r){p("error",`ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.message}`)}},[m,p]);return u.useEffect(()=>{const s=r=>{(r.ctrlKey||r.metaKey)&&r.key==="s"&&(r.preventDefault(),d==="editor"&&z()),r.key==="Escape"&&d==="editor"&&n()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[d,z,n]),u.useEffect(()=>{const s=r=>{h&&(r.preventDefault(),r.returnValue="æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚æœ¬å½“ã«é–‰ã˜ã¾ã™ã‹ï¼Ÿ")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[h]),e.jsxs("div",{className:`editor-app min-h-screen bg-gray-50 ${i}`,children:[f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-2xl text-center",children:[e.jsx("div",{className:"animate-spin text-4xl mb-4",children:"â³"}),e.jsx("p",{className:"text-lg font-semibold text-gray-800",children:"èª­ã¿è¾¼ã¿ä¸­..."})]})}),g&&e.jsx("div",{className:"fixed top-4 right-4 z-40 max-w-md",children:e.jsx("div",{className:`p-4 rounded-2xl shadow-lg border-l-4 ${g.type==="success"?"bg-green-50 border-green-500 text-green-800":g.type==="error"?"bg-red-50 border-red-500 text-red-800":"bg-blue-50 border-blue-500 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xl mr-3",children:g.type==="success"?"âœ…":g.type==="error"?"âŒ":"â„¹ï¸"}),e.jsx("p",{className:"font-medium",children:g.message}),e.jsx("button",{onClick:()=>b(null),className:"ml-auto text-gray-500 hover:text-gray-700",children:"âœ•"})]})})}),N&&e.jsx("div",{className:"fixed top-4 left-4 right-4 z-40",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-500 text-xl mr-3",children:"âš ï¸"}),e.jsx("p",{className:"text-red-800 font-medium flex-1",children:N}),e.jsx("button",{onClick:()=>window.location.reload(),className:"ml-4 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm transition-colors",children:"å†èª­ã¿è¾¼ã¿"})]})})}),d==="selector"?e.jsx(Ne,{onProjectSelect:M,onCreateNew:P,onDelete:x,onDuplicate:o,onExport:a}):m?e.jsxs("div",{children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center py-2",children:[e.jsx("button",{onClick:n,className:"flex items-center space-x-2 px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:e.jsx("span",{children:"â† æˆ»ã‚‹"})}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"text-gray-600",children:["å®¹é‡: ",(U()/1024/1024).toFixed(1),"MB"]}),h&&e.jsx("div",{className:"text-orange-600 font-medium",children:"æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™"})]})]})})}),e.jsx(fe,{project:m,onProjectUpdate:S,onSave:z,onPublish:R,onTestPlay:X,tabs:Ee(m)})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ“‚"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("button",{onClick:n,className:"px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-xl font-medium transition-colors",children:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã«æˆ»ã‚‹"})]})}),e.jsx("div",{className:"fixed bottom-2 left-2 text-xs text-gray-400",children:"Game Editor v1.0.0 - Phase 6.2 å®Œæˆç‰ˆ"})]})};export{Ie as EditorApp};
//# sourceMappingURL=EditorApp-d03081f6.js.map
