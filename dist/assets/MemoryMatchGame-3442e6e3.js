var I=Object.defineProperty;var k=(r,c,n)=>c in r?I(r,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[c]=n;var f=(r,c,n)=>(k(r,typeof c!="symbol"?c+"":c,n),n);import{G as j,C as F,a as S,S as L,T as W}from"./index-0b58e48d.js";function $(r){return r==="easy"||r==="normal"||r==="hard"}function A(r){const c=r.difficulty;return $(c)?c:"normal"}function H(r,c){return c==="easy"?Math.max(2,Math.round(r*.7)):c==="hard"?Math.round(r*1.5):r}function O(r,c,n,a,t){const i=a??r.renderer.width,e=t??r.renderer.height,s=document.createElement("canvas");s.width=i,s.height=e;const o=s.getContext("2d"),d=o.createLinearGradient(0,0,0,e),h=m=>`#${m.toString(16).padStart(6,"0")}`;return d.addColorStop(0,h(c)),d.addColorStop(1,h(n)),o.fillStyle=d,o.fillRect(0,0,i,e),new L(W.from(s))}function T(r,c,n,a=16,t=16777215,i=1){r.clear(),r.beginFill(t,i),r.drawRoundedRect(-c/2,-n/2,c,n,a),r.endFill()}function X(r,c,n,a,t,i){const e=t*.5,s=Math.PI*2/a,o=s/2;r.beginFill(i),r.moveTo(c+Math.cos(-Math.PI/2)*t,n+Math.sin(-Math.PI/2)*t);for(let d=0;d<a;d++){const h=d*s-Math.PI/2,m=h+o;r.lineTo(c+Math.cos(m)*e,n+Math.sin(m)*e),r.lineTo(c+Math.cos(h+s)*t,n+Math.sin(h+s)*t)}r.closePath(),r.endFill()}function Y(r,c=200,n=1.12){let a=0,t=!0;const i=1;return{update(e){if(!t)return;a+=e;const s=Math.min(1,a/c),o=1-Math.pow(1-s,2),d=s<.5?o*2:2-o*2,h=i+(n-i)*d;r(h),s>=1&&(t=!1)},isDone(){return!t}}}const v={girl:{primary:14239471,secondary:16574463,accent:10624175},animal:{primary:16347926,secondary:16775149,accent:15357964},child:{primary:959977,secondary:15792639,accent:165063}};class z extends j{constructor(n,a){super(n,a);f(this,"onGameEnd");f(this,"scene",new F);f(this,"cards",[]);f(this,"first");f(this,"second");f(this,"gridCols",4);f(this,"matchedPairs",0);f(this,"targetPairs",8);f(this,"anims",[]);f(this,"settings");this.settings=a}async createScene(){const n=A(this.settings),a=this.settings.cardPairs??8;this.targetPairs=H(a,n);const t=this.settings.characterType??"girl",i=v[t],e=O(this.app,i.secondary,i.primary);this.scene.addChild(e);const s=this.gridCols,o=Math.ceil(this.targetPairs*2/s),d=this.app.renderer.width,h=this.app.renderer.height,m=Math.min(120,(d-80)/s),u=Math.min(160,(h-200)/o),p=[];for(let l=0;l<this.targetPairs;l++)p.push(l,l);for(let l=p.length-1;l>0;l--){const g=Math.random()*(l+1)|0;[p[l],p[g]]=[p[g],p[l]]}const b=new F;this.scene.addChild(b);const P=(d-s*m)/(s+1),G=(h-160-o*u)/(o+1);for(let l=0;l<p.length;l++){const g=p[l],M=new F;M.eventMode="static",M.cursor="pointer";const C=new S,y=new S;T(y,m,u,22,i.accent,1),T(C,m,u,22,16777215,1);const R=this.createCharacterSymbol(g,t,m,u);C.addChild(R),C.visible=!1,M.addChild(y,C),M.on("pointertap",D=>{D.stopPropagation(),this.handleCardTap(l)});const x=l%s,E=l/s|0;M.x=P+x*(m+P)+m/2,M.y=120+E*(u+G)+u/2,b.addChild(M),this.cards.push({id:g,index:l,root:M,front:C,back:y,flipped:!1,matched:!1})}this.container.addChild(this.scene)}handleInput(n){}handleCardTap(n){if(this.gameState!=="playing")return;const a=this.cards[n];if(!(!a||a.flipped||a.matched)){if(this.flipCard(a,!0),!this.first){this.first=a;return}if(!this.second){this.second=a;const t=this.container.eventMode;this.container.eventMode="none",setTimeout(()=>{this.judge(),this.container.eventMode=t??"auto"},500)}}}updateGame(n){const a=n*16.666666666666668;this.anims=this.anims.filter(t=>(t.update(a),!t.isDone()))}flipCard(n,a){n.flipped=a,n.front.visible=a,n.back.visible=!a;const t=n.root,i=Y(e=>{t.scale.set(e)},200,1.1);this.anims.push(i)}judge(){if(!this.first||!this.second)return;const n=this.first,a=this.second;if(n.id===a.id){n.matched=a.matched=!0,this.matchedPairs++,this.currentScore=this.matchedPairs*100;const t={t:0},i={update:e=>{t.t+=e;const s=Math.min(1,t.t/240);n.root.alpha=a.root.alpha=1-s*.2},isDone:()=>t.t>=240};this.anims.push(i),this.matchedPairs>=this.targetPairs&&setTimeout(()=>{this.endGame(!0)},800)}else setTimeout(()=>{this.flipCard(n,!1),this.flipCard(a,!1)},800);this.first=this.second=void 0}checkWinCondition(){return this.matchedPairs>=this.targetPairs}showResult(n){console.log(`MemoryMatch Game Result: ${n.success?"SUCCESS":"FAILED"}, Score: ${n.score}`),this.onGameEnd&&this.onGameEnd(n.success,n.score)}createCharacterSymbol(n,a,t,i){const e=new S,s=v[a];e.beginFill(16777215),e.drawCircle(0,0,Math.min(t,i)*.22),e.endFill(),e.beginFill(2236962),e.drawCircle(-t*.06,-i*.02,Math.min(t,i)*.03),e.drawCircle(t*.06,-i*.02,Math.min(t,i)*.03),e.endFill();const o=n%4;if(a==="girl")o===0?X(e,t*.1,-i*.15,5,Math.min(t,i)*.06,s.primary):o===1?(e.beginFill(s.primary),e.drawCircle(t*.1,-i*.15,Math.min(t,i)*.04),e.endFill()):o===2?(e.beginFill(s.primary),e.drawRect(-Math.min(t,i)*.03,-i*.18,Math.min(t,i)*.06,Math.min(t,i)*.06),e.endFill()):(e.beginFill(s.accent),e.drawEllipse(0,-i*.15,Math.min(t,i)*.08,Math.min(t,i)*.04),e.endFill());else if(a==="animal"){if(e.beginFill(s.primary),e.drawCircle(-t*.12,-i*.2,Math.min(t,i)*.06),e.drawCircle(t*.12,-i*.2,Math.min(t,i)*.06),e.endFill(),o===0)e.beginFill(s.accent),e.drawEllipse(t*.2,0,Math.min(t,i)*.05,Math.min(t,i)*.02),e.endFill();else if(o===1)e.beginFill(s.accent),e.drawCircle(0,i*.02,Math.min(t,i)*.02),e.endFill();else if(o===2){e.beginFill(s.accent);for(let d=0;d<3;d++)e.drawRect(-Math.min(t,i)*.15,-i*.05+d*Math.min(t,i)*.05,Math.min(t,i)*.3,Math.min(t,i)*.02);e.endFill()}}else a==="child"&&(e.lineStyle(3,s.accent,1),e.drawCircle(0,0,Math.min(t,i)*.24),e.lineStyle(),o===0?(e.beginFill(s.primary),e.drawCircle(-t*.12,i*.04,Math.min(t,i)*.025),e.drawCircle(t*.12,i*.04,Math.min(t,i)*.025),e.endFill()):o===1?(e.beginFill(s.primary),e.drawRect(-Math.min(t,i)*.1,-i*.25,Math.min(t,i)*.2,Math.min(t,i)*.08),e.endFill()):o===2&&(e.lineStyle(2,s.accent,1),e.arc(0,i*.08,Math.min(t,i)*.08,0,Math.PI),e.lineStyle()));return e.x=0,e.y=0,e}}export{z as MemoryMatchGame};
//# sourceMappingURL=MemoryMatchGame-3442e6e3.js.map
