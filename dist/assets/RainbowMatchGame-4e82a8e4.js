var b=Object.defineProperty;var C=(i,a,t)=>a in i?b(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t;var s=(i,a,t)=>(C(i,typeof a!="symbol"?a+"":a,t),t);import{G as H,C as M,a as u,b as x}from"./index-a4c7ba8a.js";function y(i){return i==="easy"||i==="normal"||i==="hard"}function E(i){const a=i.difficulty;return y(a)?a:"normal"}function W(i,a){return typeof i=="number"&&isFinite(i)?Math.max(1e3,Math.round(i*1e3)):a}function T(i,a,t){return Math.max(a,Math.min(t,i))}function R(i){for(let a=i.length-1;a>0;a--){const t=Math.random()*(a+1)|0;[i[a],i[t]]=[i[t],i[a]]}return i}const p={classic:[{name:"RED",hex:15680580},{name:"BLUE",hex:3900150},{name:"GREEN",hex:2278750},{name:"YELLOW",hex:16096779},{name:"PURPLE",hex:11032055},{name:"PINK",hex:15485081}],warm:[{name:"ORANGE",hex:16347926},{name:"RED",hex:15680580},{name:"PINK",hex:15485081},{name:"YELLOW",hex:16096779},{name:"BROWN",hex:9132587},{name:"PURPLE",hex:11032055}],cool:[{name:"BLUE",hex:3900150},{name:"CYAN",hex:440020},{name:"GREEN",hex:2278750},{name:"TEAL",hex:1357990},{name:"INDIGO",hex:6514417},{name:"PURPLE",hex:11032055}]};class G extends H{constructor(t,e){super(t,e);s(this,"onGameEnd");s(this,"scene",new M);s(this,"finished",!1);s(this,"remainMs",3e4);s(this,"ruleText");s(this,"cueText");s(this,"tiles",[]);s(this,"cols",2);s(this,"rows",2);s(this,"tileW",180);s(this,"tileH",140);s(this,"gapX",20);s(this,"gapY",16);s(this,"palette",p.classic);s(this,"mode","mixed");s(this,"options",4);s(this,"targetHits",10);s(this,"hits",0);s(this,"misses",0);s(this,"missesAllowed",3);s(this,"correctIndex",0);s(this,"currentRule","meaning");s(this,"targetColor");s(this,"score",0);s(this,"combo",0)}async createScene(){const t=this.settings,e=E(t),h=this.app.renderer.width,n=this.app.renderer.height;this.remainMs=W(t.duration,3e4),e==="easy"?(this.options=3,this.targetHits=8,this.missesAllowed=4):e==="hard"?(this.options=5,this.targetHits=12,this.missesAllowed=2):(this.options=4,this.targetHits=10,this.missesAllowed=3),typeof t.options=="number"&&isFinite(t.options)&&(this.options=T(Math.round(t.options),3,6)),typeof t.targetHits=="number"&&isFinite(t.targetHits)&&(this.targetHits=T(Math.round(t.targetHits),4,30)),this.mode=t.mode??"mixed",this.palette=p[t.palette??"classic"]??p.classic,this.cols=Math.ceil(Math.sqrt(this.options)),this.rows=Math.ceil(this.options/this.cols);const o=h-80,m=n-220;this.tileW=Math.min(220,Math.floor(o/this.cols)-16),this.tileH=Math.min(160,Math.floor(m/this.rows)-16),this.gapX=Math.max(12,Math.floor((o-this.cols*this.tileW)/(this.cols+1))),this.gapY=Math.max(10,Math.floor((m-this.rows*this.tileH)/(this.rows+1)));const f=new u;f.beginFill(725024),f.drawRect(0,0,h,n),f.endFill(),this.scene.addChild(f),this.ruleText=new x("Rule: MEANING",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(h,n)*.05),fill:16777215,stroke:0,strokeThickness:4}),this.ruleText.anchor.set(.5,.5),this.ruleText.x=h/2,this.ruleText.y=40+this.ruleText.height/2,this.scene.addChild(this.ruleText),this.cueText=new x("BLUE",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(h,n)*.1),fill:16777215,stroke:0,strokeThickness:6}),this.cueText.anchor.set(.5,.5),this.cueText.x=h/2,this.cueText.y=Math.floor(n*.28),this.scene.addChild(this.cueText);for(let c=0;c<this.options;c++){const l=new M,r=new u,d=new x("COLOR",{fontFamily:"sans-serif",fontSize:Math.floor(this.tileH*.38),fill:1118481});d.anchor.set(.5),r.beginFill(16777215,.95),r.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),r.endFill(),l.addChild(r,d),l.eventMode="static";const g=c;l.on("pointertap",w=>{w.stopPropagation(),this.onTap(g)}),this.scene.addChild(l),this.tiles.push({root:l,bg:r,label:d,fillHex:16777215,name:"COLOR",index:g})}this.positionTiles(h,n),this.container.addChild(this.scene),this.nextRound(!0)}handleInput(t){}updateGame(t){if(this.finished)return;const e=t*(1e3/60);if(this.remainMs-=e,this.remainMs<=0){this.remainMs=0,this.finish(this.hits>=this.targetHits);return}}showResult(t){var e;(e=this.onGameEnd)==null||e.call(this,t.success,t.score)}positionTiles(t,e){const h=(t-(this.cols*this.tileW+(this.cols-1)*this.gapX))/2+this.tileW/2,n=Math.floor(e*.46);for(let o=0;o<this.tiles.length;o++){const m=o%this.cols,f=Math.floor(o/this.cols),c=h+m*(this.tileW+this.gapX),l=n+f*(this.tileH+this.gapY),r=this.tiles[o];r.root.x=c,r.root.y=l}}nextRound(t=!1){var m,f;this.currentRule=this.mode==="mixed"?Math.random()<.5?"meaning":"ink":this.mode,this.ruleText.text="Rule: "+(this.currentRule==="meaning"?"MEANING (word)":"INK (color)");const e=this.palette.slice();R(e),this.targetColor=e[0];const h=e[1];this.cueText.text=this.targetColor.name,this.cueText.style={fontFamily:"sans-serif",fontSize:this.cueText.style.fontSize||Math.floor(Math.min(this.app.renderer.width,this.app.renderer.height)*.1),fill:this.currentRule==="ink"?h.hex:16777215,stroke:0,strokeThickness:6};const n=[];this.currentRule==="meaning"?n.push({name:this.targetColor.name,hex:((m=e[1])==null?void 0:m.hex)??this.targetColor.hex}):n.push({name:((f=e[1])==null?void 0:f.name)??this.targetColor.name,hex:this.targetColor.hex});let o=2;for(;n.length<this.options;){const l={name:e[o%e.length].name,hex:e[(o+1)%e.length].hex};if(this.currentRule==="meaning"){if(l.name===this.targetColor.name){o++;continue}}else if(l.hex===this.targetColor.hex){o++;continue}n.push(l),o++}R(n),this.correctIndex=0;for(let c=0;c<this.tiles.length;c++){const l=this.tiles[c],r=n[c];l.fillHex=r.hex,l.name=r.name,l.bg.clear(),l.bg.beginFill(r.hex,.95),l.bg.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),l.bg.endFill(),l.label.text=r.name,l.label.style={fontFamily:"sans-serif",fontSize:Math.floor(this.tileH*.34),fill:1118481,stroke:16777215,strokeThickness:2},(this.currentRule==="meaning"?r.name===this.targetColor.name:r.hex===this.targetColor.hex)&&(this.correctIndex=c)}}onTap(t){if(this.finished)return;if(t===this.correctIndex){this.hits++,this.combo++;const h=60,n=300;if(this.score+=n+Math.min(8,this.combo)*50+h,this.flashTile(this.tiles[t],9627303),this.hits>=this.targetHits){this.finish(!0);return}setTimeout(()=>this.nextRound(),120)}else if(this.combo=0,this.misses++,this.score=Math.max(0,this.score-120),this.flashTile(this.tiles[t],16734810),this.misses>this.missesAllowed){this.finish(!1);return}}flashTile(t,e){const h=new u;h.beginFill(e,.28),h.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),h.endFill(),h.x=t.root.x,h.y=t.root.y,this.scene.addChild(h);const n=8;for(let o=1;o<=n;o++)setTimeout(()=>{h.alpha=Math.max(0,.28*(1-o/n)),o===n&&this.scene.removeChild(h)},o*30)}finish(t){var m;if(this.finished)return;this.finished=!0;const e=Math.round(this.remainMs/8),h=this.hits*80,n=this.misses*100,o=Math.max(0,this.score+e+h-n+(t?700:0));(m=this.onGameEnd)==null||m.call(this,t,o)}}export{G as RainbowMatchGame};
//# sourceMappingURL=RainbowMatchGame-4e82a8e4.js.map
