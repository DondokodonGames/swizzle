import{r as o,j as e}from"./index-a4c7ba8a.js";import{useAuth as F}from"./useAuth-c99b66df.js";const z=({isOpen:d,onClose:c,defaultMode:u="signin"})=>{const{signIn:N,signUp:v,resetPassword:k,loading:n,error:b,clearError:f}=F(),[a,m]=o.useState(u),[s,j]=o.useState({email:"",password:"",confirmPassword:"",username:"",displayName:"",age:"",language:"ja"}),[t,p]=o.useState({}),[x,C]=o.useState(!1),[y,g]=o.useState(!1);o.useEffect(()=>{d&&(m(u),j({email:"",password:"",confirmPassword:"",username:"",displayName:"",age:"",language:"ja"}),p({}),f())},[d,u,f]),o.useEffect(()=>{const r=i=>{i.key==="Escape"&&d&&c()};return d&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow="unset"}},[d,c]);const P=()=>{const r={};if(s.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)||(r.email="メールアドレスの形式が正しくありません"):r.email="メールアドレスを入力してください",a!=="reset"&&(s.password.trim()?s.password.length<6&&(r.password="パスワードは6文字以上である必要があります"):r.password="パスワードを入力してください"),a==="signup"){s.password!==s.confirmPassword&&(r.confirmPassword="パスワードが一致しません"),s.username.trim()?s.username.length<3?r.username="ユーザー名は3文字以上である必要があります":/^[a-zA-Z0-9_]+$/.test(s.username)||(r.username="ユーザー名は英数字とアンダースコアのみ使用できます"):r.username="ユーザー名を入力してください";const i=parseInt(s.age);!s.age.trim()||isNaN(i)?r.age="年齢を入力してください":(i<6||i>100)&&(r.age="年齢は6歳以上100歳以下で入力してください")}return p(r),Object.keys(r).length===0},w=async r=>{if(r.preventDefault(),!!P())try{if(a==="signin")await N(s.email,s.password),c();else if(a==="signup"){const i=parseInt(s.age);if(i<13&&!y){g(!0);return}await v(s.email,s.password,{username:s.username,displayName:s.displayName||s.username,age:i,language:s.language}),c()}else a==="reset"&&(await k(s.email),alert("パスワードリセットメールを送信しました。メールをご確認ください。"),m("signin"))}catch(i){console.error("Auth error:",i)}},l=r=>{const{name:i,value:E}=r.target;j(h=>({...h,[i]:E})),t[i]&&p(h=>({...h,[i]:""}))};return d?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:c}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-all",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:c,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",disabled:n,children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"🎮"})}),e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:[a==="signin"&&"ログイン",a==="signup"&&"アカウント作成",a==="reset"&&"パスワードリセット"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:[a==="signin"&&"ゲーム作成を始めましょう！",a==="signup"&&"新しいアカウントを作成",a==="reset"&&"メールアドレスを入力してください"]})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm",children:b}),y&&e.jsxs("div",{className:"mb-4 p-4 bg-amber-50 border border-amber-200 rounded-xl",children:[e.jsx("h3",{className:"font-semibold text-amber-800 mb-2",children:"⚠️ 保護者の同意について"}),e.jsx("p",{className:"text-amber-700 text-sm mb-3",children:"13歳未満のお子様には保護者の同意が必要です。保護者の方と一緒にアカウントを作成してください。"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-3 py-1 bg-white border border-amber-300 text-amber-700 rounded-lg text-sm",children:"キャンセル"}),e.jsx("button",{type:"button",onClick:()=>{g(!1),w({preventDefault:()=>{}})},className:"px-3 py-1 bg-amber-600 text-white rounded-lg text-sm",children:"同意して続ける"})]})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:l,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors ${t.email?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"your@example.com",disabled:n}),t.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.email})]}),a!=="reset"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:x?"text":"password",id:"password",name:"password",value:s.password,onChange:l,className:`w-full px-4 py-3 pr-12 border rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors ${t.password?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"6文字以上",disabled:n}),e.jsx("button",{type:"button",onClick:()=>C(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:n,children:x?"🙈":"👁️"})]}),t.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.password})]}),a==="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード確認"}),e.jsx("input",{type:x?"text":"password",id:"confirmPassword",name:"confirmPassword",value:s.confirmPassword,onChange:l,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors ${t.confirmPassword?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"パスワードを再入力",disabled:n}),t.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.confirmPassword})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"ユーザー名"}),e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:l,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors ${t.username?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"半角英数字とアンダースコア",disabled:n}),t.username&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.username})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:["表示名 ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(任意)"})]}),e.jsx("input",{type:"text",id:"displayName",name:"displayName",value:s.displayName,onChange:l,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors",placeholder:"みんなに表示される名前",disabled:n})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 mb-1",children:"年齢"}),e.jsx("input",{type:"number",id:"age",name:"age",value:s.age,onChange:l,className:`w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors ${t.age?"border-red-300 bg-red-50":"border-gray-300"}`,placeholder:"15",min:"6",max:"100",disabled:n}),t.age&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.age})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 mb-1",children:"言語"}),e.jsxs("select",{id:"language",name:"language",value:s.language,onChange:l,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors",disabled:n,children:[e.jsx("option",{value:"ja",children:"日本語"}),e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ko",children:"한국어"}),e.jsx("option",{value:"zh",children:"中文"})]})]})]})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-xl font-semibold hover:from-pink-600 hover:to-purple-700 focus:ring-4 focus:ring-pink-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"処理中..."]}):e.jsxs(e.Fragment,{children:[a==="signin"&&"ログイン",a==="signup"&&"アカウント作成",a==="reset"&&"リセットメール送信"]})})]}),e.jsxs("div",{className:"mt-6 text-center text-sm",children:[a==="signin"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-600",children:["まだアカウントをお持ちでない方は"," ",e.jsx("button",{type:"button",onClick:()=>m("signup"),className:"text-pink-600 hover:text-pink-700 font-medium",disabled:n,children:"アカウント作成"})]}),e.jsx("p",{className:"mt-2",children:e.jsx("button",{type:"button",onClick:()=>m("reset"),className:"text-gray-500 hover:text-gray-700",disabled:n,children:"パスワードを忘れた方"})})]}),a==="signup"&&e.jsxs("p",{className:"text-gray-600",children:["既にアカウントをお持ちの方は"," ",e.jsx("button",{type:"button",onClick:()=>m("signin"),className:"text-pink-600 hover:text-pink-700 font-medium",disabled:n,children:"ログイン"})]}),a==="reset"&&e.jsx("p",{className:"text-gray-600",children:e.jsx("button",{type:"button",onClick:()=>m("signin"),className:"text-pink-600 hover:text-pink-700 font-medium",disabled:n,children:"ログインに戻る"})})]})]})})]}):null};export{z as default};
//# sourceMappingURL=AuthModal-64200e9d.js.map
