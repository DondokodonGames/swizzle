var f=Object.defineProperty;var p=(e,o,s)=>o in e?f(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s;var t=(e,o,s)=>(p(e,typeof o!="symbol"?o+"":o,s),s);import{G as M,C as u,a as d,b as l}from"./index-a4c7ba8a.js";function x(e){return e==="easy"||e==="normal"||e==="hard"}function T(e){const o=e.difficulty;return x(o)?o:"normal"}function b(e,o){return typeof e=="number"&&isFinite(e)?Math.max(1e3,Math.round(e*1e3)):o}function r(e,o,s){return Math.max(o,Math.min(s,e))}class w extends M{constructor(s,i){super(s,i);t(this,"onGameEnd");t(this,"scene",new u);t(this,"finished",!1);t(this,"remainMs",3e4);t(this,"titleText");t(this,"infoText");t(this,"promptText");t(this,"smallText");t(this,"bar");t(this,"bg");t(this,"phase","ready");t(this,"phaseRemain",0);t(this,"minDelay",800);t(this,"maxDelay",2200);t(this,"timeoutMs",1200);t(this,"resultShowMs",700);t(this,"trialsNeeded",7);t(this,"successes",0);t(this,"misses",0);t(this,"missesAllowed",3);t(this,"bestMs",1/0);t(this,"lastMs",0);t(this,"goElapsed",0);t(this,"waitTarget",0);t(this,"score",0);t(this,"colors",{bgWaitTop:725024,bgWaitBottom:1382955,bgGoTop:1483594,bgGoBottom:417606,bad:15680580,text:16777215,barBack:3621201,barFill:3900150})}async createScene(){const s=this.settings,i=T(s),h=this.app.renderer.width,a=this.app.renderer.height;this.remainMs=b(s.duration,3e4),i==="easy"?(this.trialsNeeded=5,this.missesAllowed=4,this.minDelay=700,this.maxDelay=2e3,this.timeoutMs=1400,this.resultShowMs=800):i==="hard"?(this.trialsNeeded=9,this.missesAllowed=2,this.minDelay=900,this.maxDelay=2600,this.timeoutMs=1e3,this.resultShowMs=600):(this.trialsNeeded=7,this.missesAllowed=3,this.minDelay=800,this.maxDelay=2200,this.timeoutMs=1200,this.resultShowMs=700),typeof s.trials=="number"&&isFinite(s.trials)&&(this.trialsNeeded=r(Math.round(s.trials),3,30)),typeof s.minDelayMs=="number"&&isFinite(s.minDelayMs)&&(this.minDelay=r(Math.round(s.minDelayMs),200,4e3)),typeof s.maxDelayMs=="number"&&isFinite(s.maxDelayMs)&&(this.maxDelay=r(Math.round(s.maxDelayMs),this.minDelay+200,8e3)),typeof s.timeoutMs=="number"&&isFinite(s.timeoutMs)&&(this.timeoutMs=r(Math.round(s.timeoutMs),400,6e3)),typeof s.missesAllowed=="number"&&isFinite(s.missesAllowed)&&(this.missesAllowed=r(Math.round(s.missesAllowed),0,10)),typeof s.resultShowMs=="number"&&isFinite(s.resultShowMs)&&(this.resultShowMs=r(Math.round(s.resultShowMs),200,4e3)),s.palette==="forest"?(this.colors.bgWaitTop=1332013,this.colors.bgWaitBottom=339478,this.colors.bgGoTop=2278750,this.colors.bgGoBottom=1467700,this.colors.barFill=3462041):s.palette==="neon"?(this.colors.bgWaitTop=2036039,this.colors.bgWaitBottom=721709,this.colors.bgGoTop=14239471,this.colors.bgGoBottom=8141549,this.colors.barFill=10980346):s.palette==="night"&&(this.colors.bgWaitTop=725024,this.colors.bgWaitBottom=1382955,this.colors.bgGoTop=1920728,this.colors.bgGoBottom=1981066,this.colors.barFill=3900150),this.bg=new d,this.scene.addChild(this.bg),this.titleText=new l("Reaction Speed",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(h,a)*.06),fill:this.colors.text,stroke:0,strokeThickness:5}),this.titleText.anchor.set(.5),this.titleText.x=h/2,this.titleText.y=Math.floor(a*.18),this.scene.addChild(this.titleText),this.infoText=new l("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(h,a)*.045),fill:this.colors.text,stroke:0,strokeThickness:4}),this.infoText.anchor.set(.5),this.infoText.x=h/2,this.infoText.y=Math.floor(a*.26),this.scene.addChild(this.infoText),this.promptText=new l("Ready?",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(h,a)*.12),fill:this.colors.text,stroke:0,strokeThickness:8}),this.promptText.anchor.set(.5),this.promptText.x=h/2,this.promptText.y=Math.floor(a*.46),this.scene.addChild(this.promptText),this.smallText=new l("Tap when it says TAP!",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(h,a)*.035),fill:this.colors.text,stroke:0,strokeThickness:3}),this.smallText.anchor.set(.5),this.smallText.x=h/2,this.smallText.y=Math.floor(a*.58),this.scene.addChild(this.smallText),this.bar=new d,this.scene.addChild(this.bar),this.scene.eventMode="static",this.scene.on("pointerdown",n=>{n.stopPropagation(),this.onTap()}),this.container.addChild(this.scene),this.nextTrial(!0)}handleInput(s){}updateGame(s){if(this.finished)return;const i=s*(1e3/60);if(this.remainMs-=i,this.remainMs<=0){this.remainMs=0,this.finish(this.successes>=this.trialsNeeded);return}this.phaseRemain-=i,this.phase==="waiting"?this.phaseRemain<=0&&this.switchToGo():this.phase==="go"?(this.goElapsed+=i,this.goElapsed>this.timeoutMs&&this.registerMiss("timeout")):this.phase==="result"&&this.phaseRemain<=0&&this.nextTrial(),this.drawBackground(),this.drawBar(),this.updateInfo()}showResult(s){var i;(i=this.onGameEnd)==null||i.call(this,s.success,s.score)}updateInfo(){const s=Math.ceil(this.remainMs/1e3),i=isFinite(this.bestMs)?`${this.bestMs|0}ms`:"—";this.infoText.text=`Success ${this.successes}/${this.trialsNeeded}   Miss ${this.misses}/${this.missesAllowed}   Best ${i}   Time ${s}s`}drawBackground(){const s=this.app.renderer.width,i=this.app.renderer.height,h=this.phase==="go"?this.colors.bgGoTop:this.colors.bgWaitTop,a=this.phase==="go"?this.colors.bgGoBottom:this.colors.bgWaitBottom;this.bg.clear(),this.bg.beginFill(h),this.bg.drawRect(0,0,s,Math.floor(i*.45)),this.bg.endFill(),this.bg.beginFill(a),this.bg.drawRect(0,Math.floor(i*.45),s,i),this.bg.endFill()}drawBar(){const s=this.app.renderer.width,i=Math.floor(this.app.renderer.height*.66),h=Math.floor(s*.7),a=Math.floor((s-h)/2),n=12;if(this.bar.clear(),this.phase==="go"){const m=r(1-this.goElapsed/this.timeoutMs,0,1);this.bar.beginFill(3621201,.35),this.bar.drawRoundedRect(a,i,h,n,6),this.bar.endFill(),this.bar.beginFill(this.colors.barFill,.95),this.bar.drawRoundedRect(a,i,Math.floor(h*m),n,6),this.bar.endFill()}}nextTrial(s=!1){this.phase="waiting",this.waitTarget=this.minDelay+Math.random()*(this.maxDelay-this.minDelay),this.phaseRemain=this.waitTarget,this.goElapsed=0,this.promptText.text="WAIT...",this.smallText.text="Don’t tap early!",s||this.updateInfo()}switchToGo(){this.phase="go",this.goElapsed=0,this.promptText.text="TAP!",this.smallText.text="Tap now!"}onTap(){if(!this.finished)if(this.phase==="waiting")this.registerMiss("early");else if(this.phase==="go"){const s=Math.max(0,Math.round(this.goElapsed));this.lastMs=s,this.bestMs=Math.min(this.bestMs,s),this.successes++;const i=r(800-s,100,800);this.score+=i,this.promptText.text=`${s} ms`,this.smallText.text="Nice!",this.phase="result",this.phaseRemain=this.resultShowMs,this.successes>=this.trialsNeeded&&this.finish(!0)}else this.phase==="result"||this.phase==="ready"&&this.nextTrial()}registerMiss(s){this.misses++;const i=s==="early"?"EARLY!":"TOO SLOW!";this.promptText.text=i,this.smallText.text=s==="early"?"Wait for TAP!":"Try to react faster",this.score=Math.max(0,this.score-120),this.phase="result",this.phaseRemain=Math.max(400,this.resultShowMs-200),this.misses>this.missesAllowed&&this.finish(!1)}finish(s){var c;if(this.finished)return;this.finished=!0;const i=Math.round(this.remainMs/6),h=this.successes*60,a=this.misses*140,n=isFinite(this.bestMs)?r(500-this.bestMs,0,420):0,m=Math.max(0,this.score+i+h+n-a+(s?700:0));(c=this.onGameEnd)==null||c.call(this,s,m)}}export{w as ReactionSpeedGame};
//# sourceMappingURL=ReactionSpeedGame-bd30dad7.js.map
