var P=Object.defineProperty;var F=(r,d,t)=>d in r?P(r,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[d]=t;var n=(r,d,t)=>(F(r,typeof d!="symbol"?d+"":d,t),t);import{G as T,C as D,a as x,b as G}from"./index-a4c7ba8a.js";function R(r){return r==="easy"||r==="normal"||r==="hard"}function S(r){const d=r.difficulty;return R(d)?d:"normal"}function I(r,d){return typeof r=="number"&&isFinite(r)?Math.max(1e3,Math.round(r*1e3)):d}function M(r,d,t){return Math.max(d,Math.min(t,r))}class B extends T{constructor(t,s){super(t,s);n(this,"onGameEnd");n(this,"scene",new D);n(this,"finished",!1);n(this,"remainMs",3e4);n(this,"pathG");n(this,"animalG");n(this,"pointerDot");n(this,"infoText");n(this,"path",[]);n(this,"pathIdx",0);n(this,"speed",220);n(this,"animalR",18);n(this,"pointerDown",!1);n(this,"ptrX",0);n(this,"ptrY",0);n(this,"tolerance",40);n(this,"targetChase",12e3);n(this,"chasedMs",0);n(this,"strayMs",0);n(this,"strayMax",3e3);n(this,"score",0);n(this,"combo",0);n(this,"colors",{bgTop:1332013,bgBottom:339478,path:9564867,animal:16777215,halo:16773542,good:9627303,bad:16734810,text:16777215})}async createScene(){const t=this.settings,s=S(t),i=this.app.renderer.width,l=this.app.renderer.height;this.remainMs=I(t.duration,3e4),s==="easy"?(this.targetChase=1e4,this.tolerance=48,this.strayMax=5e3,this.speed=200):s==="hard"?(this.targetChase=14e3,this.tolerance=34,this.strayMax=2500,this.speed=250):(this.targetChase=12e3,this.tolerance=40,this.strayMax=3e3,this.speed=220),typeof t.targetChaseSec=="number"&&isFinite(t.targetChaseSec)&&(this.targetChase=M(Math.round(t.targetChaseSec*1e3),2e3,6e4)),typeof t.tolerancePx=="number"&&isFinite(t.tolerancePx)&&(this.tolerance=M(Math.round(t.tolerancePx),12,120)),typeof t.allowStrayMs=="number"&&isFinite(t.allowStrayMs)&&(this.strayMax=M(Math.round(t.allowStrayMs),500,15e3)),typeof t.speedPxPerSec=="number"&&isFinite(t.speedPxPerSec)&&(this.speed=M(Math.round(t.speedPxPerSec),80,400));const c=M(Math.round(t.pathComplexity??(s==="easy"?4:s==="hard"?8:6)),3,12),h=!!t.hidePath;t.palette==="ocean"?(this.colors.bgTop=959977,this.colors.bgBottom=142404,this.colors.path=11985919):t.palette==="twilight"&&(this.colors.bgTop=3152180,this.colors.bgBottom=1706782,this.colors.path=16304127);const a=new x;a.beginFill(this.colors.bgTop),a.drawRect(0,0,i,Math.floor(l*.45)),a.endFill(),a.beginFill(this.colors.bgBottom),a.drawRect(0,Math.floor(l*.45),i,l),a.endFill(),this.scene.addChild(a),this.infoText=new G("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(i,l)*.05),fill:this.colors.text,stroke:0,strokeThickness:5}),this.infoText.anchor.set(.5),this.infoText.x=i/2,this.infoText.y=Math.floor(l*.2),this.scene.addChild(this.infoText),this.updateInfo(),this.path=this.generatePath(i,l,c),this.pathG=new x,h||(this.drawPath(),this.scene.addChild(this.pathG)),this.animalG=new x,this.drawAnimal(this.path[0].x,this.path[0].y),this.scene.addChild(this.animalG),this.pointerDot=new x,this.pointerDot.alpha=0,this.scene.addChild(this.pointerDot),this.scene.eventMode="static",this.scene.on("pointerdown",e=>{e.stopPropagation(),this.onDown(e)}),this.scene.on("pointermove",e=>{e.stopPropagation(),this.onMove(e)}),this.scene.on("pointerup",e=>{e.stopPropagation(),this.onUp()}),this.scene.on("pointerupoutside",e=>{e.stopPropagation(),this.onUp()}),this.container.addChild(this.scene)}handleInput(t){}updateGame(t){if(this.finished)return;const s=t*(1e3/60),i=s/1e3;if(this.remainMs-=s,this.remainMs<=0){this.remainMs=0,this.finish(this.chasedMs>=this.targetChase);return}const l=this.speed*i;if(this.advanceAlongPath(l),this.pointerDown){const c=this.animalG.x,h=this.animalG.y,a=this.ptrX-c,e=this.ptrY-h;if(Math.sqrt(a*a+e*e)<=this.tolerance)this.chasedMs+=s,this.combo++,this.combo%6===0&&(this.score+=10),this.flashRing(c,h,this.colors.good,Math.max(this.animalR+6,this.tolerance*.7),.1);else if(this.strayMs+=s,this.combo=0,this.strayMs%400<s&&this.flashRing(c,h,this.colors.bad,this.tolerance,.1),this.strayMs>this.strayMax){this.finish(!1);return}this.updateInfo()}}showResult(t){var s;(s=this.onGameEnd)==null||s.call(this,t.success,t.score)}generatePath(t,s,i){const c=Math.floor(s*.22),h=s-c-40,a=[];for(let o=0;o<=i;o++){const p=40+o/i*(t-80),f=s/2,m=h*.35,g=f+(Math.sin(o*1.2)+(Math.random()-.5)*1)*m*(o===0||o===i?.4:1);a.push({x:p,y:g})}const e=[],y=6;for(let o=0;o<a.length-1;o++){const p=a[o],f=a[o+1],m=f.x-p.x,g=f.y-p.y,C=Math.sqrt(m*m+g*g),w=Math.max(1,Math.round(C/y));for(let u=0;u<w;u++){const b=u/w;e.push({x:p.x+m*b,y:p.y+g*b})}}e.push(a[a.length-1]);for(let o=1;o<e.length;o++){const p=e[o].x-e[o-1].x,f=e[o].y-e[o-1].y;e[o].d=Math.sqrt(p*p+f*f)}return e}drawPath(){const t=this.pathG;if(t.clear(),t.lineStyle(6,this.colors.path,.8),this.path.length!==0){t.moveTo(this.path[0].x,this.path[0].y);for(let s=1;s<this.path.length;s++)t.lineTo(this.path[s].x,this.path[s].y)}}drawAnimal(t,s){const i=this.animalG;i.clear(),i.beginFill(this.colors.animal,1),i.drawCircle(0,0,this.animalR),i.endFill(),i.beginFill(1118481,.9),i.drawCircle(this.animalR*.35,-this.animalR*.65,this.animalR*.28),i.endFill(),i.beginFill(1118481,.9),i.drawCircle(this.animalR*.35,-this.animalR*.1,this.animalR*.12),i.endFill(),i.x=t,i.y=s}advanceAlongPath(t){if(this.path.length<2)return;let s=t;for(;s>0&&this.pathIdx<this.path.length-1;){const l=this.path[this.pathIdx+1],c=l.d||0;if(c<=s)s-=c,this.pathIdx++;else{const h=this.path[this.pathIdx],a=h.x+(l.x-h.x)*(s/c),e=h.y+(l.y-h.y)*(s/c);this.drawAnimal(a,e);return}}const i=this.path[this.path.length-1];this.drawAnimal(i.x,i.y),this.pathIdx>=this.path.length-1&&(this.pathIdx=0)}onDown(t){if(this.finished)return;const s=this.scene.toLocal(t.global);this.pointerDown=!0,this.ptrX=s.x,this.ptrY=s.y,this.renderPointerDot()}onMove(t){if(this.finished)return;const s=this.scene.toLocal(t.global);this.ptrX=s.x,this.ptrY=s.y,this.pointerDown&&this.renderPointerDot()}onUp(){this.finished||(this.pointerDown=!1,this.pointerDot.alpha=0)}renderPointerDot(){const t=this.pointerDot;t.clear(),t.beginFill(this.colors.halo,.8),t.drawCircle(this.ptrX,this.ptrY,6),t.endFill(),t.alpha=1}flashRing(t,s,i,l,c=.18){const h=new x;h.beginFill(i,c),h.drawCircle(0,0,l),h.endFill(),h.x=t,h.y=s,this.scene.addChild(h);const a=8;for(let e=1;e<=a;e++)setTimeout(()=>{h.alpha=Math.max(0,c*(1-e/a)),e===a&&this.scene.removeChild(h)},e*30)}updateInfo(){const t=Math.ceil(this.remainMs/1e3),s=Math.floor(this.chasedMs/1e3),i=Math.floor(this.targetChase/1e3);this.infoText.text=`Chase ${s}/${i}s   Time ${t}s`}finish(t){var h;if(this.finished)return;this.finished=!0;const s=Math.round(this.remainMs/8),i=Math.round(this.chasedMs/20),l=Math.round(this.strayMs/15),c=Math.max(0,this.score+s+i-l+(t?700:0));(h=this.onGameEnd)==null||h.call(this,t,c)}}export{B as AnimalChaseGame};
//# sourceMappingURL=AnimalChaseGame-135d25b6.js.map
