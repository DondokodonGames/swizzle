var u=Object.defineProperty;var b=(h,o,t)=>o in h?u(h,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[o]=t;var i=(h,o,t)=>(b(h,typeof o!="symbol"?o+"":o,t),t);import{G as M,C as x,a as c,b as f}from"./index-a4c7ba8a.js";function p(h){return h==="easy"||h==="normal"||h==="hard"}function g(h){const o=h.difficulty;return p(o)?o:"normal"}function w(h,o){return typeof h=="number"&&isFinite(h)?Math.max(1e3,Math.round(h*1e3)):o}function l(h,o,t){return Math.max(o,Math.min(t,h))}class y extends M{constructor(t,e){super(t,e);i(this,"onGameEnd");i(this,"scene",new x);i(this,"finished",!1);i(this,"remainMs",3e4);i(this,"infoText");i(this,"hintText");i(this,"timeBar");i(this,"cx",0);i(this,"cy",0);i(this,"barLen",420);i(this,"barH",24);i(this,"bar");i(this,"ball");i(this,"ballR",18);i(this,"theta",0);i(this,"maxAngle",Math.PI/7);i(this,"tiltRate",Math.PI/180*85);i(this,"control",0);i(this,"u",0);i(this,"v",0);i(this,"gravity",800);i(this,"driftAmp",140);i(this,"driftT",0);i(this,"friction",.12);i(this,"roundsNeeded",8);i(this,"roundsDone",0);i(this,"roundTimeMs",2800);i(this,"roundRemain",2800);i(this,"misses",0);i(this,"missesAllowed",3);i(this,"score",0);i(this,"stabilityAccum",0);i(this,"colors",{bgTop:3152180,bgBottom:1706782,bar:16777215,ball:16777215,good:9627303,bad:16734810,text:16777215,deco:9741240,barEdge:16096779,barFill:16777215,barShadow:0,barBack:3621201,barFillUI:16739179})}async createScene(){const t=this.settings,e=g(t),s=this.app.renderer.width,n=this.app.renderer.height;this.remainMs=w(t.duration,3e4),e==="easy"?(this.roundsNeeded=6,this.roundTimeMs=3e3,this.missesAllowed=4,this.barLen=Math.min(520,Math.floor(s*.74)),this.ballR=20,this.tiltRate=Math.PI/180*90,this.maxAngle=Math.PI/180*22,this.driftAmp=110,this.friction=.16):e==="hard"?(this.roundsNeeded=10,this.roundTimeMs=2400,this.missesAllowed=2,this.barLen=Math.min(460,Math.floor(s*.68)),this.ballR=18,this.tiltRate=Math.PI/180*80,this.maxAngle=Math.PI/180*28,this.driftAmp=170,this.friction=.08):(this.roundsNeeded=8,this.roundTimeMs=2800,this.missesAllowed=3,this.barLen=Math.min(500,Math.floor(s*.72)),this.ballR=19,this.tiltRate=Math.PI/180*85,this.maxAngle=Math.PI/180*25,this.driftAmp=140,this.friction=.12),typeof t.rounds=="number"&&isFinite(t.rounds)&&(this.roundsNeeded=l(Math.round(t.rounds),3,30)),typeof t.roundTimeMs=="number"&&isFinite(t.roundTimeMs)&&(this.roundTimeMs=l(Math.round(t.roundTimeMs),1200,6e3)),typeof t.missesAllowed=="number"&&isFinite(t.missesAllowed)&&(this.missesAllowed=l(Math.round(t.missesAllowed),0,10)),typeof t.barLengthPx=="number"&&isFinite(t.barLengthPx)&&(this.barLen=l(Math.round(t.barLengthPx),200,Math.floor(s*.9))),typeof t.ballRadiusPx=="number"&&isFinite(t.ballRadiusPx)&&(this.ballR=l(Math.round(t.ballRadiusPx),8,40)),typeof t.tiltDegPerSec=="number"&&isFinite(t.tiltDegPerSec)&&(this.tiltRate=Math.PI/180*l(Math.round(t.tiltDegPerSec),30,180)),typeof t.maxAngleDeg=="number"&&isFinite(t.maxAngleDeg)&&(this.maxAngle=Math.PI/180*l(Math.round(t.maxAngleDeg),10,40)),typeof t.driftAmp=="number"&&isFinite(t.driftAmp)&&(this.driftAmp=l(Math.round(t.driftAmp),40,320)),typeof t.friction=="number"&&isFinite(t.friction)&&(this.friction=l(t.friction,.02,.4)),t.palette==="forest"?(this.colors.bgTop=1332013,this.colors.bgBottom=339478,this.colors.barFillUI=3462041):t.palette==="night"?(this.colors.bgTop=725024,this.colors.bgBottom=1382955,this.colors.barFillUI=3900150):(this.colors.bgTop=3152180,this.colors.bgBottom=1706782,this.colors.barFillUI=16739179),this.cx=Math.floor(s*.5),this.cy=Math.floor(n*.62);const a=new c;a.beginFill(this.colors.bgTop),a.drawRect(0,0,s,Math.floor(n*.45)),a.endFill(),a.beginFill(this.colors.bgBottom),a.drawRect(0,Math.floor(n*.45),s,n),a.endFill(),this.scene.addChild(a);for(let r=0;r<5;r++){const d=new c;d.lineStyle(2,this.colors.deco,.25);const m=(r+1)*(s/6);d.moveTo(m,0),d.lineTo(m,n),this.scene.addChild(d)}this.infoText=new f("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(s,n)*.045),fill:this.colors.text,stroke:0,strokeThickness:4}),this.infoText.anchor.set(.5),this.infoText.x=s/2,this.infoText.y=Math.floor(n*.2),this.scene.addChild(this.infoText),this.updateInfo(),this.hintText=new f("Tap LEFT/RIGHT to tilt",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(s,n)*.04),fill:this.colors.text,stroke:0,strokeThickness:4}),this.hintText.anchor.set(.5),this.hintText.x=s/2,this.hintText.y=Math.floor(n*.28),this.scene.addChild(this.hintText),this.timeBar=new c,this.scene.addChild(this.timeBar),this.bar=new c,this.drawBar(),this.scene.addChild(this.bar),this.ball=new c,this.u=0,this.v=0,this.theta=0,this.drawBall(),this.scene.addChild(this.ball),this.scene.eventMode="static",this.scene.on("pointerdown",r=>{const d=r.global.x;this.control=d<this.app.renderer.width/2?-1:1}),this.scene.on("pointerup",()=>{this.control=0}),this.scene.on("pointerupoutside",()=>{this.control=0}),this.container.addChild(this.scene),this.nextRound(!0)}handleInput(t){}updateGame(t){if(this.finished)return;const e=t*(1e3/60),s=e/1e3;if(this.remainMs-=e,this.remainMs<=0){this.remainMs=0,this.finish(this.roundsDone>=this.roundsNeeded);return}if(this.roundRemain-=e,this.roundRemain<=0){if(this.roundsDone++,this.roundsDone>=this.roundsNeeded){this.finish(!0);return}this.nextRound()}this.control!==0&&(this.theta+=this.control*this.tiltRate*s,this.theta=l(this.theta,-this.maxAngle,this.maxAngle),this.drawBar()),this.driftT+=s;const n=this.driftAmp*Math.sin(this.driftT*(1.6+Math.random()*.2)),a=this.gravity*Math.sin(this.theta)+n;this.v+=a*s;const r=Math.exp(-this.friction*s);this.v*=r,this.u+=this.v*s,this.stabilityAccum+=Math.max(0,1-Math.min(1,Math.abs(this.u)/(this.barLen*.5)))*s;const d=this.barLen*.5-this.ballR*.6;if(Math.abs(this.u)>d){this.registerMiss();return}this.drawBall(),this.drawTimeBar()}showResult(t){var e;(e=this.onGameEnd)==null||e.call(this,t.success,t.score)}updateInfo(){const t=Math.ceil(this.remainMs/1e3);this.infoText.text=`Round ${this.roundsDone}/${this.roundsNeeded}   Miss ${this.misses}/${this.missesAllowed}   Time ${t}s`}drawTimeBar(){const t=this.app.renderer.width,e=Math.floor(this.app.renderer.height*.34),s=Math.floor(t*.7),n=Math.floor((t-s)/2),a=10,r=l(this.roundRemain/this.roundTimeMs,0,1);this.timeBar.clear(),this.timeBar.beginFill(this.colors.barBack,.4),this.timeBar.drawRoundedRect(n,e,s,a,6),this.timeBar.endFill(),this.timeBar.beginFill(this.colors.barFillUI,.95),this.timeBar.drawRoundedRect(n,e,Math.floor(s*r),a,6),this.timeBar.endFill()}nextRound(t=!1){t||(this.driftAmp=l(this.driftAmp*1.05,40,360),this.maxAngle=l(this.maxAngle*1.01,Math.PI/180*10,Math.PI/180*40)),this.u=0,this.v=0,this.theta=(Math.random()-.5)*this.maxAngle*.6,this.roundRemain=this.roundTimeMs,this.drawBar(),this.drawBall(),t||this.updateInfo()}drawBar(){const t=this.bar,e=this.app.renderer.width,s=this.app.renderer.height;this.cx=Math.floor(e*.5),this.cy=Math.floor(s*.62),t.clear(),t.beginFill(this.colors.barShadow,.2),t.drawRoundedRect(-this.barLen/2+6,-this.barH/2+10,this.barLen-12,this.barH,this.barH/2),t.endFill(),t.beginFill(this.colors.barFill,.96),t.lineStyle(4,this.colors.barEdge,.9),t.drawRoundedRect(-this.barLen/2,-this.barH/2,this.barLen,this.barH,this.barH/2),t.endFill(),t.x=this.cx,t.y=this.cy,t.rotation=this.theta}drawBall(){const t=this.ball,e=-Math.sin(this.theta),s=Math.cos(this.theta),n=Math.cos(this.theta),a=Math.sin(this.theta),r=this.cx+this.u*n+(this.barH/2+this.ballR)*e,d=this.cy+this.u*a+(this.barH/2+this.ballR)*s;t.clear(),t.beginFill(this.colors.ball,.96),t.drawCircle(0,0,this.ballR),t.endFill(),t.beginFill(0,.18),t.drawEllipse(this.ballR*.2,this.ballR*.4,this.ballR*.7,this.ballR*.38),t.endFill(),t.x=r,t.y=d}registerMiss(){if(this.misses++,this.misses>this.missesAllowed){this.finish(!1);return}this.nextRound()}finish(t){var r;if(this.finished)return;this.finished=!0;const e=Math.round(this.remainMs/6),s=Math.round(this.stabilityAccum*200),n=this.misses*120,a=Math.max(0,e+s-n+(t?800:0));(r=this.onGameEnd)==null||r.call(this,t,a)}}export{y as BalanceGame};
//# sourceMappingURL=BalanceGame-570799f1.js.map
