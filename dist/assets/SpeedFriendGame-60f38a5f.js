var y=Object.defineProperty;var S=(n,a,t)=>a in n?y(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t;var r=(n,a,t)=>(S(n,typeof a!="symbol"?a+"":a,t),t);import{G as R,C as w,a as p,b as x}from"./index-a4c7ba8a.js";function W(n){return n==="easy"||n==="normal"||n==="hard"}function H(n){const a=n.difficulty;return W(a)?a:"normal"}function A(n,a){return typeof n=="number"&&isFinite(n)?Math.max(1e3,Math.round(n*1e3)):a}function m(n,a,t){return Math.max(a,Math.min(t,n))}function M(n){for(let a=n.length-1;a>0;a--){const t=Math.random()*(a+1)|0;[n[a],n[t]]=[n[t],n[a]]}return n}function u(n,a){n.includes(a)||n.push(a)}class k extends R{constructor(t,i){super(t,i);r(this,"onGameEnd");r(this,"scene",new w);r(this,"finished",!1);r(this,"remainMs",3e4);r(this,"promptText");r(this,"infoText");r(this,"tiles",[]);r(this,"timeBar");r(this,"cols",2);r(this,"rows",2);r(this,"tileW",220);r(this,"tileH",120);r(this,"gapX",18);r(this,"gapY",16);r(this,"optionsCount",4);r(this,"targetCorrect",10);r(this,"missesAllowed",3);r(this,"correctSoFar",0);r(this,"misses",0);r(this,"questionTimeMs",3e3);r(this,"questionRemain",3e3);r(this,"awaiting",!1);r(this,"currentQ");r(this,"score",0);r(this,"combo",0);r(this,"colors",{bgTop:725024,bgBottom:1382955,tile:16777215,tileText:1776411,good:9627303,bad:16734810,text:16777215,barBack:3621201,barFill:3900150})}async createScene(){const t=this.settings,i=H(t),s=this.app.renderer.width,e=this.app.renderer.height;this.remainMs=A(t.duration,3e4),i==="easy"?(this.optionsCount=3,this.targetCorrect=8,this.missesAllowed=4,this.questionTimeMs=3600):i==="hard"?(this.optionsCount=5,this.targetCorrect=12,this.missesAllowed=2,this.questionTimeMs=2600):(this.optionsCount=4,this.targetCorrect=10,this.missesAllowed=3,this.questionTimeMs=3e3),typeof t.options=="number"&&isFinite(t.options)&&(this.optionsCount=m(Math.round(t.options),3,5)),typeof t.targetCorrect=="number"&&isFinite(t.targetCorrect)&&(this.targetCorrect=m(Math.round(t.targetCorrect),4,30)),typeof t.missesAllowed=="number"&&isFinite(t.missesAllowed)&&(this.missesAllowed=m(Math.round(t.missesAllowed),0,10)),typeof t.questionTimeMs=="number"&&isFinite(t.questionTimeMs)&&(this.questionTimeMs=m(Math.round(t.questionTimeMs),800,6e3)),t.palette==="forest"?(this.colors.bgTop=732704,this.colors.bgBottom=201999,this.colors.barFill=3462041):t.palette==="sunset"&&(this.colors.bgTop=3152180,this.colors.bgBottom=1706782,this.colors.barFill=16739179);const o=new p;o.beginFill(this.colors.bgTop),o.drawRect(0,0,s,Math.floor(e*.45)),o.endFill(),o.beginFill(this.colors.bgBottom),o.drawRect(0,Math.floor(e*.45),s,e),o.endFill(),this.scene.addChild(o),this.infoText=new x("",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(s,e)*.05),fill:this.colors.text,stroke:0,strokeThickness:5}),this.infoText.anchor.set(.5),this.infoText.x=s/2,this.infoText.y=Math.floor(e*.2),this.scene.addChild(this.infoText),this.updateInfo(),this.promptText=new x("Ready?",{fontFamily:"sans-serif",fontSize:Math.floor(Math.min(s,e)*.09),fill:this.colors.text,stroke:0,strokeThickness:6}),this.promptText.anchor.set(.5),this.promptText.x=s/2,this.promptText.y=Math.floor(e*.35),this.scene.addChild(this.promptText),this.timeBar=new p,this.scene.addChild(this.timeBar),this.cols=Math.ceil(Math.sqrt(this.optionsCount)),this.rows=Math.ceil(this.optionsCount/this.cols);const h=s-80,c=e-Math.floor(e*.48)-40;this.tileW=Math.min(240,Math.floor(h/this.cols)-16),this.tileH=Math.min(140,Math.floor(c/this.rows)-16),this.gapX=Math.max(12,Math.floor((h-this.cols*this.tileW)/(this.cols+1))),this.gapY=Math.max(10,Math.floor((c-this.rows*this.tileH)/(this.rows+1)));const T=Math.floor(e*.48),F=(s-(this.cols*this.tileW+(this.cols-1)*this.gapX))/2+this.tileW/2;for(let d=0;d<this.optionsCount;d++){const l=new w,f=new p;f.beginFill(this.colors.tile,.96),f.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),f.endFill();const g=new x("",{fontFamily:"sans-serif",fontSize:Math.floor(this.tileH*.34),fill:this.colors.tileText});g.anchor.set(.5),l.addChild(f,g),l.eventMode="static";const b=d;l.on("pointertap",B=>{B.stopPropagation(),this.onTap(b)});const C=d%this.cols,q=Math.floor(d/this.cols);l.x=F+C*(this.tileW+this.gapX),l.y=T+q*(this.tileH+this.gapY),this.scene.addChild(l),this.tiles.push({root:l,bg:f,label:g,index:b})}this.container.addChild(this.scene),this.nextQuestion(!0)}handleInput(t){}updateGame(t){if(this.finished)return;const i=t*(1e3/60);if(this.remainMs-=i,this.remainMs<=0){this.remainMs=0,this.finish(this.correctSoFar>=this.targetCorrect);return}this.awaiting&&(this.questionRemain-=i,this.drawTimeBar(),this.questionRemain<=0&&this.registerMiss("timeout"))}showResult(t){var i;(i=this.onGameEnd)==null||i.call(this,t.success,t.score)}updateInfo(){const t=Math.ceil(this.remainMs/1e3);this.infoText.text=`Correct ${this.correctSoFar}/${this.targetCorrect}  Miss ${this.misses}/${this.missesAllowed}  Time ${t}s`}drawTimeBar(){const t=this.app.renderer.width,i=Math.floor(this.app.renderer.height*.44),s=Math.floor(t*.7),e=Math.floor((t-s)/2),o=10,h=m(this.questionRemain/this.questionTimeMs,0,1);this.timeBar.clear(),this.timeBar.beginFill(this.colors.barBack,.4),this.timeBar.drawRoundedRect(e,i,s,o,6),this.timeBar.endFill(),this.timeBar.beginFill(this.colors.barFill,.95),this.timeBar.drawRoundedRect(e,i,Math.floor(s*h),o,6),this.timeBar.endFill()}nextQuestion(t=!1){this.currentQ=this.generateQuestion(this.optionsCount),this.promptText.text=this.currentQ.prompt;for(let i=0;i<this.tiles.length;i++){const s=this.tiles[i],e=this.currentQ.options[i]??"";s.label.text=e,s.bg.clear(),s.bg.beginFill(this.colors.tile,.96),s.bg.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),s.bg.endFill()}this.questionRemain=this.questionTimeMs,this.awaiting=!0,this.drawTimeBar(),t||this.updateInfo()}onTap(t){if(!this.awaiting||this.finished)return;if(t===this.currentQ.correct){this.awaiting=!1,this.correctSoFar++,this.combo++;const s=m(this.questionRemain/this.questionTimeMs,0,1),e=300,o=Math.min(7,this.combo)*60,h=Math.round(140*s);this.score+=e+o+h,this.flashTile(this.tiles[t],this.colors.good),this.correctSoFar>=this.targetCorrect?this.finish(!0):setTimeout(()=>this.nextQuestion(),120)}else this.registerMiss("wrong",t)}registerMiss(t,i=null){if(!this.awaiting||this.finished)return;this.awaiting=!1,this.combo=0,this.misses++,this.score=Math.max(0,this.score-150),i!=null&&this.flashTile(this.tiles[i],this.colors.bad);const s=this.tiles[this.currentQ.correct];this.flashTile(s,this.colors.good,.18),this.misses>this.missesAllowed?this.finish(!1):setTimeout(()=>this.nextQuestion(),200)}flashTile(t,i,s=.28){const e=new p;e.beginFill(i,s),e.drawRoundedRect(-this.tileW/2,-this.tileH/2,this.tileW,this.tileH,16),e.endFill(),e.x=t.root.x,e.y=t.root.y,this.scene.addChild(e);const o=8;for(let h=1;h<=o;h++)setTimeout(()=>{e.alpha=Math.max(0,s*(1-h/o)),h===o&&this.scene.removeChild(e)},h*30)}generateQuestion(t){const i=Math.random();return i<.22?this.qAdd(t):i<.44?this.qSub(t):i<.62?this.qMax(t):i<.8?this.qEven(t):this.qSequence(t)}qAdd(t){const i=2+(Math.random()*8|0),s=1+(Math.random()*8|0),e=i+s,o=[e];for(;o.length<t;){const h=(Math.random()*5|0)-2,c=e+(h===0?3:h);u(o,c)}return M(o),{prompt:`${i} + ${s} = ?`,options:o.map(String),correct:o.indexOf(e)}}qSub(t){const i=6+(Math.random()*10|0),s=1+(Math.random()*Math.min(8,i-1)|0),e=i-s,o=[e];for(;o.length<t;){const h=e+((Math.random()*5|0)-2);u(o,Math.max(0,h))}return M(o),{prompt:`${i} - ${s} = ?`,options:o.map(String),correct:o.indexOf(e)}}qMax(t){const i=[];for(;i.length<t;){const e=1+(Math.random()*40|0);u(i,e)}const s=Math.max(...i);return M(i),{prompt:"Which is the largest?",options:i.map(String),correct:i.indexOf(s)}}qEven(t){const i=[];let s=0;for(;i.length<t;){let o=1+(Math.random()*40|0);Math.random()<.4&&(o+=o%2),u(i,o)}for(const o of i)o%2===0&&s++;s===0&&i[Math.random()*i.length|0]++;const e=i.findIndex(o=>o%2===0);return{prompt:"Which number is even?",options:i.map(String),correct:e}}qSequence(t){const i=1+(Math.random()*8|0),s=1+(Math.random()*5|0),e=[i,i+s,i+s*2],o=i+s*3,h=[o];for(;h.length<t;){const c=o+((Math.random()*6|0)-3);u(h,c)}return M(h),{prompt:`Next: ${e.join(", ")}, ?`,options:h.map(String),correct:h.indexOf(o)}}finish(t){var h;if(this.finished)return;this.finished=!0;const i=Math.round(this.remainMs/8),s=this.correctSoFar*70,e=this.misses*120,o=Math.max(0,this.score+i+s-e+(t?700:0));(h=this.onGameEnd)==null||h.call(this,t,o)}}export{k as SpeedFriendGame};
//# sourceMappingURL=SpeedFriendGame-60f38a5f.js.map
